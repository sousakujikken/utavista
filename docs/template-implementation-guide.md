# ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆå®Ÿè£…ã‚¬ã‚¤ãƒ‰ - UTAVISTA v0.6.0 + ã‚°ãƒ©ãƒ•ã‚£ãƒƒã‚¯ãƒ—ãƒªãƒŸãƒ†ã‚£ãƒ–å¯¾å¿œ

> **ğŸš¨ é‡è¦**: åˆã‚ã¦ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã‚’å®Ÿè£…ã™ã‚‹æ–¹ã¯ã€å¿…ãš [ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆå®Ÿè£…ã‚¯ã‚¤ãƒƒã‚¯ã‚¹ã‚¿ãƒ¼ãƒˆã‚¬ã‚¤ãƒ‰](./template-quick-start-guide.md) ã‚’æœ€åˆã«ãŠèª­ã¿ãã ã•ã„ã€‚é‡è¦ãªåŸå‰‡ã¨å®Ÿè£…æ–¹å¼ã®é¸æŠã«ã¤ã„ã¦èª¬æ˜ã—ã¦ã„ã¾ã™ã€‚

ã“ã®ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã¯ã€**UTAVISTA v0.6.0**ã§æ–°ã—ã„ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã‚’å®Ÿè£…ã™ã‚‹ãŸã‚ã®è©³ç´°ãªæ‰‹é †ã‚’èª¬æ˜ã—ã¾ã™ã€‚æ–°ã—ã„ParameterRegistryã‚·ã‚¹ãƒ†ãƒ ã€**æ–‡å­—é‡è¤‡è¡¨ç¤ºé˜²æ­¢æ©Ÿèƒ½ï¼ˆv2.1ï¼‰**ã€**ã‚°ãƒ©ãƒ•ã‚£ãƒƒã‚¯ãƒ—ãƒªãƒŸãƒ†ã‚£ãƒ–ã‚·ã‚¹ãƒ†ãƒ ï¼ˆv0.6.0æ–°æ©Ÿèƒ½ï¼‰**ã€**å¤šè¡Œè¡¨ç¤ºã‚·ã‚¹ãƒ†ãƒ ï¼ˆMultiLineLayoutPrimitiveï¼‰**ã‚’ä½¿ç”¨ã—ã€å®‰å…¨ã§é«˜å“è³ªãªãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã‚’ä½œæˆã§ãã‚‹ã‚ˆã†æŒ‡å°ã—ã¾ã™ã€‚

## âš¡ å®Ÿè£…æ–¹å¼ã‚¯ã‚¤ãƒƒã‚¯åˆ¤å®š

**90%ã®ã‚±ãƒ¼ã‚¹ï¼ˆæ¨å¥¨ï¼‰**: ã‚«ãƒ©ã‚ªã‚±é¢¨ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆ
- âœ… ç”¨é€”: ä¸€èˆ¬çš„ãªæ­Œè©ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ã€çŠ¶æ…‹å¤‰åŒ–é‡è¦–
- âœ… æ–¹å¼: **è‰²å¤‰åŒ–ã®ã¿** (`textObj.alpha = 1.0`, `textObj.visible = true`)
- âœ… å‚è€ƒ: WordSlideTextPrimitive (lines 598-599)

**10%ã®ã‚±ãƒ¼ã‚¹ï¼ˆä¸Šç´šè€…å‘ã‘ï¼‰**: ãƒ•ã‚§ãƒ¼ãƒ‰åŠ¹æœãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆ  
- âš ï¸ ç”¨é€”: ç‰¹æ®Šãªãƒ•ã‚§ãƒ¼ãƒ‰æ¼”å‡ºã€ãƒ–ãƒ©ãƒ¼åŠ¹æœä»˜ã
- âš ï¸ æ–¹å¼: **è‰²ã®ã‚¢ãƒ«ãƒ•ã‚¡å€¤åˆ¶å¾¡** (`applyAlphaToColor()` ä½¿ç”¨)
- âš ï¸ å‚è€ƒ: FadeBlurRandomTextPrimitive v2.0

**è©³ç´°ã¯ [ã‚¯ã‚¤ãƒƒã‚¯ã‚¹ã‚¿ãƒ¼ãƒˆã‚¬ã‚¤ãƒ‰](./template-quick-start-guide.md) ã‚’å‚ç…§ã—ã¦ãã ã•ã„ã€‚**

## ç›®æ¬¡

1. [å‰æçŸ¥è­˜ã¨æº–å‚™](#å‰æçŸ¥è­˜ã¨æº–å‚™)
2. [ğŸ•’ ã‚¿ã‚¤ãƒ ã‚¹ã‚¿ãƒ³ãƒ—ãƒ™ãƒ¼ã‚¹çŠ¶æ…‹ä¸€å…ƒç®¡ç†ï¼ˆå¿…é ˆï¼‰](#ã‚¿ã‚¤ãƒ ã‚¹ã‚¿ãƒ³ãƒ—ãƒ™ãƒ¼ã‚¹çŠ¶æ…‹ä¸€å…ƒç®¡ç†)
3. [ğŸ¨ ã‚°ãƒ©ãƒ•ã‚£ãƒƒã‚¯ãƒ—ãƒªãƒŸãƒ†ã‚£ãƒ–ã‚·ã‚¹ãƒ†ãƒ ï¼ˆv0.5.1æ–°æ©Ÿèƒ½ï¼‰](#ã‚°ãƒ©ãƒ•ã‚£ãƒƒã‚¯ãƒ—ãƒªãƒŸãƒ†ã‚£ãƒ–ã‚·ã‚¹ãƒ†ãƒ )
4. [ğŸ“ å¤šè¡Œè¡¨ç¤ºã‚·ã‚¹ãƒ†ãƒ ï¼ˆMultiLineLayoutPrimitiveï¼‰](#å¤šè¡Œè¡¨ç¤ºã‚·ã‚¹ãƒ†ãƒ )
5. [ğŸ¯ ç”»é¢ä¸­å¿ƒé…ç½®ã®æ¨™æº–ä»•æ§˜ï¼ˆv0.4.3æ¨™æº–ï¼‰](#ç”»é¢ä¸­å¿ƒé…ç½®ã®æ¨™æº–ä»•æ§˜)
6. [ğŸš¨ æ–‡å­—é‡è¤‡è¡¨ç¤ºé˜²æ­¢ã‚¬ã‚¤ãƒ‰ï¼ˆv2.1æ–°æ©Ÿèƒ½ï¼‰](#æ–‡å­—é‡è¤‡è¡¨ç¤ºé˜²æ­¢ã‚¬ã‚¤ãƒ‰)
7. [âš¡ ãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°æœ€é©åŒ–å®Ÿè£…ï¼ˆv0.5.0æ–°æ©Ÿèƒ½ï¼‰](#ãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°æœ€é©åŒ–å®Ÿè£…)
8. [ğŸ”§ ãƒ—ãƒªãƒŸãƒ†ã‚£ãƒ–ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ãƒ¡ãƒ³ãƒ†ãƒŠãƒ³ã‚¹ï¼ˆé‡è¦ï¼‰](#ãƒ—ãƒªãƒŸãƒ†ã‚£ãƒ–ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ãƒ¡ãƒ³ãƒ†ãƒŠãƒ³ã‚¹)
9. [ğŸ“‹ å®‰å…¨ãªãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆå®Ÿè£…ãƒã‚§ãƒƒã‚¯ãƒªã‚¹ãƒˆï¼ˆv2.1ï¼‰](#å®‰å…¨ãªãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆå®Ÿè£…ãƒã‚§ãƒƒã‚¯ãƒªã‚¹ãƒˆ)
10. [ç¾è¡Œã‚·ã‚¹ãƒ†ãƒ ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£ã®ç†è§£](#ç¾è¡Œã‚·ã‚¹ãƒ†ãƒ ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£ã®ç†è§£)
11. [åŸºæœ¬æ§‹é€ ã®å®Ÿè£…](#åŸºæœ¬æ§‹é€ ã®å®Ÿè£…)
12. [éšå±¤å¯¾å¿œã®ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³å®Ÿè£…](#éšå±¤å¯¾å¿œã®ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³å®Ÿè£…)
13. [ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ãƒ¬ã‚¸ã‚¹ãƒˆãƒªç™»éŒ²ã¨ç®¡ç†](#ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ãƒ¬ã‚¸ã‚¹ãƒˆãƒªç™»éŒ²ã¨ç®¡ç†)
14. [æ–‡å­—ãƒ»å˜èªã‚«ã‚¦ãƒ³ãƒˆç®¡ç†](#æ–‡å­—ãƒ»å˜èªã‚«ã‚¦ãƒ³ãƒˆç®¡ç†)
15. [PixiJSãƒ•ã‚£ãƒ«ã‚¿ã¨ã‚¨ãƒ•ã‚§ã‚¯ãƒˆå®Ÿè£…](#PixiJSãƒ•ã‚£ãƒ«ã‚¿ã¨ã‚¨ãƒ•ã‚§ã‚¯ãƒˆå®Ÿè£…)
16. [FontServiceçµ±åˆã¨ãƒ•ã‚©ãƒ³ãƒˆç®¡ç†](#FontServiceçµ±åˆã¨ãƒ•ã‚©ãƒ³ãƒˆç®¡ç†)
17. [ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹æœ€é©åŒ–æŠ€æ³•](#ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹æœ€é©åŒ–æŠ€æ³•)
18. [ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°ã¨ãƒ‡ãƒãƒƒã‚°](#ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°ã¨ãƒ‡ãƒãƒƒã‚°)
19. [æ–‡å­—ä½ç½®è¨ˆç®—ã®å®Ÿè£…ã‚¬ã‚¤ãƒ‰](#æ–‡å­—ä½ç½®è¨ˆç®—ã®å®Ÿè£…ã‚¬ã‚¤ãƒ‰)
20. [ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆãƒ¬ã‚¸ã‚¹ãƒˆãƒªã¸ã®ç™»éŒ²](#ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆãƒ¬ã‚¸ã‚¹ãƒˆãƒªã¸ã®ç™»éŒ²)
21. [å®Ÿè£…ãƒ‘ã‚¿ãƒ¼ãƒ³ç·åˆã‚¬ã‚¤ãƒ‰](#å®Ÿè£…ãƒ‘ã‚¿ãƒ¼ãƒ³ç·åˆã‚¬ã‚¤ãƒ‰)
22. [ãƒ•ãƒ¬ãƒ¼ã‚ºã‚¿ã‚¤ãƒŸãƒ³ã‚°å„ªå…ˆå®Ÿè£…ã‚¬ã‚¤ãƒ‰](#ãƒ•ãƒ¬ãƒ¼ã‚ºã‚¿ã‚¤ãƒŸãƒ³ã‚°å„ªå…ˆå®Ÿè£…ã‚¬ã‚¤ãƒ‰v043æ–°æ©Ÿèƒ½)
23. [ã‚ˆãã‚ã‚‹å¤±æ•—äº‹ä¾‹ã¨å¯¾ç­–](#ã‚ˆãã‚ã‚‹å¤±æ•—äº‹ä¾‹ã¨å¯¾ç­–)

---

## ğŸ•’ ã‚¿ã‚¤ãƒ ã‚¹ã‚¿ãƒ³ãƒ—ãƒ™ãƒ¼ã‚¹çŠ¶æ…‹ä¸€å…ƒç®¡ç†ï¼ˆå¿…é ˆï¼‰

### æ¦‚è¦

**é‡è¦**: UTAVISTA v0.4.3ã§ãƒ—ãƒªãƒŸãƒ†ã‚£ãƒ–APIå°å…¥æ™‚ç‚¹ã‚ˆã‚Šã€ã™ã¹ã¦ã®ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã¯**ã‚¿ã‚¤ãƒ ã‚¹ã‚¿ãƒ³ãƒ—ãƒ™ãƒ¼ã‚¹ã®ç´”ç²‹ãªçŠ¶æ…‹è¨ˆç®—**ã‚’å®Ÿè£…ã™ã‚‹ã“ã¨ãŒå¿…é ˆè¦ä»¶ã§ã™ã€‚ã‚·ãƒ¼ã‚¯æ¤œå‡ºã‚„ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³çŠ¶æ…‹ã®åˆ†æ•£ç®¡ç†ã¯**ç¦æ­¢ã•ã‚ŒãŸã‚¢ãƒ³ãƒãƒ‘ã‚¿ãƒ¼ãƒ³**ã§ã™ã€‚

### åŸºæœ¬åŸå‰‡

#### 1. ç´”ç²‹ãªæ™‚é–“è¨ˆç®—ã®ã¿ã‚’ä½¿ç”¨

```typescript
// âœ… æ­£ã—ã„å®Ÿè£…: ç´”ç²‹ãªæ™‚é–“ãƒ™ãƒ¼ã‚¹è¨ˆç®—
renderPhraseContainer(container: PIXI.Container, params: any, nowMs: number, startMs: number, endMs: number) {
  const headTime = (params.headTime as number) || 500;
  const tailTime = (params.tailTime as number) || 500;
  
  // ç´”ç²‹ãªæ™‚é–“è¨ˆç®—ã§ãƒ•ã‚§ãƒ¼ã‚ºã‚’æ±ºå®š
  const swipeInStartTime = startMs - headTime;
  const swipeOutStartTime = endMs;
  const swipeOutEndTime = endMs + tailTime;
  
  let progress = 0;
  if (nowMs <= swipeInStartTime) {
    progress = 0.0;
  } else if (nowMs <= startMs) {
    // ã‚¹ãƒ¯ã‚¤ãƒ—ã‚¤ãƒ³ä¸­
    const elapsed = nowMs - swipeInStartTime;
    progress = elapsed / headTime;
  } else if (nowMs <= endMs) {
    // ã‚¢ã‚¯ãƒ†ã‚£ãƒ–æœŸé–“
    progress = 1.0;
  } else if (nowMs <= swipeOutEndTime) {
    // ã‚¹ãƒ¯ã‚¤ãƒ—ã‚¢ã‚¦ãƒˆä¸­
    const elapsed = nowMs - swipeOutStartTime;
    progress = 1.0 - (elapsed / tailTime);
  } else {
    progress = 0.0;
  }
  
  // ãƒ—ãƒ­ã‚°ãƒ¬ã‚¹ã«åŸºã¥ã„ã¦ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³å®Ÿè¡Œ
  this.applySwipeAnimation(container, progress);
}
```

#### 2. ç¦æ­¢ã•ã‚ŒãŸã‚¢ãƒ³ãƒãƒ‘ã‚¿ãƒ¼ãƒ³

```typescript
// âŒ ç¦æ­¢: ã‚·ãƒ¼ã‚¯æ¤œå‡ºãƒ­ã‚¸ãƒƒã‚¯
private detectSeek(nowMs: number, lastTimeMs: number): boolean {
  // ã“ã®ã‚ˆã†ãªå®Ÿè£…ã¯ç¦æ­¢
}

// âŒ ç¦æ­¢: ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³çŠ¶æ…‹ã®åˆ†æ•£ç®¡ç†
private animationRestartState = new Map<string, {
  restartTime: number;
  isRestarting: boolean;
}>();

// âŒ ç¦æ­¢: å‰ãƒ•ãƒ¬ãƒ¼ãƒ çŠ¶æ…‹ã¸ã®ä¾å­˜
private lastTimeState = new Map<string, number>();
```

### ã‚°ãƒ©ãƒ•ã‚£ãƒƒã‚¯ã‚³ãƒ³ãƒ†ãƒŠã®ä¸€å…ƒç®¡ç†

#### GraphicsContainerPrimitive ã¨ã®çµ±åˆ

ã‚°ãƒ©ãƒ•ã‚£ãƒƒã‚¯è¦ç´ ã‚’ä½¿ç”¨ã™ã‚‹ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã§ã¯ã€GraphicsContainerPrimitiveã‚’é€šã˜ãŸçŠ¶æ…‹ç®¡ç†ã‚‚æ™‚é–“ãƒ™ãƒ¼ã‚¹ã§è¡Œã†å¿…è¦ãŒã‚ã‚Šã¾ã™ï¼š

```typescript
// âœ… æ­£ã—ã„å®Ÿè£…: æ™‚é–“ãƒ™ãƒ¼ã‚¹ã§ã‚°ãƒ©ãƒ•ã‚£ãƒƒã‚¯è¦ç´ ã‚’ç®¡ç†
renderPhraseContainer(container: PIXI.Container, params: any, nowMs: number, startMs: number, endMs: number) {
  const phraseId = this.extractPhraseIdFromFullId(params.phraseId as string);
  
  // æ™‚é–“ãƒ™ãƒ¼ã‚¹ã§ã‚°ãƒ©ãƒ•ã‚£ãƒƒã‚¯è¦ç´ ã®è¡¨ç¤º/éè¡¨ç¤ºã‚’æ±ºå®š
  if (nowMs >= startMs - headTime && nowMs <= endMs + tailTime) {
    // ã‚°ãƒ©ãƒ•ã‚£ãƒƒã‚¯è¦ç´ ã‚’ä½œæˆ/æ›´æ–°ï¼ˆã¾ã å­˜åœ¨ã—ãªã„å ´åˆã®ã¿ï¼‰
    if (!this.hasGraphicsElements(phraseId)) {
      this.createGraphicsElements(container, phraseId, params);
    }
    
    // æ™‚é–“ã«åŸºã¥ã„ã¦ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³æ›´æ–°
    this.updateGraphicsAnimation(phraseId, nowMs, startMs, endMs);
  } else {
    // æ™‚é–“ç¯„å›²å¤–ã§ã¯è¦ç´ ã‚’ã‚¯ãƒªãƒ¼ãƒ³ã‚¢ãƒƒãƒ—
    this.cleanupGraphicsElements(phraseId);
  }
}

// ã‚°ãƒ©ãƒ•ã‚£ãƒƒã‚¯è¦ç´ å­˜åœ¨ç¢ºèªã‚‚çŠ¶æ…‹ãƒ™ãƒ¼ã‚¹
private hasGraphicsElements(phraseId: string): boolean {
  const containers = this.graphicsContainers.get(phraseId);
  return containers?.blackBandContainer?.children?.length > 0;
}
```

### å®Ÿè£…ä¸Šã®æ³¨æ„ç‚¹

#### 1. çŠ¶æ…‹ã®æ°¸ç¶šåŒ–ç¦æ­¢

```typescript
// âŒ ç¦æ­¢: å‰å›çŠ¶æ…‹ã®ä¿å­˜
private previousStates = new Map<string, any>();

// âœ… æ­£ã—ã„: å¿…è¦ãªçŠ¶æ…‹ã¯ã™ã¹ã¦ã‚¿ã‚¤ãƒ ã‚¹ã‚¿ãƒ³ãƒ—ã‹ã‚‰è¨ˆç®—
calculateCurrentState(nowMs: number, startMs: number, endMs: number) {
  // ã™ã¹ã¦ã®çŠ¶æ…‹ã‚’ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã‹ã‚‰ç´”ç²‹è¨ˆç®—
}
```

#### 2. ä¸€è²«ã—ãŸã‚¿ã‚¤ãƒŸãƒ³ã‚°ä¿è¨¼

```typescript
// âœ… æ­£ã—ã„: é€šå¸¸å†ç”Ÿã§ã‚‚ã‚·ãƒ¼ã‚¯ã§ã‚‚åŒã˜çµæœ
const getAnimationProgress = (nowMs: number, startMs: number, duration: number): number => {
  if (nowMs <= startMs) return 0;
  if (nowMs >= startMs + duration) return 1;
  return (nowMs - startMs) / duration;
};
```

### StateManager ã‚·ã‚¹ãƒ†ãƒ ã¨ã®é€£æº

æ–°ã—ã„ StateManager ã‚·ã‚¹ãƒ†ãƒ ã‚’ä½¿ç”¨ã™ã‚‹å ´åˆã¯ã€ä»¥ä¸‹ã®ãƒ‘ã‚¿ãƒ¼ãƒ³ã«å¾“ã„ã¾ã™ï¼š

```typescript
// StatelessTemplate ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹ã®å®Ÿè£…ä¾‹
export class MyStatelessTemplate implements IStatelessTemplate {
  renderAtTime(container: PIXI.Container, renderState: RenderState, params: TemplateParams, timestamp: number): boolean {
    // RenderState ã‹ã‚‰çŠ¶æ…‹ã‚’å–å¾—ï¼ˆã™ã¹ã¦æ™‚é–“ãƒ™ãƒ¼ã‚¹è¨ˆç®—æ¸ˆã¿ï¼‰
    const { phase, visible, progress } = renderState.object;
    const swipeInEffect = renderState.effects.get('swipeIn');
    
    if (!visible) {
      this.cleanup(container);
      return false;
    }
    
    // çŠ¶æ…‹ã«åŸºã¥ã„ã¦æç”»å®Ÿè¡Œ
    this.renderBasedOnState(container, phase, progress, swipeInEffect, params);
    return true;
  }
}
```

### å•é¡Œäº‹ä¾‹: BlackBandMaskTextPrimitive ã§ã®èª²é¡Œ

éå»ã« BlackBandMaskTextPrimitive ã§ç™ºç”Ÿã—ãŸå•é¡Œï¼š

- **å•é¡Œ**: ã‚·ãƒ¼ã‚¯æ¤œå‡ºã§ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³é–‹å§‹æ™‚é–“ãŒé€šå¸¸å†ç”Ÿæ™‚ï¼ˆ800mså‰ï¼‰ã¨ç•°ãªã‚‹ï¼ˆ80mså‰ï¼‰
- **åŸå› **: `startAnimationRestart()` ã§ãƒªã‚¹ã‚¿ãƒ¼ãƒˆæ™‚é–“ã‚’ `nowMs` ã«è¨­å®š
- **è§£æ±º**: ã‚·ãƒ¼ã‚¯æ¤œå‡ºãƒ­ã‚¸ãƒƒã‚¯å®Œå…¨é™¤å»ã€ç´”ç²‹ãªæ™‚é–“è¨ˆç®—ã¸ã®ç§»è¡Œ

ã“ã®äº‹ä¾‹ã‚’å‚è€ƒã«ã€ã™ã¹ã¦ã®ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã§åŒæ§˜ã®å•é¡Œã‚’äºˆé˜²ã—ã¦ãã ã•ã„ã€‚

---

## ğŸ¨ ã‚°ãƒ©ãƒ•ã‚£ãƒƒã‚¯ãƒ—ãƒªãƒŸãƒ†ã‚£ãƒ–ã‚·ã‚¹ãƒ†ãƒ 

### æ¦‚è¦

v0.5.1ã§æ–°ãŸã«å°å…¥ã•ã‚ŒãŸã‚°ãƒ©ãƒ•ã‚£ãƒƒã‚¯ãƒ—ãƒªãƒŸãƒ†ã‚£ãƒ–ã‚·ã‚¹ãƒ†ãƒ ã«ã‚ˆã‚Šã€ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã§ã®å›³å½¢æç”»ã¨ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³æ©Ÿèƒ½ãŒå¤§å¹…ã«å¼·åŒ–ã•ã‚Œã¾ã—ãŸã€‚

### ä¸»è¦ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ

#### 1. ShapePrimitive

åŸºæœ¬å›³å½¢ã®ä½œæˆã¨ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³æ©Ÿèƒ½ã‚’æä¾›ï¼š

```typescript
import { ShapePrimitive, type RectangleParams } from '../primitives';

// åˆæœŸåŒ–
private shapePrimitive = new ShapePrimitive();

// çŸ©å½¢ã®ä½œæˆ
const blackBandParams: RectangleParams = {
  width: bandWidth,
  height: bandHeight,
  x: centerX - bandWidth / 2,
  y: -bandHeight / 2,
  color: '#000000',
  alpha: 1.0
};

const blackBand = this.shapePrimitive.createRectangle(blackBandParams);
blackBand.name = `black_band_${phraseId}`;
```

**ã‚µãƒãƒ¼ãƒˆå›³å½¢**:
- çŸ©å½¢ (`createRectangle`)
- å†† (`createCircle`) 
- å¤šè§’å½¢ (`createPolygon`)
- æ˜Ÿå½¢ (`createStar`)

**ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³æ©Ÿèƒ½**:
- ä½ç½®ã€ã‚¹ã‚±ãƒ¼ãƒ«ã€å›è»¢ã€é€æ˜åº¦ã®åˆ¶å¾¡
- ã‚¤ãƒ¼ã‚¸ãƒ³ã‚°é–¢æ•°å¯¾å¿œ (`linear`, `easeIn`, `easeOut`, `easeInCubic`ç­‰)
- ãƒ«ãƒ¼ãƒ—ãƒ»ãƒ¨ãƒ¼ãƒ¨ãƒ¼ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³

#### 2. GraphicsContainerPrimitive

ã‚°ãƒ©ãƒ•ã‚£ãƒƒã‚¯è¦ç´ ã®ãƒ¬ã‚¤ãƒ¤ãƒ¼ç®¡ç†ã‚·ã‚¹ãƒ†ãƒ ï¼š

```typescript
import { GraphicsContainerPrimitive, type GraphicsLayerConfig } from '../primitives';

// åˆæœŸåŒ–
private graphicsContainer = new GraphicsContainerPrimitive();

// ãƒ¬ã‚¤ãƒ¤ãƒ¼ã‚·ã‚¹ãƒ†ãƒ åˆæœŸåŒ–
const { belowTextContainer, aboveTextContainer } = 
  this.graphicsContainer.initializeGraphicsLayers(phraseContainer, phraseId);

// ã‚°ãƒ©ãƒ•ã‚£ãƒƒã‚¯è¦ç´ ã®è¿½åŠ 
this.graphicsContainer.addGraphicsElement(
  `${phraseId}_black_band`,
  blackBandGraphics,
  'below_text_layer',
  {
    createAt: 'phrase_start',
    destroyAt: 'phrase_end'
  }
);
```

**ãƒ¬ã‚¤ãƒ¤ãƒ¼ç®¡ç†**:
- **ä¸‹å±¤ã‚³ãƒ³ãƒ†ãƒŠ** (`below_text`): ãƒ†ã‚­ã‚¹ãƒˆã‚ˆã‚Šä¸‹å±¤ï¼ˆzIndex: -100ï¼‰
- **ä¸Šå±¤ã‚³ãƒ³ãƒ†ãƒŠ** (`above_text`): ãƒ†ã‚­ã‚¹ãƒˆã‚ˆã‚Šä¸Šå±¤ï¼ˆzIndex: 100ï¼‰
- æ­Œè©ã‚¿ã‚¤ãƒŸãƒ³ã‚°ã¨ã®è‡ªå‹•åŒæœŸ
- ãƒ©ã‚¤ãƒ•ã‚µã‚¤ã‚¯ãƒ«ç®¡ç†ï¼ˆä½œæˆãƒ»ç ´æ£„ã‚¿ã‚¤ãƒŸãƒ³ã‚°åˆ¶å¾¡ï¼‰

**âš ï¸ é‡è¦: æ™‚é–“ãƒ™ãƒ¼ã‚¹çŠ¶æ…‹ç®¡ç†ã¨ã®çµ±åˆ**

GraphicsContainerPrimitive ã‚’ä½¿ç”¨ã™ã‚‹ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã§ã‚‚ã€ã‚¿ã‚¤ãƒ ã‚¹ã‚¿ãƒ³ãƒ—ãƒ™ãƒ¼ã‚¹çŠ¶æ…‹ä¸€å…ƒç®¡ç†ã®åŸå‰‡ã«å¾“ã„ã€ã™ã¹ã¦ã®ã‚°ãƒ©ãƒ•ã‚£ãƒƒã‚¯è¦ç´ ã®çŠ¶æ…‹ã‚’æ™‚é–“ã‹ã‚‰ç´”ç²‹è¨ˆç®—ã™ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ï¼š

```typescript
// âœ… æ­£ã—ã„å®Ÿè£…: æ™‚é–“ãƒ™ãƒ¼ã‚¹ã‚°ãƒ©ãƒ•ã‚£ãƒƒã‚¯ç®¡ç†
renderPhraseContainer(container: PIXI.Container, params: any, nowMs: number, startMs: number, endMs: number) {
  const headTime = (params.headTime as number) || 500;
  const tailTime = (params.tailTime as number) || 500;
  
  // æ™‚é–“ç¯„å›²å†…ã§ã®ã¿ã‚°ãƒ©ãƒ•ã‚£ãƒƒã‚¯è¦ç´ ã‚’ç®¡ç†
  if (nowMs >= startMs - headTime && nowMs <= endMs + tailTime) {
    // ã‚°ãƒ©ãƒ•ã‚£ãƒƒã‚¯è¦ç´ ã‚’ä½œæˆï¼ˆåˆå›ã®ã¿ï¼‰
    this.ensureGraphicsElementsExist(container, phraseId, params);
    
    // æ™‚é–“ã«åŸºã¥ãã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³æ›´æ–°
    this.updateGraphicsAnimationByTime(phraseId, nowMs, startMs, endMs, headTime, tailTime);
  } else {
    // æ™‚é–“ç¯„å›²å¤–ã§ã¯å®Œå…¨ã‚¯ãƒªãƒ¼ãƒ³ã‚¢ãƒƒãƒ—
    this.cleanupGraphicsElements(phraseId);
  }
}

// ã‚°ãƒ©ãƒ•ã‚£ãƒƒã‚¯è¦ç´ ã®å­˜åœ¨ç¢ºèªï¼ˆçŠ¶æ…‹ãƒ™ãƒ¼ã‚¹ï¼‰
private ensureGraphicsElementsExist(container: PIXI.Container, phraseId: string, params: any) {
  const containers = this.graphicsContainers.get(phraseId);
  if (!containers || containers.blackBandContainer.children.length === 0) {
    this.createGraphicsElements(container, phraseId, params);
  }
}
```

### å®Ÿè£…ä¾‹: BlackBandMaskTextPrimitive

```typescript
export class BlackBandMaskTextPrimitive implements IAnimationTemplate {
  private shapePrimitive = new ShapePrimitive();
  private graphicsContainers = new Map<string, {
    blackBandContainer: PIXI.Container;
    invertMaskContainer: PIXI.Container;
  }>();

  // ãƒ•ãƒ¬ãƒ¼ã‚ºãƒ¬ãƒ™ãƒ«ã§ã‚°ãƒ©ãƒ•ã‚£ãƒƒã‚¯ã‚³ãƒ³ãƒ†ãƒŠã‚’ç®¡ç†
  private manageGraphicsContainers(phraseContainer: PIXI.Container, ...params) {
    // é»’å¸¯ç”¨ä¸‹å±¤ã‚³ãƒ³ãƒ†ãƒŠ
    const blackBandContainer = new PIXI.Container();
    blackBandContainer.zIndex = -50; // ãƒ†ã‚­ã‚¹ãƒˆã‚ˆã‚Šä¸‹å±¤
    
    // åè»¢ãƒã‚¹ã‚¯ç”¨ä¸Šå±¤ã‚³ãƒ³ãƒ†ãƒŠ  
    const invertMaskContainer = new PIXI.Container();
    invertMaskContainer.zIndex = 50; // ãƒ†ã‚­ã‚¹ãƒˆã‚ˆã‚Šä¸Šå±¤
    
    phraseContainer.addChild(blackBandContainer);
    phraseContainer.addChild(invertMaskContainer);
    phraseContainer.sortChildren();
  }
  
  // é»’å¸¯ã®ä½œæˆ
  private createBlackBand(container: PIXI.Container, params: any) {
    const blackBand = this.shapePrimitive.createRectangle({
      width: phraseWidth * 1.2,
      height: fontSize * 1.5,
      x: centerX - bandWidth / 2,
      y: -bandHeight / 2,
      color: '#000000',
      alpha: 1.0
    });
    
    container.addChild(blackBand);
  }
}
```

---

## ğŸ“ å¤šè¡Œè¡¨ç¤ºã‚·ã‚¹ãƒ†ãƒ ï¼ˆMultiLineLayoutPrimitiveï¼‰

### æ¦‚è¦

æ™‚é–“çš„ã«é‡è¤‡ã™ã‚‹ãƒ•ãƒ¬ãƒ¼ã‚ºã‚’è‡ªå‹•çš„ã«ç•°ãªã‚‹è¡Œã«é…ç½®ã—ã¦è¦–è¦šçš„é‡è¤‡ã‚’å›é¿ã™ã‚‹ã‚·ã‚¹ãƒ†ãƒ ã§ã™ã€‚

### ä¸»è¦æ©Ÿèƒ½

#### 1. è‡ªå‹•è¡Œé…ç½®

```typescript
import { MultiLineLayoutPrimitive, type MultiLinePhraseParams } from '../primitives';

// Singletonã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹å–å¾—
const multiLine = MultiLineLayoutPrimitive.getInstance();

const multiLineParams: MultiLinePhraseParams = {
  phraseId: phraseId,
  startMs: startMs,
  endMs: endMs,
  nowMs: nowMs,
  maxLines: 4,                    // æœ€å¤§è¡Œæ•°
  lineSpacing: 1.5,              // è¡Œé–“éš”å€ç‡
  overlapThreshold: 2000,        // é‡è¤‡åˆ¤å®šã—ãã„å€¤(ms)
  fontSize: fontSize,
  baseY: phraseAnimationResult.y, // åŸºæº–Yä½ç½®
  resetInterval: 0               // è‡ªå‹•ãƒªã‚»ãƒƒãƒˆé–“éš”(0=ç„¡åŠ¹)
};

const lineResult = multiLine.calculatePhrasePosition(multiLineParams);
const finalY = lineResult.absoluteY; // æœ€çµ‚Yä½ç½®
```

#### 2. é‡è¤‡æ¤œå‡ºã‚¢ãƒ«ã‚´ãƒªã‚ºãƒ 

ã‚·ã‚¹ãƒ†ãƒ ã¯ä»¥ä¸‹ã®æ¡ä»¶ã§æ™‚é–“çš„é‡è¤‡ã‚’æ¤œå‡ºï¼š

1. **ç›´æ¥ã‚ªãƒ¼ãƒãƒ¼ãƒ©ãƒƒãƒ—**: ãƒ•ãƒ¬ãƒ¼ã‚ºã®æ™‚é–“ç¯„å›²ãŒé‡è¤‡
2. **è¿‘æ¥åˆ¤å®š**: çµ‚äº†æ™‚åˆ»ã‹ã‚‰`overlapThreshold`ä»¥å†…ã§ã®é–‹å§‹
3. **å…ˆè¡Œåˆ¤å®š**: é–‹å§‹æ™‚åˆ»ã‹ã‚‰`overlapThreshold`ä»¥å†…ã§ã®å…ˆè¡Œçµ‚äº†

#### 3. è¡Œç®¡ç†ã¨ã‚¯ãƒªãƒ¼ãƒ³ã‚¢ãƒƒãƒ—

```typescript
// ãƒ•ãƒ¬ãƒ¼ã‚ºçµ‚äº†æ™‚ã®æ˜ç¤ºçš„è§£æ”¾
multiLine.releasePhraseFromLine(phraseId);

// å…¨å‰²ã‚Šå½“ã¦ãƒªã‚»ãƒƒãƒˆ
multiLine.resetAllAssignments();

// ãƒ‡ãƒãƒƒã‚°ãƒ¢ãƒ¼ãƒ‰è¨­å®š
multiLine.setDebugMode(true);
```

### å®Ÿè£…ãƒ‘ã‚¿ãƒ¼ãƒ³

#### ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã§ã®åŸºæœ¬çš„ãªä½¿ç”¨æ–¹æ³•

```typescript
renderPhraseContainer(container, text, params, nowMs, startMs, endMs, phase) {
  // åŸºæœ¬ä½ç½®è¨ˆç®—
  const phraseResult = slideAnimationPrimitive.calculatePhrasePosition({...});
  
  let finalY = phraseResult.y;
  
  // å¤šè¡Œè¡¨ç¤ºå‡¦ç†
  if (params.enableMultiLine !== false) {
    const multiLine = MultiLineLayoutPrimitive.getInstance();
    const lineResult = multiLine.calculatePhrasePosition({
      phraseId: phraseId,
      startMs: startMs,
      endMs: endMs,
      nowMs: nowMs,
      maxLines: params.maxLines as number || 4,
      lineSpacing: params.autoLineSpacing as number || 1.5,
      overlapThreshold: params.lineOverlapThreshold as number || 2000,
      fontSize: params.fontSize as number || 120,
      baseY: phraseResult.y,
      resetInterval: params.lineResetInterval as number || 0
    });
    
    finalY = lineResult.absoluteY;
  }
  
  // æœ€çµ‚ä½ç½®è¨­å®š
  container.position.set(phraseResult.x, finalY);
  
  // ãƒ•ãƒ¬ãƒ¼ã‚ºçµ‚äº†æ™‚ã®ã‚¯ãƒªãƒ¼ãƒ³ã‚¢ãƒƒãƒ—
  if (phase === 'out') {
    if (params.enableMultiLine) {
      multiLine.releasePhraseFromLine(phraseId);
    }
  }
}
```

#### æ¨å¥¨ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿è¨­å®š

```typescript
// å¤šè¡Œè¡¨ç¤ºãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿
{ name: "enableMultiLine", type: "boolean", default: true },
{ name: "maxLines", type: "number", default: 4, min: 1, max: 8, step: 1 },
{ name: "lineOverlapThreshold", type: "number", default: 2000, min: 500, max: 5000, step: 100 },
{ name: "autoLineSpacing", type: "number", default: 1.5, min: 1.0, max: 3.0, step: 0.1 },
{ name: "lineResetInterval", type: "number", default: 0, min: 0, max: 30000, step: 1000 },
```

---

## ğŸ“‹ v0.5.1é‡è¦å¤‰æ›´äº‹é …

### ã‚°ãƒ©ãƒ•ã‚£ãƒƒã‚¯ãƒ—ãƒªãƒŸãƒ†ã‚£ãƒ–ã‚·ã‚¹ãƒ†ãƒ ã®å°å…¥

- **ShapePrimitive**: åŸºæœ¬å›³å½¢ä½œæˆã¨ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³æ©Ÿèƒ½
- **GraphicsContainerPrimitive**: ãƒ¬ã‚¤ãƒ¤ãƒ¼ç®¡ç†ã¨æ­Œè©åŒæœŸã‚·ã‚¹ãƒ†ãƒ 
- **BlackBandMaskTextPrimitive**: å®Ÿè£…å‚è€ƒä¾‹ã¨ã—ã¦æ–°è¦è¿½åŠ 

### å¤šè¡Œè¡¨ç¤ºã‚·ã‚¹ãƒ†ãƒ ã®å®Ÿè£…

- **MultiLineLayoutPrimitive**: æ™‚é–“çš„é‡è¤‡ãƒ•ãƒ¬ãƒ¼ã‚ºã®è‡ªå‹•è¡Œé…ç½®
- Singletonãƒ‘ã‚¿ãƒ¼ãƒ³ã«ã‚ˆã‚‹å…¨ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆå…±é€šã®çŠ¶æ…‹ç®¡ç†
- è‡ªå‹•ã‚¯ãƒªãƒ¼ãƒ³ã‚¢ãƒƒãƒ—ã¨ãƒªã‚»ãƒƒãƒˆæ©Ÿèƒ½

### æ‹¡å¼µIDã‚·ã‚¹ãƒ†ãƒ ã®å¼·åŒ–

- ã™ã¹ã¦ã®same_lineãƒ¢ãƒ¼ãƒ‰ä½¿ç”¨ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã§æ‹¡å¼µIDå¯¾å¿œãŒ**å¿…é ˆ**
- `extractPhraseIdFromFullId()` ãŠã‚ˆã³ `generateAllWordExtendedIds()` ãƒ¡ã‚½ãƒƒãƒ‰ã®å®Ÿè£…ç¾©å‹™åŒ–
- å˜èªé–“éš”è¨ˆç®—ã®ç²¾åº¦å‘ä¸Šã¨ãƒã‚°ä¿®æ­£

---

## ğŸ“‹ v0.4.3é‡è¦å¤‰æ›´äº‹é …

### ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆè¨ˆç®—ã®é‡è¦å¤‰æ›´

**deviceScaleå‰Šé™¤**: ãƒ—ãƒªãƒŸãƒ†ã‚£ãƒ–ã‚·ã‚¹ãƒ†ãƒ ã‹ã‚‰devicePixelRatioã«åŸºã¥ãã‚¹ã‚±ãƒ¼ãƒ«è¨ˆç®—ã‚’å®Œå…¨ã«å‰Šé™¤ã—ã¾ã—ãŸã€‚

#### å¤‰æ›´ã®å½±éŸ¿

- **æ–‡å­—é–“éš”**: `charSpacing=1.0`ã§æ¨™æº–çš„ãªé–“éš”ã‚’å®Ÿç¾
- **è¨ˆç®—å¼**: `xOffset = charIndex * fontSize * charSpacing * scaleFactor`ï¼ˆdeviceScaleä¸ä½¿ç”¨ï¼‰
- **è§£åƒåº¦**: ãƒ†ã‚­ã‚¹ãƒˆè§£åƒåº¦å‘ä¸Šã¨ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆè¨ˆç®—ã‚’æ˜ç¢ºã«åˆ†é›¢

#### å¯¾è±¡ãƒ—ãƒªãƒŸãƒ†ã‚£ãƒ–

- `FlexibleCumulativeLayoutPrimitive`
- `EnhancedCumulativeLayoutPrimitive`  
- `SlideAnimationPrimitive`

#### ç§»è¡Œæ–¹æ³•

æ—¢å­˜ã®ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã§`charSpacing=0.5`ã‚’ä½¿ç”¨ã—ã¦ã„ãŸå ´åˆã¯ã€`charSpacing=1.0`ã«å¤‰æ›´ã—ã¦ãã ã•ã„ã€‚

```typescript
// âŒ æ—§æ–¹å¼ï¼ˆv0.4.2ä»¥å‰ï¼‰
charSpacing: 0.5  // deviceScaleã§2å€ã•ã‚Œã‚‹ãŸã‚0.5ã§èª¿æ•´

// âœ… æ–°æ–¹å¼ï¼ˆv0.4.3ä»¥é™ï¼‰
charSpacing: 1.0  // æ¨™æº–çš„ãªæ–‡å­—é–“éš”
```

### ğŸš¨ new_lineãƒ¢ãƒ¼ãƒ‰ã®lineHeightæš«å®šå¯¾å¿œï¼ˆæ—¢çŸ¥ã®å•é¡Œï¼‰

**å•é¡Œ**: `individual_word_entrance_new_line`ãŠã‚ˆã³`phrase_cumulative_new_line`ãƒ¢ãƒ¼ãƒ‰ã§ã€`lineHeight`ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ãŒæœŸå¾…å€¤ã®2å€ã®è¡Œé–“ã«ãªã‚‹æ—¢çŸ¥ã®å•é¡ŒãŒã‚ã‚Šã¾ã™ã€‚

**åŸå› **: è«–ç†è§£åƒåº¦ï¼ˆ1920Ã—1080ï¼‰ã¨CSSã‚¹ã‚±ãƒ¼ãƒªãƒ³ã‚°ï¼ˆ~0.417ï¼‰ã®é–“ã®åº§æ¨™å¤‰æ›ãŒé©åˆ‡ã«å‡¦ç†ã•ã‚Œã¦ã„ãªã„ãŸã‚ã€‚

#### æš«å®šå¯¾å¿œæ–¹æ³•

new_lineãƒ¢ãƒ¼ãƒ‰ã‚’ä½¿ç”¨ã™ã‚‹éš›ã¯ã€**å¸Œæœ›ã™ã‚‹è¡Œé«˜ã•ã®åŠåˆ†ã®å€¤**ã‚’æŒ‡å®šã—ã¦ãã ã•ã„ï¼š

```typescript
// âŒ ç›´æ„Ÿçš„ãªæŒ‡å®šï¼ˆæœŸå¾…é€šã‚Šã«å‹•ä½œã—ãªã„ï¼‰
lineHeight: 1.0  // å®Ÿéš›ã«ã¯2è¡Œåˆ†ã®é–“éš”ã«ãªã‚‹
lineHeight: 1.5  // å®Ÿéš›ã«ã¯3è¡Œåˆ†ã®é–“éš”ã«ãªã‚‹

// âœ… æš«å®šå¯¾å¿œï¼ˆæœŸå¾…é€šã‚Šã®é–“éš”ã‚’å¾—ã‚‹ï¼‰
lineHeight: 0.5  // 1è¡Œåˆ†ã®é–“éš”ã‚’å¾—ã‚‹
lineHeight: 0.75 // 1.5è¡Œåˆ†ã®é–“éš”ã‚’å¾—ã‚‹
lineHeight: 1.0  // 2è¡Œåˆ†ã®é–“éš”ã‚’å¾—ã‚‹
```

#### å¯¾è±¡ãƒ¢ãƒ¼ãƒ‰

- `WordDisplayMode.INDIVIDUAL_WORD_ENTRANCE_NEW_LINE`
- `WordDisplayMode.PHRASE_CUMULATIVE_NEW_LINE`

### ğŸ”´ wordDisplayModeå®Ÿè£…æ™‚ã®é‡è¦ãªæ³¨æ„äº‹é …ï¼ˆ2025-01-24è¿½åŠ ï¼‰

**å•é¡Œ**: `FlexibleCumulativeLayoutPrimitive`ã‚’ä½¿ç”¨ã™ã‚‹éš›ã€å˜èªé–“ã®Xã‚ªãƒ•ã‚»ãƒƒãƒˆãŒæ­£ã—ãé©ç”¨ã•ã‚Œãªã„å ´åˆãŒã‚ã‚Šã¾ã™ã€‚

**åŸå› ã¨å¯¾ç­–**:

#### 1. ãƒ—ãƒªãƒŸãƒ†ã‚£ãƒ–ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã®ç‹¬ç«‹å‡¦ç†

```typescript
// âš ï¸ å•é¡Œã®ã‚ã‚‹å®Ÿè£…ï¼ˆå„å˜èªã§æ–°ã—ã„ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ï¼‰
renderWordContainer() {
  const layoutPrimitive = new FlexibleCumulativeLayoutPrimitive();
  // å„å˜èªå‡¦ç†æ™‚ã«æ–°ã—ã„ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ãŒä½œæˆã•ã‚Œã€ç´¯ç©ã‚ªãƒ•ã‚»ãƒƒãƒˆãŒãƒªã‚»ãƒƒãƒˆã•ã‚Œã‚‹
}
```

ãƒ—ãƒªãƒŸãƒ†ã‚£ãƒ–ã¯å†…éƒ¨ã§**ã‚³ãƒ³ãƒ†ãƒŠIDã‹ã‚‰å˜èªã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹ã‚’æŠ½å‡º**ã—ã€è‡ªå‹•çš„ã«ç´¯ç©ã‚ªãƒ•ã‚»ãƒƒãƒˆã‚’è¨ˆç®—ã—ã¾ã™ãŒã€æ­£ç¢ºæ€§ã«é™ç•ŒãŒã‚ã‚Šã¾ã™ã€‚

#### 2. CharUnit[]ã‹ã‚‰FlexibleCharacterData[]ã¸ã®å¤‰æ›ï¼ˆå¿…é ˆï¼‰

```typescript
// âœ… æ­£ã—ã„å¤‰æ›å®Ÿè£…
const rawCharsData = params.chars as CharUnit[];
const currentWordIndex = params.wordIndex as number || 0;

const charsData: FlexibleCharacterData[] = rawCharsData.map((char, index) => ({
  id: char.id,
  char: char.char,
  start: char.start,
  end: char.end,
  charIndexInWord: index,
  charIndex: char.charIndex || index,
  wordIndex: currentWordIndex,  // âš ï¸ å¿…é ˆï¼šã“ã‚ŒãŒãªã„ã¨å˜èªã‚°ãƒ«ãƒ¼ãƒ—åŒ–ãŒå¤±æ•—
  totalChars: char.totalChars || rawCharsData.length,
  totalWords: char.totalWords || 1
}));
```

#### 3. ã‚³ãƒ³ãƒ†ãƒŠIDå½¢å¼ã®ç¶­æŒ

ãƒ—ãƒªãƒŸãƒ†ã‚£ãƒ–ãŒå˜èªã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹ã‚’æŠ½å‡ºã§ãã‚‹ã‚ˆã†ã€ã‚³ãƒ³ãƒ†ãƒŠIDã¯å¿…ãšä»¥ä¸‹ã®å½¢å¼ã‚’ç¶­æŒã—ã¦ãã ã•ã„ï¼š
- ãƒ•ãƒ¬ãƒ¼ã‚º: `phrase_0`
- å˜èª: `phrase_0_word_2`  
- æ–‡å­—: `phrase_0_word_2_char_1`

#### æ³¨æ„äº‹é …

- åŒä¸€è¡Œãƒ¢ãƒ¼ãƒ‰ï¼ˆ`SAME_LINE`ï¼‰ã§ã¯é€šå¸¸é€šã‚Šå‹•ä½œã—ã¾ã™
- å°†æ¥ã®ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã§ä¿®æ­£äºˆå®šã®ãŸã‚ã€ä¿®æ­£å¾Œã¯è¨­å®šå€¤ã®å†èª¿æ•´ãŒå¿…è¦ã§ã™
- è©³ç´°ã¯[known-issues.md](./known-issues.md#line-height-001-lineheight-parameter-double-scaling-in-new_line-modes)ã‚’å‚ç…§

---

## ğŸ¯ ç”»é¢ä¸­å¿ƒé…ç½®ã®æ¨™æº–ä»•æ§˜ï¼ˆv0.4.3æ¨™æº–ï¼‰

### æ¦‚è¦

**ã™ã¹ã¦ã®ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã¯ç”»é¢ä¸­å¿ƒã‚’åŸºæº–ã¨ã—ãŸé…ç½®ã‚’ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã¨ã—ã€`phraseOffsetX`ã¨`phraseOffsetY`ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã§èª¿æ•´å¯èƒ½ã«ã™ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚** ã“ã‚Œã¯UTAVISTAã®æ¨™æº–ä»•æ§˜ã§ã‚ã‚Šã€ãƒ¦ãƒ¼ã‚¶ãƒ“ãƒªãƒ†ã‚£ã¨ä¸€è²«æ€§ã‚’ç¢ºä¿ã™ã‚‹ãŸã‚ã®é‡è¦ãªè¦ä»¶ã§ã™ã€‚

### wordOffsetXçµ±åˆå®Ÿè£…ã‚¬ã‚¤ãƒ‰ãƒ©ã‚¤ãƒ³ï¼ˆv0.5.1é‡è¦è¿½åŠ ï¼‰

#### ğŸš¨ CRITICAL: wordOffsetXäºŒé‡é©ç”¨ã®é˜²æ­¢

wordOffsetXãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã‚’ä½¿ç”¨ã™ã‚‹éš›ã¯ã€**ãƒ•ãƒ¬ãƒ¼ã‚ºã‚³ãƒ³ãƒ†ãƒŠãƒ¬ãƒ™ãƒ«ã§ä¸€åº¦ã ã‘é©ç”¨**ã—ã€ãƒ†ã‚­ã‚¹ãƒˆã¨ã‚°ãƒ©ãƒ•ã‚£ãƒƒã‚¯è¦ç´ ãŒçµ±åˆã—ã¦ç§»å‹•ã™ã‚‹ã‚ˆã†å®Ÿè£…ã™ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚

```typescript
// âœ… æ­£ã—ã„å®Ÿè£…: ãƒ•ãƒ¬ãƒ¼ã‚ºãƒ¬ãƒ™ãƒ«ã§ã®wordOffsetXçµ±åˆ
renderPhraseContainer(container, params, nowMs, startMs, endMs, phase) {
  // wordOffsetXã‚’phraseOffsetXã«çµ±åˆ
  const baseOffsetX = params.phraseOffsetX as number || 0;
  const wordOffsetX = params.wordOffsetX as number || 0;
  const combinedOffsetX = baseOffsetX + wordOffsetX;
  
  // SlideAnimationPrimitiveã§çµ±åˆä½ç½®ã‚’è¨ˆç®—
  const phraseResult = slideAnimationPrimitive.calculatePhrasePosition({
    phraseOffsetX: combinedOffsetX,  // çµ±åˆã‚ªãƒ•ã‚»ãƒƒãƒˆ
    phraseOffsetY: params.phraseOffsetY as number || 0,
    // ... ãã®ä»–ã®ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿
  });
  
  // ãƒ•ãƒ¬ãƒ¼ã‚ºã‚³ãƒ³ãƒ†ãƒŠã«çµ±åˆä½ç½®ã‚’é©ç”¨
  container.position.set(phraseResult.x, phraseResult.y);
}

// ã‚°ãƒ©ãƒ•ã‚£ãƒƒã‚¯ã‚³ãƒ³ãƒ†ãƒŠã¯ç›¸å¯¾é…ç½®ï¼ˆwordOffsetXé©ç”¨ã—ãªã„ï¼‰
manageGraphicsContainers(phraseContainer, params) {
  blackBandContainer.position.x = 0;  // é‡è¦: å€‹åˆ¥é©ç”¨ã—ãªã„
}

// å˜èªã‚³ãƒ³ãƒ†ãƒŠã‚‚FlexibleCumulativeLayoutPrimitiveã«å§”è­²
renderWordContainer(container, params) {
  // wordOffsetXã®å€‹åˆ¥é©ç”¨ã¯è¡Œã‚ãªã„
  // FlexibleCumulativeLayoutPrimitiveãŒç›¸å¯¾ä½ç½®ã‚’è¨ˆç®—
}
```

#### åº§æ¨™ç³»çµ±åˆã®é‡è¦æ€§

- **å•é¡Œ**: ç•°ãªã‚‹ã‚³ãƒ³ãƒ†ãƒŠãƒ¬ãƒ™ãƒ«ã§å€‹åˆ¥ã«wordOffsetXã‚’é©ç”¨ã™ã‚‹ã¨ã€ãƒ†ã‚­ã‚¹ãƒˆã¨ã‚°ãƒ©ãƒ•ã‚£ãƒƒã‚¯ãŒç•°ãªã‚‹ã‚¹ã‚±ãƒ¼ãƒ«ã§ç§»å‹•ã—ã€è¦–è¦šçš„ãªä¸æ•´åˆãŒç™ºç”Ÿ
- **è§£æ±º**: ãƒ•ãƒ¬ãƒ¼ã‚ºã‚³ãƒ³ãƒ†ãƒŠãƒ¬ãƒ™ãƒ«ã§ã®çµ±åˆã«ã‚ˆã‚Šã€å…¨å­è¦ç´ ãŒåŒã˜åº§æ¨™ç³»ã§ç§»å‹•
- **åŠ¹æœ**: ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒwordOffsetXã‚’å¤‰æ›´ã—ãŸéš›ã€ãƒ†ã‚­ã‚¹ãƒˆã¨èƒŒæ™¯è¦ç´ ï¼ˆé»’å¸¯ãªã©ï¼‰ãŒå®Œå…¨ã«ä¸€ä½“ã¨ã—ã¦ç§»å‹•

### æ¨™æº–ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿

```typescript
// æ¨™æº–ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ï¼ˆParameterRegistryã«ç™»éŒ²æ¸ˆã¿ï¼‰
phraseOffsetX: number  // ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆ: 0, ç¯„å›²: -500ã€œ500
phraseOffsetY: number  // ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆ: 0, ç¯„å›²: -500ã€œ500
```

### å®Ÿè£…æ–¹æ³•

#### 1. ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿å®šç¾©

```typescript
getParameterConfig(): ParameterConfig[] {
  return [
    // ç”»é¢ä¸­å¿ƒã‹ã‚‰ã®ã‚ªãƒ•ã‚»ãƒƒãƒˆï¼ˆæ¨™æº–ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ï¼‰
    { name: "phraseOffsetX", type: "number", default: 0, min: -500, max: 500, step: 10 },
    { name: "phraseOffsetY", type: "number", default: 0, min: -500, max: 500, step: 10 },
    // ãã®ä»–ã®ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿...
  ];
}
```

#### 2. ãƒ•ãƒ¬ãƒ¼ã‚ºã‚³ãƒ³ãƒ†ãƒŠã§ã®ä½ç½®è¨ˆç®—

```typescript
renderPhraseContainer(
  container: PIXI.Container,
  text: string,
  params: Record<string, unknown>,
  // ... ãã®ä»–ã®å¼•æ•°
): boolean {
  // ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã‚µã‚¤ã‚ºã®å–å¾—
  const app = (window as any).__PIXI_APP__;
  if (app && app.renderer) {
    const screenWidth = app.renderer.width;
    const screenHeight = app.renderer.height;
    
    // ç”»é¢ä¸­å¿ƒã‚’åŸºæº–ã«ã‚ªãƒ•ã‚»ãƒƒãƒˆã‚’é©ç”¨
    const baseX = screenWidth / 2 + (params.phraseOffsetX as number || 0);
    const baseY = screenHeight / 2 + (params.phraseOffsetY as number || 0);
    
    // ã•ã‚‰ã«ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆå›ºæœ‰ã®ä½ç½®è¨ˆç®—ã‚’åŠ ç®—
    container.position.set(baseX + specificX, baseY + specificY);
  }
  
  return true;
}
```

#### 3. SlideAnimationPrimitiveã‚’ä½¿ç”¨ã™ã‚‹å ´åˆ

```typescript
const phraseResult = slideAnimationPrimitive.calculatePhrasePosition({
  phraseOffsetX: params.phraseOffsetX as number || 0,
  phraseOffsetY: params.phraseOffsetY as number || 0,
  // ãã®ä»–ã®ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿...
});

// ç”»é¢ä¸­å¿ƒã‚’åŸºæº–ã«èª¿æ•´
if (app && app.renderer) {
  container.position.set(
    app.renderer.width / 2 + phraseResult.x,
    app.renderer.height / 2 + phraseResult.y
  );
}
```

### è¨­è¨ˆåŸå‰‡

1. **ä¸€è²«æ€§**: ã™ã¹ã¦ã®ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã§åŒã˜åŸºæº–ç‚¹ï¼ˆç”»é¢ä¸­å¿ƒï¼‰ã‚’ä½¿ç”¨
2. **èª¿æ•´å¯èƒ½æ€§**: ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã§ä½ç½®ã‚’å¾®èª¿æ•´å¯èƒ½
3. **äºˆæ¸¬å¯èƒ½æ€§**: ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆå€¤ï¼ˆ0,0ï¼‰ã§ç”»é¢ä¸­å¿ƒã«é…ç½®
4. **äº’æ›æ€§**: æ—¢å­˜ã®ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã¨åŒã˜ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿åã‚’ä½¿ç”¨

### ã‚ˆãã‚ã‚‹å®Ÿè£…ãƒ‘ã‚¿ãƒ¼ãƒ³

#### ãƒ‘ã‚¿ãƒ¼ãƒ³1: é™çš„é…ç½®

```typescript
// ã‚·ãƒ³ãƒ—ãƒ«ãªä¸­å¿ƒé…ç½®
const centerX = screenWidth / 2 + (params.phraseOffsetX as number || 0);
const centerY = screenHeight / 2 + (params.phraseOffsetY as number || 0);
container.position.set(centerX, centerY);
```

#### ãƒ‘ã‚¿ãƒ¼ãƒ³2: ãƒ©ãƒ³ãƒ€ãƒ é…ç½®ã¨ã®çµ„ã¿åˆã‚ã›

```typescript
// ãƒ©ãƒ³ãƒ€ãƒ é…ç½®ã§ã‚‚ç”»é¢ä¸­å¿ƒã‚’åŸºæº–ã«
const randomX = (Math.random() - 0.5) * randomRangeX;
const randomY = (Math.random() - 0.5) * randomRangeY;

const finalX = screenWidth / 2 + (params.phraseOffsetX as number || 0) + randomX;
const finalY = screenHeight / 2 + (params.phraseOffsetY as number || 0) + randomY;
```

#### ãƒ‘ã‚¿ãƒ¼ãƒ³3: æ®µçµ„ã¿é…ç½®

```typescript
// æ®µçµ„ã¿ã§ã‚‚ç”»é¢ä¸­å¿ƒã‚’åŸºæº–ã«
const lineY = (lineNumber - totalLines / 2) * lineSpacing;
const finalY = screenHeight / 2 + (params.phraseOffsetY as number || 0) + lineY;
```

---

## ğŸš¨ æ–‡å­—é‡è¤‡è¡¨ç¤ºé˜²æ­¢ã‚¬ã‚¤ãƒ‰ï¼ˆv2.1æ–°æ©Ÿèƒ½ï¼‰

**UTAVISTA v2.1ã§ã¯ã€æ–‡å­—ã‚³ãƒ³ãƒ†ãƒŠã®é‡è¤‡ä½œæˆã«ã‚ˆã‚‹è¡¨ç¤ºä¸å…·åˆã‚’é˜²æ­¢ã™ã‚‹å®‰å…¨æ©Ÿèƒ½ãŒè¿½åŠ ã•ã‚Œã¾ã—ãŸã€‚**

### æ–‡å­—é‡è¤‡è¡¨ç¤ºå•é¡Œã¨ã¯

æ–‡å­—é‡è¤‡è¡¨ç¤ºå•é¡Œã¯ã€åŒä¸€ã®æ–‡å­—ã«å¯¾ã—ã¦è¤‡æ•°ã®ã‚³ãƒ³ãƒ†ãƒŠãŒä½œæˆã•ã‚Œã€æ–‡å­—ãŒé‡ãªã£ã¦è¡¨ç¤ºã•ã‚Œã‚‹ç¾è±¡ã§ã™ï¼š

```
é€šå¸¸ã®è¡¨ç¤º:  ã‚  ã„  ã†  ãˆ  ãŠ
é‡è¤‡æ™‚ã®è¡¨ç¤º: ã‚ã‚ã‚ ã„ã„ã„ ã†ã†ã†ãˆãˆãˆ ãŠãŠãŠ ï¼ˆæ–‡å­—ãŒé‡ãªã£ã¦è¦‹ãˆã‚‹ï¼‰
```

### ç™ºç”ŸåŸå› ã¨å¯¾ç­–

#### 1. ä¸»ãªç™ºç”ŸåŸå› 

```typescript
// âŒ å±é™º: ãƒ—ãƒªãƒŸãƒ†ã‚£ãƒ–ã¨æ—¢å­˜ã‚·ã‚¹ãƒ†ãƒ ã®ä¸¡æ–¹ã§ã‚³ãƒ³ãƒ†ãƒŠä½œæˆ
layoutPrimitive.manageCharacterContainers(wordContainer, params);  // ã‚³ãƒ³ãƒ†ãƒŠä½œæˆâ‘ 
// åŒæ™‚ã«
params.chars.forEach(charData => {
  const charContainer = new PIXI.Container();  // ã‚³ãƒ³ãƒ†ãƒŠä½œæˆâ‘¡ â†’ é‡è¤‡!
});
```

#### 2. å®‰å…¨ãªå®Ÿè£…ãƒ‘ã‚¿ãƒ¼ãƒ³

```typescript
// âœ… æ¨å¥¨: å˜ä¸€è²¬ä»»ã§ã®ã‚³ãƒ³ãƒ†ãƒŠç®¡ç†
if (params.chars && Array.isArray(params.chars)) {
  // æ—¢å­˜ã‚·ã‚¹ãƒ†ãƒ ã®ã¿ã§ã‚³ãƒ³ãƒ†ãƒŠç®¡ç†
  params.chars.forEach((charData: any, index: number) => {
    let charContainer: PIXI.Container | null = null;
    
    // æ—¢å­˜ã‚³ãƒ³ãƒ†ãƒŠæ¤œç´¢
    container.children.forEach((child: any) => {
      if (child instanceof PIXI.Container && 
          (child as any).name === `char_container_${charData.id}`) {
        charContainer = child as PIXI.Container;
      }
    });
    
    // æ–°è¦ä½œæˆï¼ˆå¿…è¦æ™‚ã®ã¿ï¼‰
    if (!charContainer) {
      charContainer = new PIXI.Container();
      (charContainer as any).name = `char_container_${charData.id}`;
      container.addChild(charContainer);
    }
    
    // ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆè¨ˆç®—ã¯ãƒ—ãƒªãƒŸãƒ†ã‚£ãƒ–ã«å§”è­²
    const layoutResult = layoutPrimitive.calculatePositionOnly(charData);
    charContainer.position.set(layoutResult.x, layoutResult.y);
  });
}
```

### å®‰å…¨æ©Ÿèƒ½ã®ä½¿ç”¨æ–¹æ³•

#### SafeCharacterManager ã®æ´»ç”¨

```typescript
import { SafeCharacterManager, CharacterManagementMode } from '../primitives/safe/SafeCharacterManager';

// å®‰å…¨ãªæ–‡å­—ç®¡ç†ã®è¨­å®š
const safeManager = new SafeCharacterManager({
  mode: CharacterManagementMode.COOPERATIVE,
  containerPrefix: 'char_container_',
  layoutParams: {
    fontSize: params.fontSize || 32,
    charSpacing: params.charSpacing || 1.0,
    halfWidthSpacingRatio: 0.6,
    alignment: 'left'
  },
  enableSafetyChecks: true,
  enableDebugLogs: process.env.NODE_ENV === 'development'
});

// å®‰å…¨ãªæ–‡å­—ç®¡ç†å®Ÿè¡Œ
const result = safeManager.manageCharacters(
  wordContainer,
  text,
  characters,
  (charContainer, charData, position) => {
    // ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³å‡¦ç†
    this.renderCharContainer(charContainer, charData.char, params, nowMs, startMs, endMs, phase);
  }
);

if (!result.success) {
  console.error('æ–‡å­—ç®¡ç†ã‚¨ãƒ©ãƒ¼:', result.warnings);
}
```

#### CharacterOverlapDetector ã«ã‚ˆã‚‹é–‹ç™ºæ™‚æ¤œè¨¼

```typescript
import { CharacterOverlapDetector } from '../primitives/safe/CharacterOverlapDetector';

// é–‹ç™ºæ™‚è‡ªå‹•ãƒã‚§ãƒƒã‚¯
if (process.env.NODE_ENV === 'development') {
  CharacterOverlapDetector.autoCheck(wordContainer);
}
```

---

## âš¡ ãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°æœ€é©åŒ–å®Ÿè£…ï¼ˆv0.5.0æ–°æ©Ÿèƒ½ï¼‰

**UTAVISTA v0.5.0ã§ã¯ã€å¤§è¦æ¨¡ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã§ã®UIå¿œç­”æ€§ã‚’å‘ä¸Šã•ã›ã‚‹ãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°æœ€é©åŒ–æ©Ÿèƒ½ãŒè¿½åŠ ã•ã‚Œã¾ã—ãŸã€‚**

### ãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã‚·ã‚¹ãƒ†ãƒ 

ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿å¤‰æ›´æ™‚ã®UIå›ºã¾ã‚Šã‚’é˜²æ­¢ã™ã‚‹ãŸã‚ã€æ–‡å­—ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã®ã‚­ãƒ£ãƒƒã‚·ãƒ¥æ©Ÿèƒ½ã‚’å®Ÿè£…ã§ãã¾ã™ã€‚

#### 1. åŸºæœ¬å®Ÿè£…ãƒ‘ã‚¿ãƒ¼ãƒ³

```typescript
export class OptimizedTemplate implements IAnimationTemplate {
  // ãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°ã‚­ãƒ£ãƒƒã‚·ãƒ¥
  private renderCache = new Map<string, {
    textObject: PIXI.Text;
    lastParams: string;
    lastPhase: AnimationPhase;
    lastNowMs: number;
  }>();

  renderCharContainer(
    container: PIXI.Container,
    text: string,
    params: Record<string, unknown>,
    nowMs: number,
    startMs: number,
    endMs: number,
    phase: AnimationPhase,
    hierarchyType: HierarchyType
  ): boolean {
    
    // 1. ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã‚­ãƒ¼ã‚’ç”Ÿæˆ
    const cacheKey = `${container.name || 'unknown'}_${text}`;
    
    // 2. ãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°ã«å½±éŸ¿ã™ã‚‹ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã®ã¿ã§ãƒãƒƒã‚·ãƒ¥ç”Ÿæˆ
    const relevantParams = {
      fontSize: params.fontSize,
      fontFamily: params.fontFamily,
      textColor: params.textColor,
      enableGlow: params.enableGlow,
      glowStrength: params.glowStrength,
      // å¿…è¦ã«å¿œã˜ã¦ä»–ã®ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã‚’è¿½åŠ 
    };
    const paramsHash = JSON.stringify(relevantParams);
    
    // 3. ã‚­ãƒ£ãƒƒã‚·ãƒ¥ãƒã‚§ãƒƒã‚¯
    const cached = this.renderCache.get(cacheKey);
    if (cached && 
        cached.lastParams === paramsHash && 
        cached.lastPhase === phase &&
        Math.abs(cached.lastNowMs - nowMs) < 50) { // 50msä»¥å†…ã®æ™‚é–“å·®ã¯ç„¡è¦–
      
      // ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã•ã‚ŒãŸãƒ†ã‚­ã‚¹ãƒˆã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã‚’ä½¿ç”¨
      if (container.children.length === 0) {
        container.addChild(cached.textObject);
      }
      return true;
    }
    
    // 4. æ–°ã—ã„ãƒ†ã‚­ã‚¹ãƒˆã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã‚’ä½œæˆ
    container.removeChildren();
    const textObj = new PIXI.Text(text, textStyle);
    container.addChild(textObj);
    
    // 5. ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã«ä¿å­˜
    this.renderCache.set(cacheKey, {
      textObject: textObj,
      lastParams: paramsHash,
      lastPhase: phase,
      lastNowMs: nowMs
    });
    
    return true;
  }

  // 6. ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã‚¯ãƒªã‚¢ï¼ˆremoveVisualElementsã§å®Ÿè¡Œï¼‰
  removeVisualElements(container: PIXI.Container): void {
    // é€šå¸¸ã®ã‚¯ãƒªãƒ¼ãƒ³ã‚¢ãƒƒãƒ—å‡¦ç†...
    
    // ãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã‚’ã‚¯ãƒªã‚¢
    this.renderCache.clear();
  }
}
```

#### 2. ã‚­ãƒ£ãƒƒã‚·ãƒ¥æœ€é©åŒ–ã®ãƒã‚¤ãƒ³ãƒˆ

- **ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ãƒãƒƒã‚·ãƒ¥**: è¦–è¦šã«å½±éŸ¿ã—ãªã„ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã¯é™¤å¤–
- **æ™‚é–“é–¾å€¤**: 50msä»¥å†…ã®æ™‚é–“å¤‰å‹•ã¯ã‚­ãƒ£ãƒƒã‚·ãƒ¥ãƒ’ãƒƒãƒˆ
- **ãƒ•ã‚§ãƒ¼ã‚ºç®¡ç†**: ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ãƒ•ã‚§ãƒ¼ã‚ºå¤‰æ›´æ™‚ã¯æ–°è¦ä½œæˆ
- **ãƒ¡ãƒ¢ãƒªç®¡ç†**: `removeVisualElements`ã§ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã‚¯ãƒªã‚¢

#### 3. ãƒ“ãƒ¥ãƒ¼ãƒãƒ¼ãƒˆæœ€é©åŒ–

ã‚¨ãƒ³ã‚¸ãƒ³ãƒ¬ãƒ™ãƒ«ã§è‡ªå‹•å®Ÿè£…ã•ã‚Œã‚‹æœ€é©åŒ–ï¼š

- **è¡¨ç¤ºç¯„å›²åˆ¤å®š**: ç¾åœ¨æ™‚åˆ»Â±2ç§’ã®ãƒ•ãƒ¬ãƒ¼ã‚ºã®ã¿åŒæœŸæ›´æ–°
- **éåŒæœŸå‡¦ç†**: è¡¨ç¤ºç¯„å›²å¤–ãƒ•ãƒ¬ãƒ¼ã‚ºã¯éåŒæœŸãƒãƒƒãƒå‡¦ç†
- **æ›´æ–°åˆ¶å¾¡**: `updateGlobalDefaultsSilent`ã«ã‚ˆã‚‹é€šçŸ¥ç„¡åŠ¹åŒ–

### ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹åŠ¹æœ

- **UIå¿œç­”æ€§**: ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿å¤‰æ›´æ™‚ã®å›ºã¾ã‚Šã‚’å¤§å¹…è»½æ¸›
- **ãƒ¡ãƒ¢ãƒªåŠ¹ç‡**: ä¸è¦ãªã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆç”Ÿæˆã‚’æŠ‘åˆ¶
- **ã‚¹ã‚±ãƒ¼ãƒ©ãƒ“ãƒªãƒ†ã‚£**: å¤§è¦æ¨¡ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã§ã‚‚å®‰å®šå‹•ä½œ

---

## ğŸ”§ ãƒ—ãƒªãƒŸãƒ†ã‚£ãƒ–ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ãƒ¡ãƒ³ãƒ†ãƒŠãƒ³ã‚¹ï¼ˆé‡è¦ï¼‰

### æ–°ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿è¿½åŠ æ™‚ã®å¿…é ˆåŒæœŸä½œæ¥­

**æœ€é‡è¦**: ãƒ—ãƒªãƒŸãƒ†ã‚£ãƒ–ã«æ–°ã—ã„ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã‚’è¿½åŠ ã—ãŸå ´åˆã€**ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆå´ã®å‘¼ã³å‡ºã—ç®‡æ‰€ã‚‚åŒæœŸæ›´æ–°**ãŒå¿…è¦ã§ã™ã€‚

#### ã‚ˆãã‚ã‚‹å®Ÿè£…ãƒŸã‚¹

```typescript
// âŒ å±é™º: æ–°ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ãŒæ¸¡ã•ã‚Œãªã„
private applySparkleEffectAfterLayout(...): void {
  const sparkleParams: SparkleEffectParams = {
    enableSparkle: params.enableSparkle,
    sparkleSize: params.sparkleSize,
    sparkleColor: params.sparkleColor,
    // enableTwinkle ãªã©ã®æ–°ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ãŒæ¼ã‚Œã¦ã„ã‚‹ï¼
  };
  sparklePrimitive.applyEffect(container, sparkleParams);
}
```

#### æ­£ã—ã„å®Ÿè£…ãƒ‘ã‚¿ãƒ¼ãƒ³

```typescript
// âœ… å®‰å…¨: å…¨ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã‚’æ˜ç¤ºçš„ã«æ¸¡ã™
private applySparkleEffectAfterLayout(...): void {
  const sparkleParams: SparkleEffectParams = {
    // åŸºæœ¬ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿
    enableSparkle: params.enableSparkle as boolean || false,
    sparkleSize: params.sparkleSize as number || 20,
    sparkleColor: params.sparkleColor as string || '#FFD700',
    
    // æ–°æ©Ÿèƒ½ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã‚‚å¿˜ã‚Œãšã«è¿½åŠ 
    enableTwinkle: params.enableTwinkle as boolean || false,
    twinkleFrequency: params.twinkleFrequency as number || 0.5,
    twinkleBrightness: params.twinkleBrightness as number || 2.5,
    twinkleDuration: params.twinkleDuration as number || 100,
    twinkleProbability: params.twinkleProbability as number || 0.3,
  };
  sparklePrimitive.applyEffect(container, sparkleParams);
}
```

#### ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿åŒæœŸãƒã‚§ãƒƒã‚¯ãƒªã‚¹ãƒˆ

ãƒ—ãƒªãƒŸãƒ†ã‚£ãƒ–ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿è¿½åŠ æ™‚ã¯ä»¥ä¸‹ã‚’ç¢ºèªï¼š

**1. ãƒ—ãƒªãƒŸãƒ†ã‚£ãƒ–å´ã®æ›´æ–°**
- [ ] ãƒ—ãƒªãƒŸãƒ†ã‚£ãƒ–ã®Paramsã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹ã«æ–°ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿è¿½åŠ 
- [ ] ãƒ—ãƒªãƒŸãƒ†ã‚£ãƒ–å†…ã§æ–°ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã‚’é©åˆ‡ã«å‡¦ç†

**2. ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆå´ã®æ›´æ–°**
- [ ] getParameterConfig()ã«æ–°ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿è¨­å®šã‚’è¿½åŠ 
- [ ] ãƒ—ãƒªãƒŸãƒ†ã‚£ãƒ–å‘¼ã³å‡ºã—ç®‡æ‰€ã§æ–°ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã‚’æ¸¡ã—ã¦ã„ã‚‹

**3. å‹ã‚·ã‚¹ãƒ†ãƒ ã®æ›´æ–°**
- [ ] StandardParameters.tsã«æ–°ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿è¿½åŠ ï¼ˆæ¨™æº–ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã®å ´åˆï¼‰
- [ ] ParameterRegistry.tsã«æ–°ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ç™»éŒ²

**4. å‹•ä½œç¢ºèª**
- [ ] `npm run validate-parameters` ãŒæˆåŠŸã™ã‚‹
- [ ] UIä¸Šã§æ–°ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ãŒæ­£ã—ãè¡¨ç¤ºãƒ»åˆ¶å¾¡ã§ãã‚‹
- [ ] æ–°ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ãŒå®Ÿéš›ã«åŠ¹æœã¨ã—ã¦åæ˜ ã•ã‚Œã‚‹

#### å®Ÿè£…äº‹ä¾‹: SparkleEffect Twinkleæ©Ÿèƒ½

```typescript
// PurePrimitiveWordSlideText.ts å†…ã®å®Ÿè£…ä¾‹
private applySparkleEffectAfterLayout(
  container: PIXI.Container,
  text: string,
  params: Record<string, unknown>,
  // ... ä»–ã®ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿
): void {
  const sparkleParams: SparkleEffectParams = {
    // æ—¢å­˜ã®å¿…é ˆãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿
    enableSparkle: (params.enableSparkle as boolean !== false), 
    sparkleCount: params.sparkleCount as number || 4,
    sparkleSize: params.sparkleSize as number || 20,
    // ... ä»–ã®æ—¢å­˜ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿
    
    // æ–°æ©Ÿèƒ½ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ç¾¤ï¼ˆè¿½åŠ æ™‚ã«å¿˜ã‚Œã‚„ã™ã„ï¼‰
    enableTwinkle: params.enableTwinkle as boolean || false,
    twinkleFrequency: params.twinkleFrequency as number || 0.5,
    twinkleBrightness: params.twinkleBrightness as number || 2.5,
    twinkleDuration: params.twinkleDuration as number || 100,
    twinkleProbability: params.twinkleProbability as number || 0.3,
  };
  
  sparklePrimitive.applyEffect(container, sparkleParams);
}
```

**é‡è¦**: TypeScriptå‹ã‚·ã‚¹ãƒ†ãƒ ã‚’æ´»ç”¨ã—ã€`SparkleEffectParams`ã®ã‚ˆã†ãªå‹æ³¨é‡ˆã‚’ä½¿ç”¨ã™ã‚‹ã“ã¨ã§ã€ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿æ¼ã‚Œã‚’æ—©æœŸç™ºè¦‹ã§ãã¾ã™ã€‚

---

## ğŸ“‹ å®‰å…¨ãªãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆå®Ÿè£…ãƒã‚§ãƒƒã‚¯ãƒªã‚¹ãƒˆï¼ˆv2.1ï¼‰

### ğŸ›¡ï¸ å¿…é ˆå®‰å…¨ãƒã‚§ãƒƒã‚¯

- [ ] **â— ã‚¿ã‚¤ãƒ ã‚¹ã‚¿ãƒ³ãƒ—ãƒ™ãƒ¼ã‚¹çŠ¶æ…‹ä¸€å…ƒç®¡ç†ã®å®Ÿè£…**
  - ã‚·ãƒ¼ã‚¯æ¤œå‡ºãƒ­ã‚¸ãƒƒã‚¯ã‚’å®Ÿè£…ã—ã¦ã„ãªã„ã“ã¨ã‚’ç¢ºèªï¼ˆç¦æ­¢ãƒ‘ã‚¿ãƒ¼ãƒ³ï¼‰
  - ã™ã¹ã¦ã®ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³çŠ¶æ…‹ã‚’ `nowMs`, `startMs`, `endMs` ã‹ã‚‰ç´”ç²‹è¨ˆç®—
  - å‰ãƒ•ãƒ¬ãƒ¼ãƒ çŠ¶æ…‹ã¸ã®ä¾å­˜ã‚’æ’é™¤ï¼ˆ`lastTimeState` ç­‰ã®ä½¿ç”¨ç¦æ­¢ï¼‰
  - é€šå¸¸å†ç”Ÿã¨ã‚·ãƒ¼ã‚¯æ“ä½œã§åŒä¸€ã®ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³å‹•ä½œã‚’ä¿è¨¼

- [ ] **æ–‡å­—ã‚³ãƒ³ãƒ†ãƒŠä½œæˆã¯å˜ä¸€è²¬ä»»ã§å®Ÿè£…**
  - ãƒ—ãƒªãƒŸãƒ†ã‚£ãƒ–ã¾ãŸã¯æ—¢å­˜ã‚·ã‚¹ãƒ†ãƒ ã®ã©ã¡ã‚‰ã‹ä¸€æ–¹ã®ã¿ã‚’ä½¿ç”¨
  - ä¸¡æ–¹ã‚’åŒæ™‚ä½¿ç”¨ã—ã¦ã„ãªã„ã“ã¨ã‚’ç¢ºèª

- [ ] **SafeCharacterManager ã®ä½¿ç”¨ã‚’æ¤œè¨**
  - è¤‡é›‘ãªæ–‡å­—ç®¡ç†ãŒå¿…è¦ãªå ´åˆã¯å®‰å…¨æ©Ÿèƒ½ã‚’æ´»ç”¨
  - é©åˆ‡ãª CharacterManagementMode ã‚’é¸æŠ

- [ ] **é–‹ç™ºæ™‚æ¤œè¨¼ã®æœ‰åŠ¹åŒ–**
  - CharacterOverlapDetector.autoCheck() ã‚’å‘¼ã³å‡ºã—
  - é–‹ç™ºç’°å¢ƒã§ã®ã¿å®Ÿè¡Œã•ã‚Œã‚‹ã“ã¨ã‚’ç¢ºèª

- [ ] **ImprovedCumulativeLayoutPrimitive ã®ä½¿ç”¨**
  - calculateLayoutOnly() ã‚’ä½¿ç”¨ã—ã¦ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆè¨ˆç®—ã®ã¿å®Ÿè¡Œ
  - executeWithinHierarchy() ã¯ä½¿ç”¨ç¦æ­¢

### ğŸ§ª ãƒ†ã‚¹ãƒˆãƒ»æ¤œè¨¼é …ç›®

- [ ] **æ–‡å­—è¡¨ç¤ºã®ç¢ºèª**
  - å„æ–‡å­—ãŒä¸€åº¦ã ã‘è¡¨ç¤ºã•ã‚Œã‚‹ã“ã¨
  - æ–‡å­—ã®ä½ç½®ãŒæ­£ç¢ºã«è¨ˆç®—ã•ã‚Œã¦ã„ã‚‹ã“ã¨

- [ ] **é‡è¤‡æ¤œå‡ºãƒ†ã‚¹ãƒˆ**
  - é–‹ç™ºç’°å¢ƒã§ CharacterOverlapDetector ãŒæ­£å¸¸ã«å‹•ä½œ
  - é‡è¤‡ãŒæ¤œå‡ºã•ã‚ŒãŸå ´åˆã®é©åˆ‡ãªã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸

- [ ] **ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ãƒ†ã‚¹ãƒˆ**
  - æ–‡å­—æ•°ãŒå¤šã„å ´åˆã®å‡¦ç†é€Ÿåº¦
  - ãƒ¡ãƒ¢ãƒªä½¿ç”¨é‡ã®ç¢ºèª

### ğŸ” ã‚³ãƒ¼ãƒ‰ãƒ¬ãƒ“ãƒ¥ãƒ¼ãƒã‚¤ãƒ³ãƒˆ

- [ ] **ã‚³ãƒ³ãƒ†ãƒŠåã®ä¸€è²«æ€§**
  - æ–‡å­—ã‚³ãƒ³ãƒ†ãƒŠã®å‘½åè¦å‰‡ãŒçµ±ä¸€ã•ã‚Œã¦ã„ã‚‹
  - é‡è¤‡ã—ãªã„ãƒ¦ãƒ‹ãƒ¼ã‚¯ãªåå‰ãŒä»˜ã‘ã‚‰ã‚Œã¦ã„ã‚‹

- [ ] **ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°**
  - å®‰å…¨æ©Ÿèƒ½ã®ã‚¨ãƒ©ãƒ¼ãŒé©åˆ‡ã«å‡¦ç†ã•ã‚Œã¦ã„ã‚‹
  - ãƒ¦ãƒ¼ã‚¶ãƒ¼ã¸ã®é©åˆ‡ãªãƒ•ã‚£ãƒ¼ãƒ‰ãƒãƒƒã‚¯

- [ ] **ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆè¨˜è¼‰**
  - ä½¿ç”¨ã—ã¦ã„ã‚‹å®‰å…¨æ©Ÿèƒ½ã®è¨˜è¼‰
  - å®Ÿè£…æ™‚ã®æ³¨æ„ç‚¹ã®æ˜è¨˜

---

## å‰æçŸ¥è­˜ã¨æº–å‚™

### å¿…è¦ãªçŸ¥è­˜

1. **PIXI.js ã®åŸºæœ¬æ¦‚å¿µ**
   - Container, Graphics, Text ã®ä½¿ã„æ–¹
   - è¦ªå­é–¢ä¿‚ã¨ãƒ­ãƒ¼ã‚«ãƒ«/ã‚°ãƒ­ãƒ¼ãƒãƒ«åº§æ¨™
   - ã‚¤ãƒ™ãƒ³ãƒˆã‚·ã‚¹ãƒ†ãƒ ã¨ãƒ©ã‚¤ãƒ•ã‚µã‚¤ã‚¯ãƒ«

2. **UTAVISTA ã®éšå±¤ã‚·ã‚¹ãƒ†ãƒ **
   - éšå±¤æ§‹é€ ï¼šãƒ•ãƒ¬ãƒ¼ã‚º > å˜èª > æ–‡å­—
   - ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆç¶™æ‰¿ï¼šè¦ªã‹ã‚‰å­ã¸ã®è‡ªå‹•ç¶™æ‰¿
   - ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ç®¡ç†ï¼šéšå±¤çš„ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã‚ªãƒ¼ãƒãƒ¼ãƒ©ã‚¤ãƒ‰
   - ä¸€æ‹¬æ“ä½œï¼šè¤‡æ•°ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã¸ã®åŒæ™‚é©ç”¨

3. **å®Ÿè£…æ¸ˆã¿ã‚·ã‚¹ãƒ†ãƒ ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ**
   - `TemplateManager`: ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆç®¡ç†ã¨å‰²ã‚Šå½“ã¦
   - `ParameterManagerV2`: éšå±¤çš„ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ç®¡ç†
   - `ParameterRegistry`: ä¸€å…ƒåŒ–ã•ã‚ŒãŸãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ç™»éŒ²ã¨æ¤œè¨¼ã‚·ã‚¹ãƒ†ãƒ 
   - `ProjectStateManager`: çŠ¶æ…‹ä¿å­˜ã¨Undo/Redoæ©Ÿèƒ½
   - `templateRegistry`: ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆä¸­å¤®ç™»éŒ²

### æº–å‚™ã™ã‚‹è¦ç´ 

1. **å‹å®šç¾©ã®ç†è§£**
   ```typescript
   interface IAnimationTemplate {
     metadata?: {
       license?: string;
       licenseUrl?: string;
       originalAuthor?: string;
     };
     
     // å¿…é ˆãƒ¡ã‚½ãƒƒãƒ‰
     animateContainer(container: PIXI.Container, text: string, params: StandardParameters, 
                     nowMs: number, startMs: number, endMs: number, 
                     hierarchyType: HierarchyType, phase: AnimationPhase): boolean;
     
     // éšå±¤åˆ¥ãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°ãƒ¡ã‚½ãƒƒãƒ‰
     renderPhraseContainer(container: PIXI.Container, text: string, params: StandardParameters, 
                          nowMs: number, startMs: number, endMs: number, phase: AnimationPhase): boolean;
     renderWordContainer(container: PIXI.Container, text: string, params: StandardParameters, 
                        nowMs: number, startMs: number, endMs: number, phase: AnimationPhase): boolean;
     renderCharContainer(container: PIXI.Container, text: string, params: StandardParameters, 
                        nowMs: number, startMs: number, endMs: number, phase: AnimationPhase): boolean;
     
     // å¿…é ˆã‚¯ãƒªãƒ¼ãƒ³ã‚¢ãƒƒãƒ—ãƒ¡ã‚½ãƒƒãƒ‰
     removeVisualElements(container: PIXI.Container): void;
     
     // éæ¨å¥¨: v0.4.3ã§ã¯ParameterRegistryã‚’ä½¿ç”¨
     getParameterConfig(): ParameterConfig[]; // ãƒ¬ã‚¬ã‚·ãƒ¼ã‚µãƒãƒ¼ãƒˆã®ã¿
   }
   ```

2. **éšå±¤ç¶™æ‰¿ã‚·ã‚¹ãƒ†ãƒ ã®ç†è§£**
   ```typescript
   // å®Ÿéš›ã®ç¶™æ‰¿ä¾‹
   phrase_0: "MultiLineText"           // ãƒ•ãƒ¬ãƒ¼ã‚ºãƒ¬ãƒ™ãƒ«è¨­å®š
     â””â”€â”€ phrase_0_word_1: (ç¶™æ‰¿)        // è‡ªå‹•ç¶™æ‰¿
         â””â”€â”€ phrase_0_word_1_char_2: (ç¶™æ‰¿)  // è‡ªå‹•ç¶™æ‰¿
   
   phrase_1: "FlickerFadeTemplate"     // åˆ¥ãƒ•ãƒ¬ãƒ¼ã‚º
     â””â”€â”€ phrase_1_word_0: "CustomTemplate"  // ã‚ªãƒ¼ãƒãƒ¼ãƒ©ã‚¤ãƒ‰
         â””â”€â”€ phrase_1_word_0_char_0: (ç¶™æ‰¿)    // CustomTemplateã‚’ç¶™æ‰¿
   ```

---

## ç¾è¡Œã‚·ã‚¹ãƒ†ãƒ ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£ã®ç†è§£

### ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆå‰²ã‚Šå½“ã¦ã‚·ã‚¹ãƒ†ãƒ 

```typescript
// Engine.ts ã§ã®ä½¿ç”¨ä¾‹
engine.assignTemplate('phrase_0', 'MultiLineText');  // ãƒ•ãƒ¬ãƒ¼ã‚ºãƒ¬ãƒ™ãƒ«è¨­å®š
engine.assignTemplate('phrase_0_word_1', 'CustomTemplate');  // å˜èªãƒ¬ãƒ™ãƒ«ã‚ªãƒ¼ãƒãƒ¼ãƒ©ã‚¤ãƒ‰

// ä¸€æ‹¬å‰²ã‚Šå½“ã¦
engine.batchAssignTemplate(['phrase_0', 'phrase_1'], 'MultiLineText', true);
```

### éšå±¤çš„ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ç®¡ç†

```typescript
// ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã®å„ªå…ˆé †ä½
// 1. ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆå›ºæœ‰ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ (phrase_0_word_1ã®å€‹åˆ¥è¨­å®š)
// 2. è¦ªã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ (phrase_0ã®è¨­å®š)  
// 3. ã‚°ãƒ­ãƒ¼ãƒãƒ«ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ (å…¨ä½“è¨­å®š)
// 4. ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆãƒ‡ãƒ•ã‚©ãƒ«ãƒˆ (ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆæ¨™æº–å€¤)

// ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã‚¢ã‚¯ã‚»ã‚¹ä¾‹
const fontSize = params.fontSize || 32;
const textColor = params.defaultTextColor || '#FFFFFF';
```

### JSONé§†å‹•ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆç™»éŒ²

```typescript
// templates.json ã§ã®è¨­å®š
{
  "MultiLineText": {
    "displayName": "Multi-Line Text",
    "exportName": "MultiLineText",
    "category": "ã‚«ãƒ©ã‚ªã‚±",
    "description": "å¤šè¡Œæ­Œè©è¡¨ç¤ºãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆ"
  }
}
```

---

## åŸºæœ¬æ§‹é€ ã®å®Ÿè£…

### 1. ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆãƒ•ã‚¡ã‚¤ãƒ«ã®ä½œæˆ

æ–°ã—ã„ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆãƒ•ã‚¡ã‚¤ãƒ«ã‚’ä½œæˆã—ã¾ã™ï¼š

```typescript
// src/renderer/templates/MyCustomTemplate.ts
import * as PIXI from 'pixi.js';
import { 
  IAnimationTemplate, 
  StandardParameters, 
  HierarchyType, 
  AnimationPhase,
  ParameterConfig
} from '../types/types';

export class MyCustomTemplate implements IAnimationTemplate {
  metadata = {
    license: "CC-BY-4.0",
    licenseUrl: "https://creativecommons.org/licenses/by/4.0/",
    originalAuthor: "Your Name"
  };

  // ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿è¨­å®š
  getParameterConfig(): ParameterConfig[] {
    return [
      {
        name: "fontSize",
        type: "number",
        default: 32,
        min: 12,
        max: 72,
        step: 1,
        description: "ãƒ•ã‚©ãƒ³ãƒˆã‚µã‚¤ã‚º"
      },
      {
        name: "defaultTextColor",
        type: "color",
        default: "#FFFFFF",
        description: "ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆãƒ†ã‚­ã‚¹ãƒˆè‰²"
      },
      {
        name: "animationSpeed",
        type: "number",
        default: 1.0,
        min: 0.1,
        max: 3.0,
        step: 0.1,
        description: "ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³é€Ÿåº¦"
      }
    ];
  }

  // ãƒ¡ã‚¤ãƒ³ãƒ«ãƒ¼ãƒ†ã‚£ãƒ³ã‚°ãƒ¡ã‚½ãƒƒãƒ‰
  animateContainer(
    container: PIXI.Container,
    text: string,
    params: StandardParameters,
    nowMs: number,
    startMs: number,
    endMs: number,
    hierarchyType: HierarchyType,
    phase: AnimationPhase
  ): boolean {
    switch (hierarchyType) {
      case 'phrase':
        return this.renderPhraseContainer(container, text, params, nowMs, startMs, endMs, phase);
      case 'word':
        return this.renderWordContainer(container, text, params, nowMs, startMs, endMs, phase);
      case 'char':
        return this.renderCharContainer(container, text, params, nowMs, startMs, endMs, phase);
      default:
        return false;
    }
  }

  // éšå±¤åˆ¥å®Ÿè£…ãƒ¡ã‚½ãƒƒãƒ‰ï¼ˆå¾Œè¿°ï¼‰
  renderPhraseContainer(/* ... */): boolean { /* å®Ÿè£… */ }
  renderWordContainer(/* ... */): boolean { /* å®Ÿè£… */ }
  renderCharContainer(/* ... */): boolean { /* å®Ÿè£… */ }

  // ã‚¯ãƒªãƒ¼ãƒ³ã‚¢ãƒƒãƒ—ãƒ¡ã‚½ãƒƒãƒ‰
  removeVisualElements(container: PIXI.Container): void {
    // è¦–è¦šè¦ç´ ã®ã¿ã‚’å‰Šé™¤ã€ã‚³ãƒ³ãƒ†ãƒŠã¯ä¿æŒ
    const childrenToRemove: PIXI.DisplayObject[] = [];
    
    container.children.forEach(child => {
      if (child instanceof PIXI.Text || child instanceof PIXI.Graphics) {
        childrenToRemove.push(child);
      }
      // PIXI.Container ã¯ä¿æŒï¼ˆéšå±¤æ§‹é€ ã‚’ç¶­æŒï¼‰
    });
    
    childrenToRemove.forEach(child => {
      container.removeChild(child);
      child.destroy();
    });
  }
}
```

### 2. ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆè¨­å®š

```typescript
// src/renderer/templates/index.ts ã«è¿½åŠ 
export { MyCustomTemplate } from './MyCustomTemplate';
```

---

## éšå±¤å¯¾å¿œã®ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³å®Ÿè£…

### ãƒ•ãƒ¬ãƒ¼ã‚ºã‚³ãƒ³ãƒ†ãƒŠã®å®Ÿè£…

```typescript
renderPhraseContainer(
  container: PIXI.Container,
  text: string,
  params: StandardParameters,
  nowMs: number,
  startMs: number,
  endMs: number,
  phase: AnimationPhase
): boolean {
  // ãƒ•ãƒ¬ãƒ¼ã‚ºå…¨ä½“ã®é…ç½®ãƒ»ç§»å‹•ãƒ»ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼é©ç”¨
  // é‡è¦: ãƒ†ã‚­ã‚¹ãƒˆãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°ã¯è¡Œã‚ãªã„
  
  const duration = endMs - startMs;
  const progress = Math.max(0, Math.min(1, (nowMs - startMs) / duration));
  
  // ãƒ•ãƒ¬ãƒ¼ã‚ºå…¨ä½“ã®ãƒ•ã‚§ãƒ¼ãƒ‰ã‚¤ãƒ³ãƒ»ã‚¢ã‚¦ãƒˆ
  switch (phase) {
    case 'in':
      container.alpha = progress;
      break;
    case 'active':
      container.alpha = 1;
      break;
    case 'out':
      container.alpha = 1 - progress;
      break;
  }
  
  // ã‚°ãƒ­ãƒ¼ãƒãƒ«ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼é©ç”¨
  if (params.enableGlow) {
    this.applyGlowFilter(container, params);
  }
  
  // ä½ç½®èª¿æ•´
  const offsetX = params.phraseOffsetX || 0;
  const offsetY = params.phraseOffsetY || 0;
  container.position.set(offsetX, offsetY);
  
  return true;
}
```

### å˜èªã‚³ãƒ³ãƒ†ãƒŠã®å®Ÿè£…

```typescript
renderWordContainer(
  container: PIXI.Container,
  text: string,
  params: StandardParameters,
  nowMs: number,
  startMs: number,
  endMs: number,
  phase: AnimationPhase
): boolean {
  // æ–‡å­—é…ç½®ã®ç®¡ç†ãƒ»å˜èªé–“ã®é€£ç¶šæ€§
  // é‡è¦: ãƒ†ã‚­ã‚¹ãƒˆãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°ã¯è¡Œã‚ãªã„
  
  // charIndexã«ã‚ˆã‚‹æ­£ç¢ºãªæ–‡å­—ä½ç½®è¨ˆç®—
  const charIndex = (params as any).charIndex || 0;
  const fontSize = params.fontSize || 32;
  const letterSpacing = params.letterSpacing || 0;
  
  // æ–‡å­—é–“éš”ã®è¨ˆç®—
  const xOffset = charIndex * (fontSize * 0.6 + letterSpacing);
  container.position.set(xOffset, 0);
  
  // å˜èªãƒ¬ãƒ™ãƒ«ã®ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³åŠ¹æœ
  const duration = endMs - startMs;
  const progress = Math.max(0, Math.min(1, (nowMs - startMs) / duration));
  
  // å˜èªåˆ¥ã®ã‚¹ãƒ©ã‚¤ãƒ‰åŠ¹æœ
  if (phase === 'in') {
    const slideDistance = params.slideDistance || 100;
    container.x = xOffset - slideDistance * (1 - progress);
  }
  
  return true;
}
```

### æ–‡å­—ã‚³ãƒ³ãƒ†ãƒŠã®å®Ÿè£…

#### âš ï¸ é‡è¦ï¼šæ–‡å­—ã®å¯è¦–æ€§åˆ¶å¾¡ã«ã¤ã„ã¦

**æ–‡å­—ã¯å¸¸ã«è¡¨ç¤ºã—ã€çŠ¶æ…‹ã¯è‰²ã®å¤‰åŒ–ã®ã¿ã§è¡¨ç¾ã—ã¦ãã ã•ã„ã€‚**

```typescript
// âŒ èª¤ã£ãŸå®Ÿè£…ï¼šæ–‡å­—ã‚’éè¡¨ç¤ºã«ã—ã¦ã—ã¾ã†
textObj.visible = (nowMs >= startMs && nowMs <= endMs);  // é–“é•ã„ï¼
textObj.visible = animationResult.visible;               // é–“é•ã„ï¼

// âœ… æ­£ã—ã„å®Ÿè£…ï¼šå¸¸ã«è¡¨ç¤ºã—ã€è‰²ã§çŠ¶æ…‹ã‚’è¡¨ç¾
textObj.visible = true;  // æ–‡å­—ã¯å¸¸ã«è¡¨ç¤º
textObj.alpha = 1.0;     // é€æ˜åº¦ã‚‚å¸¸ã«1.0
```

**ç†ç”±**ï¼š
- æ–‡å­—ã‚’éè¡¨ç¤ºã«ã™ã‚‹ã¨ã€ã‚¨ãƒ³ã‚¸ãƒ³ãŒæ–‡å­—ã‚’æ¤œå‡ºã§ããšã€Œã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ã‚¨ãƒ©ãƒ¼ã€ãŒç™ºç”Ÿ
- å˜èªã®å…¥é€€å ´æ™‚ã«æ–‡å­—ãŒè¦‹ãˆãªããªã‚Šã€ä¸è‡ªç„¶ãªè¡¨ç¤ºã«ãªã‚‹
- ã‚«ãƒ©ã‚ªã‚±ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ã§ã¯ã€æ–‡å­—ã¯å¸¸ã«è¦‹ãˆã¦ã„ã‚‹çŠ¶æ…‹ãŒè‡ªç„¶

#### å®Ÿè£…ä¾‹

```typescript
renderCharContainer(
  container: PIXI.Container,
  text: string,
  params: StandardParameters,
  nowMs: number,
  startMs: number,
  endMs: number,
  phase: AnimationPhase
): boolean {
  // å®Ÿéš›ã®ãƒ†ã‚­ã‚¹ãƒˆæç”»ãƒ»å€‹åˆ¥ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³
  
  // æ—¢å­˜ã®ãƒ†ã‚­ã‚¹ãƒˆã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã‚’å–å¾—ã¾ãŸã¯ä½œæˆ
  let textObj = container.getChildByName('text') as PIXI.Text;
  if (!textObj) {
    textObj = new PIXI.Text(text, this.createTextStyle(params));
    textObj.name = 'text';
    textObj.anchor.set(0.5);
    container.addChild(textObj);
  }
  
  // ãƒ†ã‚­ã‚¹ãƒˆã‚¹ã‚¿ã‚¤ãƒ«ã®æ›´æ–°
  textObj.style = this.createTextStyle(params);
  textObj.text = text;
  
  // æ–‡å­—å›ºæœ‰ã®ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³
  const duration = endMs - startMs;
  const progress = Math.max(0, Math.min(1, (nowMs - startMs) / duration));
  
  // ãƒ•ã‚§ãƒ¼ã‚ºåˆ¥ã®è‰²å¤‰æ›´
  switch (phase) {
    case 'in':
      textObj.tint = this.interpolateColor(
        params.defaultTextColor || '#808080',
        params.activeTextColor || '#FFFFFF',
        progress
      );
      break;
    case 'active':
      textObj.tint = this.parseColor(params.activeTextColor || '#FFFFFF');
      break;
    case 'out':
      textObj.tint = this.interpolateColor(
        params.activeTextColor || '#FFFFFF',
        params.completedTextColor || '#808080',
        progress
      );
      break;
  }
  
  // ã‚«ã‚¹ã‚¿ãƒ ã‚¨ãƒ•ã‚§ã‚¯ãƒˆ
  if (params.enableFlicker) {
    this.applyFlickerEffect(textObj, nowMs, params);
  }
  
  return true;
}
```

---

## ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ãƒ¬ã‚¸ã‚¹ãƒˆãƒªç™»éŒ²ã¨ç®¡ç†

### æ–°ã—ã„ParameterRegistryã‚·ã‚¹ãƒ†ãƒ ï¼ˆv0.4.3ä»¥é™ï¼‰

UTAVISTA v0.4.3ã§ã¯ã€ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã®ä¹±é€ ã‚’é˜²ãã€ä¸€å…ƒç®¡ç†ã‚’å®Ÿç¾ã™ã‚‹ãŸã‚ã«ParameterRegistryã‚·ã‚¹ãƒ†ãƒ ã‚’å°å…¥ã—ã¾ã—ãŸã€‚ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã§æ–°ã—ã„ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã‚’ä½¿ç”¨ã™ã‚‹å ´åˆã¯ã€ã¾ãšParameterRegistryã«ç™»éŒ²ã™ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚

### åŸºæœ¬å…¬é–‹ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ï¼ˆå…¨ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆæ¨™æº–ï¼‰

ã™ã¹ã¦ã®ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã¯ã€ç‰¹ã«ç†ç”±ãŒãªã„é™ã‚Šä»¥ä¸‹ã®åŸºæœ¬ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã‚’UIã§å…¬é–‹ã™ã¹ãã§ã™ï¼š

#### 1. åŸºæœ¬æ–‡å­—ã‚¹ã‚¿ã‚¤ãƒ«ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿
```typescript
{ name: "fontSize", type: "number", default: 32, min: 12, max: 256, step: 1 },
{ name: "fontFamily", type: "font", default: "Arial" },
{ name: "fontWeight", type: "string", default: "normal" },
{ name: "textColor", type: "color", default: "#FFFFFF" },
{ name: "activeTextColor", type: "color", default: "#FF0000" },
{ name: "completedTextColor", type: "color", default: "#808080" },
```

#### 2. ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆãƒ»ä½ç½®è¨­å®šãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿
```typescript
{ name: "offsetX", type: "number", default: 0, min: -1000, max: 1000, step: 1 },
{ name: "offsetY", type: "number", default: 0, min: -1000, max: 1000, step: 1 },
{ name: "letterSpacing", type: "number", default: 0, min: -20, max: 100, step: 1 },
{ name: "lineHeight", type: "number", default: 150, min: 50, max: 400, step: 10 },
```

#### 3. ã‚°ãƒ­ãƒ¼åŠ¹æœãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿
```typescript
{ name: "enableGlow", type: "boolean", default: false },
{ name: "glowStrength", type: "number", default: 1.5, min: 0, max: 5, step: 0.1 },
{ name: "glowBrightness", type: "number", default: 1.2, min: 0.5, max: 3, step: 0.1 },
{ name: "glowBlur", type: "number", default: 6, min: 0.1, max: 20, step: 0.1 },
{ name: "glowQuality", type: "number", default: 8, min: 0.1, max: 20, step: 0.1 },
{ name: "glowPadding", type: "number", default: 50, min: 0, max: 200, step: 10 },
```

#### 4. ã‚·ãƒ£ãƒ‰ã‚¦åŠ¹æœãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿
```typescript
{ name: "enableShadow", type: "boolean", default: false },
{ name: "shadowBlur", type: "number", default: 6, min: 0, max: 50, step: 0.5 },
{ name: "shadowColor", type: "color", default: "#000000" },
{ name: "shadowAngle", type: "number", default: 45, min: 0, max: 360, step: 15 },
{ name: "shadowDistance", type: "number", default: 5, min: 0, max: 50, step: 1 },
```

#### 5. ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ãƒ»ã‚¿ã‚¤ãƒŸãƒ³ã‚°ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿
```typescript
{ name: "headTime", type: "number", default: 500, min: 0, max: 5000, step: 100 },
{ name: "tailTime", type: "number", default: 500, min: 0, max: 5000, step: 100 },
```

#### 6. ãƒ‡ãƒãƒƒã‚°ãƒ»é–‹ç™ºæ”¯æ´ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿
```typescript
{ name: "debugMode", type: "boolean", default: false }
```

### ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿å…¬é–‹ã®å®Ÿè£…ä¾‹

æ–°ã—ã„ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã§åŸºæœ¬ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã‚’å…¬é–‹ã™ã‚‹å ´åˆã®å®Ÿè£…ä¾‹ï¼š

```typescript
getParameterConfig(): ParameterConfig[] {
  return [
    // === åŸºæœ¬æ–‡å­—ã‚¹ã‚¿ã‚¤ãƒ«ï¼ˆæ¨™æº–ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ï¼‰===
    { name: "fontSize", type: "number", default: 32, min: 12, max: 256, step: 1 },
    { name: "fontFamily", type: "font", default: "Arial" },
    { name: "fontWeight", type: "string", default: "normal" },
    { name: "textColor", type: "color", default: "#FFFFFF" },
    { name: "activeTextColor", type: "color", default: "#FF0000" },
    { name: "completedTextColor", type: "color", default: "#808080" },
    
    // === ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆãƒ»ä½ç½®è¨­å®š ===
    { name: "offsetX", type: "number", default: 0, min: -1000, max: 1000, step: 1 },
    { name: "offsetY", type: "number", default: 0, min: -1000, max: 1000, step: 1 },
    { name: "letterSpacing", type: "number", default: 0, min: -20, max: 100, step: 1 },
    { name: "lineHeight", type: "number", default: 150, min: 50, max: 400, step: 10 },
    
    // === ã‚°ãƒ­ãƒ¼åŠ¹æœ ===
    { name: "enableGlow", type: "boolean", default: false },
    { name: "glowStrength", type: "number", default: 1.5, min: 0, max: 5, step: 0.1 },
    { name: "glowBrightness", type: "number", default: 1.2, min: 0.5, max: 3, step: 0.1 },
    { name: "glowBlur", type: "number", default: 6, min: 0.1, max: 20, step: 0.1 },
    { name: "glowQuality", type: "number", default: 8, min: 0.1, max: 20, step: 0.1 },
    { name: "glowPadding", type: "number", default: 50, min: 0, max: 200, step: 10 },
    
    // === ã‚·ãƒ£ãƒ‰ã‚¦åŠ¹æœ ===
    { name: "enableShadow", type: "boolean", default: false },
    { name: "shadowBlur", type: "number", default: 6, min: 0, max: 50, step: 0.5 },
    { name: "shadowColor", type: "color", default: "#000000" },
    { name: "shadowAngle", type: "number", default: 45, min: 0, max: 360, step: 15 },
    { name: "shadowDistance", type: "number", default: 5, min: 0, max: 50, step: 1 },
    
    // === ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ãƒ»ã‚¿ã‚¤ãƒŸãƒ³ã‚° ===
    { name: "headTime", type: "number", default: 500, min: 0, max: 5000, step: 100 },
    { name: "tailTime", type: "number", default: 500, min: 0, max: 5000, step: 100 },
    
    // === ãƒ‡ãƒãƒƒã‚°ãƒ»é–‹ç™ºæ”¯æ´ ===
    { name: "debugMode", type: "boolean", default: false },
    
    // === ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆå›ºæœ‰ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ ===
    // ã“ã“ã«ç‰¹å®šã®ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã§ã®ã¿å¿…è¦ãªãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã‚’è¿½åŠ 
  ];
}
```

### ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿å…¬é–‹ã®åŸå‰‡

1. **ä¸€è²«æ€§ã®ç¶­æŒ**: ã™ã¹ã¦ã®ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã§åŒã˜åŸºæœ¬ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã‚’å…¬é–‹ã™ã‚‹ã“ã¨ã§ã€ãƒ¦ãƒ¼ã‚¶ãƒ¼ä½“é¨“ã‚’çµ±ä¸€
2. **å¿…è¦æœ€å°é™**: ç‰¹åˆ¥ãªç†ç”±ãŒãªã„é™ã‚Šã€ä¸Šè¨˜ã®åŸºæœ¬ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã‚»ãƒƒãƒˆã‚’ä½¿ç”¨
3. **æ‹¡å¼µæ€§**: ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆå›ºæœ‰ã®æ©Ÿèƒ½ã«å¿…è¦ãªå ´åˆã®ã¿ã€è¿½åŠ ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã‚’å®šç¾©
4. **äº’æ›æ€§**: æ—¢å­˜ã®ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã¨ã®äº’æ›æ€§ã‚’ç¶­æŒ
5. **ã‚·ã‚¹ãƒ†ãƒ çµ±ä¸€æ€§**: ãƒ•ã‚©ãƒ³ãƒˆé¸æŠç­‰ã®æ—¢å­˜ã‚·ã‚¹ãƒ†ãƒ æ©Ÿèƒ½ã¨ä¸€è²«ã—ãŸå‹•ä½œã‚’ä¿è¨¼

**é‡è¦**: æ–°ã—ã„ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆå®Œæˆå¾Œã¯ã€å¿…ãšä»–ã®ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã¨æ©Ÿèƒ½æ¯”è¼ƒãƒ†ã‚¹ãƒˆã‚’å®Ÿè¡Œã—ã€ã‚·ã‚¹ãƒ†ãƒ å…¨ä½“ã§ã®æ•´åˆæ€§ã‚’ç¢ºèªã™ã‚‹ã“ã¨ã€‚

#### ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ãƒ¬ã‚¸ã‚¹ãƒˆãƒªã¸ã®ç™»éŒ²

```typescript
// /src/renderer/utils/ParameterRegistry.ts ã§ç™»éŒ²
private initializeTemplateParameters(): void {
  // ã‚«ã‚¹ã‚¿ãƒ ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆç”¨ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã®ä¾‹
  this.registerParameter({
    name: 'myCustomEffect',
    type: 'boolean',
    category: 'template-specific',
    templateId: 'mycustomtemplate',  // ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆIDã¨ä¸€è‡´ã•ã›ã‚‹
    defaultValue: true,
    description: 'ã‚«ã‚¹ã‚¿ãƒ ã‚¨ãƒ•ã‚§ã‚¯ãƒˆã®æœ‰åŠ¹åŒ–'
  });
  
  this.registerParameter({
    name: 'effectIntensity',
    type: 'number',
    category: 'template-specific',
    templateId: 'mycustomtemplate',
    defaultValue: 1.0,
    min: 0.1,
    max: 3.0,
    description: 'ã‚¨ãƒ•ã‚§ã‚¯ãƒˆã®å¼·åº¦'
  });
}
```

#### ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã®åˆ†é¡

1. **æ¨™æº–ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿** (`category: 'standard'`)
   - è¤‡æ•°ã®ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã§å…±é€šä½¿ç”¨ã•ã‚Œã‚‹ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿
   - ä¾‹: `fontSize`, `textColor`, `enableGlow`

2. **ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆå›ºæœ‰ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿** (`category: 'template-specific'`)
   - ç‰¹å®šã®ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã§ã®ã¿ä½¿ç”¨ã•ã‚Œã‚‹ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿
   - `templateId`ã§æ‰€å±ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã‚’æŒ‡å®š

#### ãƒ¬ã‚¬ã‚·ãƒ¼getParameterConfig()ã‹ã‚‰ã®ç§»è¡Œ

v0.4.2ä»¥å‰ã®`getParameterConfig()`ãƒ¡ã‚½ãƒƒãƒ‰ã¯éæ¨å¥¨ã¨ãªã‚Šã¾ã—ãŸï¼š

```typescript
// âŒ éæ¨å¥¨ï¼ˆv0.4.2ä»¥å‰ï¼‰
getParameterConfig(): ParameterConfig[] {
  return [...]; // ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿å®šç¾©
}

// âœ… æ¨å¥¨ï¼ˆv0.4.3ä»¥é™ï¼‰
// ParameterRegistryã§äº‹å‰ã«ç™»éŒ²æ¸ˆã¿ã®ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã‚’ä½¿ç”¨
// ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆå†…ã§ã¯ç™»éŒ²æ¸ˆã¿ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã®ã¿ã‚¢ã‚¯ã‚»ã‚¹å¯èƒ½
```

### ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã‚¢ã‚¯ã‚»ã‚¹ãƒ‘ã‚¿ãƒ¼ãƒ³

```typescript
// å®‰å…¨ãªãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã‚¢ã‚¯ã‚»ã‚¹
private getParam<T>(params: StandardParameters, key: string, defaultValue: T): T {
  return (params as any)[key] ?? defaultValue;
}

// ä½¿ç”¨ä¾‹
const fontSize = this.getParam(params, 'fontSize', 32);
const enableGlow = this.getParam(params, 'enableGlow', true);
const glowColor = this.getParam(params, 'glowColor', '#FFFF00');
```

---

## æ–‡å­—ãƒ»å˜èªã‚«ã‚¦ãƒ³ãƒˆç®¡ç†

### æ–‡å­—ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹ã®æ´»ç”¨

```typescript
// æ–‡å­—ä½ç½®ã®è¨ˆç®—
calculateCharacterPosition(params: StandardParameters, text: string): { x: number; y: number } {
  const charIndex = this.getParam(params, 'charIndex', 0);
  const fontSize = this.getParam(params, 'fontSize', 32);
  const letterSpacing = this.getParam(params, 'letterSpacing', 0);
  
  // åŸºæœ¬ã®æ¨ªä½ç½®è¨ˆç®—
  const baseX = charIndex * (fontSize * 0.6 + letterSpacing);
  
  // æ”¹è¡Œå‡¦ç†
  const lineNumber = this.getOrCalculateLineNumber(params, text);
  const lineHeight = fontSize * 1.2;
  const baseY = lineNumber * lineHeight;
  
  return { x: baseX, y: baseY };
}
```

### ãƒ•ãƒ¬ãƒ¼ã‚ºå˜ä½ã§ã®æ–‡å­—è¡¨ç¤ºï¼ˆv3.2è¿½åŠ ï¼‰

ãƒ—ãƒªãƒŸãƒ†ã‚£ãƒ–API v3.2ã§ã¯ã€ãƒ•ãƒ¬ãƒ¼ã‚ºå…¨ä½“ã®æ–‡å­—ã‚’åŒæ™‚ã«è¡¨ç¤ºã™ã‚‹ãƒ¢ãƒ¼ãƒ‰ãŒã‚µãƒãƒ¼ãƒˆã•ã‚Œã¦ã„ã¾ã™ï¼š

```typescript
// ãƒ•ãƒ¬ãƒ¼ã‚ºå˜ä½ãƒ¢ãƒ¼ãƒ‰ã®ä½¿ç”¨ä¾‹
import { SlideAnimationPrimitive } from '../primitives';

renderCharContainer(
  container: PIXI.Container,
  text: string,
  params: StandardParameters,
  nowMs: number,
  startMs: number,
  endMs: number,
  phase: AnimationPhase
): boolean {
  const slideAnimation = new SlideAnimationPrimitive();
  
  // ãƒ•ãƒ¬ãƒ¼ã‚ºãƒ¢ãƒ¼ãƒ‰ã§æ–‡å­—ã®å¯è¦–æ€§ã‚’è¨ˆç®—
  const animResult = slideAnimation.calculateCharacterAnimation({
    charIndex: this.getParam(params, 'charIndex', 0),
    totalChars: this.getParam(params, 'totalChars', 1),
    fontSize: this.getParam(params, 'fontSize', 32),
    nowMs: nowMs,
    startMs: startMs,
    endMs: endMs,
    phase: phase,
    animationMode: 'phrase',  // ãƒ•ãƒ¬ãƒ¼ã‚ºãƒ¢ãƒ¼ãƒ‰ã‚’æŒ‡å®š
    phraseStartMs: this.getParam(params, 'phraseStartMs', startMs),
    phraseEndMs: this.getParam(params, 'phraseEndMs', endMs)
  });
  
  // ãƒ†ã‚­ã‚¹ãƒˆã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã®ä½œæˆ
  const textObj = TextStyleFactory.createHighDPIText(text, {
    fontFamily: this.getParam(params, 'fontFamily', 'Arial'),
    fontSize: this.getParam(params, 'fontSize', 32),
    fill: animResult.visible ? 
      this.getParam(params, 'activeTextColor', '#FFFF00') : 
      this.getParam(params, 'textColor', '#FFFFFF')
  });
  
  // ãƒ•ãƒ¬ãƒ¼ã‚ºãƒ¢ãƒ¼ãƒ‰ã§ã¯å…¨æ–‡å­—ãŒåŒæ™‚ã«è¡¨ç¤º/éè¡¨ç¤º
  textObj.visible = animResult.visible;
  textObj.alpha = animResult.alpha;
  
  container.addChild(textObj);
  return true;
}

// æ”¹è¡Œç•ªå·ã®è¨ˆç®—
private getOrCalculateLineNumber(params: StandardParameters, text: string): number {
  const lineNumber = this.getParam(params, 'lineNumber', 0);
  if (lineNumber !== 0) return lineNumber;
  
  // è‡ªå‹•è¨ˆç®—ãƒ­ã‚¸ãƒƒã‚¯
  const charIndex = this.getParam(params, 'charIndex', 0);
  const maxCharsPerLine = this.getParam(params, 'maxCharsPerLine', 20);
  
  return Math.floor(charIndex / maxCharsPerLine);
}
```

### å˜èªå¢ƒç•Œã®æ¤œå‡º

```typescript
// å˜èªå¢ƒç•Œã®åˆ¤å®š
private isWordBoundary(char: string, nextChar: string): boolean {
  const isSpaceChar = /\s/.test(char);
  const isPunctuation = /[ã€‚ã€ï¼ï¼Ÿ,.!?]/.test(char);
  const isEndOfText = !nextChar;
  
  return isSpaceChar || isPunctuation || isEndOfText;
}

// å˜èªã®é–‹å§‹ãƒ»çµ‚äº†åˆ¤å®š
private isWordStart(params: StandardParameters, text: string): boolean {
  const charIndex = this.getParam(params, 'charIndex', 0);
  if (charIndex === 0) return true;
  
  const previousChar = text[charIndex - 1];
  const currentChar = text[charIndex];
  
  return this.isWordBoundary(previousChar, currentChar);
}

private isWordEnd(params: StandardParameters, text: string): boolean {
  const charIndex = this.getParam(params, 'charIndex', 0);
  const currentChar = text[charIndex];
  const nextChar = text[charIndex + 1];
  
  return this.isWordBoundary(currentChar, nextChar);
}
```

---

## PixiJSãƒ•ã‚£ãƒ«ã‚¿ã¨ã‚¨ãƒ•ã‚§ã‚¯ãƒˆå®Ÿè£…

### ã‚°ãƒ­ãƒ¼ã‚¨ãƒ•ã‚§ã‚¯ãƒˆã®å®Ÿè£…

```typescript
import { GlowFilter } from 'pixi-filters';

private applyGlowFilter(container: PIXI.Container, params: StandardParameters): void {
  const glowColor = this.parseColor(this.getParam(params, 'glowColor', '#FFFF00'));
  const glowStrength = this.getParam(params, 'glowStrength', 0.5);
  const glowDistance = this.getParam(params, 'glowDistance', 10);
  
  const glowFilter = new GlowFilter({
    distance: glowDistance,
    outerStrength: glowStrength,
    innerStrength: glowStrength * 0.5,
    color: glowColor,
    quality: 0.5
  });
  
  container.filters = [glowFilter];
}
```

### ã‚«ã‚¹ã‚¿ãƒ ã‚¨ãƒ•ã‚§ã‚¯ãƒˆã®å®Ÿè£…

```typescript
// ç‚¹æ»…ã‚¨ãƒ•ã‚§ã‚¯ãƒˆ
private applyFlickerEffect(textObj: PIXI.Text, nowMs: number, params: StandardParameters): void {
  const flickerSpeed = this.getParam(params, 'flickerSpeed', 1.0);
  const flickerIntensity = this.getParam(params, 'flickerIntensity', 0.5);
  
  const flickerTime = (nowMs * flickerSpeed) / 1000;
  const flickerValue = Math.sin(flickerTime * Math.PI * 2) * flickerIntensity;
  
  textObj.alpha = Math.max(0.1, 1 - Math.abs(flickerValue));
}

// å›è»¢ã‚¨ãƒ•ã‚§ã‚¯ãƒˆ
private applyRotationEffect(container: PIXI.Container, nowMs: number, params: StandardParameters): void {
  const rotationSpeed = this.getParam(params, 'rotationSpeed', 1.0);
  const maxRotation = this.getParam(params, 'maxRotation', 0.1);
  
  const time = (nowMs * rotationSpeed) / 1000;
  container.rotation = Math.sin(time * Math.PI * 2) * maxRotation;
}
```

### ãƒ‘ãƒ¼ãƒ†ã‚£ã‚¯ãƒ«ã‚¨ãƒ•ã‚§ã‚¯ãƒˆã®å®Ÿè£…ï¼ˆv0.5.0æ–°æ©Ÿèƒ½ï¼‰

**SparkleEffectPrimitive**ã‚’ä½¿ç”¨ã—ãŸã‚­ãƒ©ã‚­ãƒ©ãƒ‘ãƒ¼ãƒ†ã‚£ã‚¯ãƒ«ã‚¨ãƒ•ã‚§ã‚¯ãƒˆã®å®Ÿè£…ï¼š

```typescript
import { SparkleEffectPrimitive, type SparkleEffectParams } from '../primitives';

// ãƒ‘ãƒ¼ãƒ†ã‚£ã‚¯ãƒ«ã‚¨ãƒ•ã‚§ã‚¯ãƒˆãƒ—ãƒªãƒŸãƒ†ã‚£ãƒ–ã®ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹
private sparkleEffectPrimitive = new SparkleEffectPrimitive();

// æ–‡å­—ãƒ¬ãƒ™ãƒ«ã§ã®ãƒ‘ãƒ¼ãƒ†ã‚£ã‚¯ãƒ«ã‚¨ãƒ•ã‚§ã‚¯ãƒˆé©ç”¨
private applySparkleEffect(
  container: PIXI.Container, 
  text: string,
  params: StandardParameters, 
  nowMs: number, 
  startMs: number, 
  endMs: number, 
  charIndex: number,
  phraseEndMs?: number
): void {
  // ãƒ‘ãƒ¼ãƒ†ã‚£ã‚¯ãƒ«ã‚¨ãƒ•ã‚§ã‚¯ãƒˆãŒæœ‰åŠ¹ã§ãªã„å ´åˆã¯å‡¦ç†ã‚’ã‚¹ã‚­ãƒƒãƒ—
  if (!this.getParam(params, 'enableSparkle', false)) {
    return;
  }
  
  // ã‚°ãƒ­ãƒ¼ãƒãƒ«åº§æ¨™ã‚’å–å¾—ï¼ˆãƒ‘ãƒ¼ãƒ†ã‚£ã‚¯ãƒ«ç”Ÿæˆã«å¿…è¦ï¼‰
  const globalPos = container.getGlobalPosition();
  
  // SparkleEffectParamsã‚’æ§‹ç¯‰
  const sparkleParams: SparkleEffectParams = {
    // åŸºæœ¬ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿
    enableSparkle: true,
    sparkleCount: this.getParam(params, 'sparkleCount', 4),
    sparkleSize: this.getParam(params, 'sparkleSize', 20),
    sparkleColor: this.getParam(params, 'sparkleColor', '#FFD700'),
    sparkleStarSpikes: this.getParam(params, 'sparkleStarSpikes', 5),
    sparkleScale: this.getParam(params, 'sparkleScale', 3.0),
    sparkleDuration: this.getParam(params, 'sparkleDuration', 1000),
    sparkleRadius: this.getParam(params, 'sparkleRadius', 30),
    sparkleAnimationSpeed: this.getParam(params, 'sparkleAnimationSpeed', 1.0),
    sparkleAlphaDecay: this.getParam(params, 'sparkleAlphaDecay', 0.98),
    sparkleRotationSpeed: this.getParam(params, 'sparkleRotationSpeed', 0.3),
    sparkleGenerationRate: this.getParam(params, 'sparkleGenerationRate', 2.0),
    sparkleVelocityCoefficient: this.getParam(params, 'sparkleVelocityCoefficient', 1.0),
    
    // TwinkleåŠ¹æœï¼ˆv0.5.1ï¼‰- ãƒ‘ãƒ¼ãƒ†ã‚£ã‚¯ãƒ«ã®ç¬ãåŠ¹æœ
    enableTwinkle: this.getParam(params, 'enableTwinkle', true),
    twinkleFrequency: this.getParam(params, 'twinkleFrequency', 1.0),
    twinkleDuration: this.getParam(params, 'twinkleDuration', 120),
    twinkleProbability: this.getParam(params, 'twinkleProbability', 0.8),
    
    // ãƒ‘ãƒ¼ãƒ†ã‚£ã‚¯ãƒ«å°‚ç”¨ã‚°ãƒ­ãƒ¼ã‚¨ãƒ•ã‚§ã‚¯ãƒˆ
    enableParticleGlow: this.getParam(params, 'enableParticleGlow', false),
    particleGlowStrength: this.getParam(params, 'particleGlowStrength', 1.2),
    particleGlowBrightness: this.getParam(params, 'particleGlowBrightness', 1.1),
    particleGlowBlur: this.getParam(params, 'particleGlowBlur', 4),
    particleGlowQuality: this.getParam(params, 'particleGlowQuality', 6),
    particleGlowThreshold: this.getParam(params, 'particleGlowThreshold', 0.1),
    
    // ã‚·ã‚¹ãƒ†ãƒ ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿
    nowMs,
    startMs,
    endMs,
    phraseEndMs,
    tailTime: 500, // ãƒ‘ãƒ¼ãƒ†ã‚£ã‚¯ãƒ«ç¶™ç¶šæ™‚é–“
    text,
    globalPosition: globalPos,
    charId: `phrase_${params.phraseId || 'unknown'}_word_${params.wordId || 'unknown'}_char_${charIndex}`,
    outputResolutionScale: 1.0 // é€šå¸¸è¡¨ç¤ºæ™‚ã¯1.0ã€å‹•ç”»å‡ºåŠ›æ™‚ã¯è‡ªå‹•èª¿æ•´
  };
  
  // ãƒ‘ãƒ¼ãƒ†ã‚£ã‚¯ãƒ«ã‚¨ãƒ•ã‚§ã‚¯ãƒˆã‚’é©ç”¨
  this.sparkleEffectPrimitive.applyEffect(container, sparkleParams);
}

// ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆå†…ã§ã®ä½¿ç”¨ä¾‹ï¼ˆrenderCharContainerãƒ¡ã‚½ãƒƒãƒ‰å†…ï¼‰
renderCharContainer(
  container: PIXI.Container,
  text: string,
  params: Record<string, unknown>,
  nowMs: number,
  startMs: number,
  endMs: number,
  phase: AnimationPhase
): boolean {
  // é€šå¸¸ã®ãƒ†ã‚­ã‚¹ãƒˆæç”»å‡¦ç†
  // ...

  // ãƒ‘ãƒ¼ãƒ†ã‚£ã‚¯ãƒ«ã‚¨ãƒ•ã‚§ã‚¯ãƒˆã‚’é©ç”¨
  this.applySparkleEffect(
    container, 
    text, 
    params, 
    nowMs, 
    startMs, 
    endMs, 
    params.charIndex as number || 0,
    params.phraseEndMs as number
  );
  
  return true;
}
```

#### ãƒ‘ãƒ¼ãƒ†ã‚£ã‚¯ãƒ«ã‚¨ãƒ•ã‚§ã‚¯ãƒˆç”¨ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿è¨­å®š

ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿è¨­å®šã§ä»¥ä¸‹ã®ã‚¹ãƒ‘ãƒ¼ã‚¯ãƒ«ã‚¨ãƒ•ã‚§ã‚¯ãƒˆé–¢é€£ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã‚’è¿½åŠ ï¼š

```typescript
getParameterConfig(): ParameterConfig[] {
  return [
    // åŸºæœ¬ãƒ‘ãƒ¼ãƒ†ã‚£ã‚¯ãƒ«ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿
    { name: "enableSparkle", type: "boolean", default: false, description: "ã‚­ãƒ©ã‚­ãƒ©ã‚¨ãƒ•ã‚§ã‚¯ãƒˆã®æœ‰åŠ¹åŒ–" },
    { name: "sparkleCount", type: "number", default: 4, min: 1, max: 20, step: 1, description: "åŒæ™‚ç”Ÿæˆãƒ‘ãƒ¼ãƒ†ã‚£ã‚¯ãƒ«æ•°" },
    { name: "sparkleSize", type: "number", default: 20, min: 4, max: 30, step: 2, description: "ãƒ‘ãƒ¼ãƒ†ã‚£ã‚¯ãƒ«ã‚µã‚¤ã‚º(px)" },
    { name: "sparkleColor", type: "color", default: "#FFD700", description: "ãƒ‘ãƒ¼ãƒ†ã‚£ã‚¯ãƒ«ã‚«ãƒ©ãƒ¼" },
    { name: "sparkleStarSpikes", type: "number", default: 5, min: 3, max: 12, step: 1, description: "æ˜Ÿå‹ã®è§’æ•°" },
    { name: "sparkleDuration", type: "number", default: 1000, min: 500, max: 3000, step: 100, description: "ãƒ‘ãƒ¼ãƒ†ã‚£ã‚¯ãƒ«å¯¿å‘½(ms)" },
    { name: "sparkleRadius", type: "number", default: 30, min: 5, max: 100, step: 5, description: "æ•£å¸ƒåŠå¾„(px)" },
    { name: "sparkleRotationSpeed", type: "number", default: 0.3, min: 0.0, max: 2.0, step: 0.1, description: "å›è»¢é€Ÿåº¦" },
    { name: "sparkleGenerationRate", type: "number", default: 2.0, min: 0.5, max: 10.0, step: 0.5, description: "1ç§’é–“ã®ç”Ÿæˆæ•°" },
    
    // TwinkleåŠ¹æœãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ï¼ˆv0.5.1ï¼‰
    { name: "enableTwinkle", type: "boolean", default: true, description: "ãƒ‘ãƒ¼ãƒ†ã‚£ã‚¯ãƒ«ç¬ãåŠ¹æœã®æœ‰åŠ¹åŒ–" },
    { name: "twinkleFrequency", type: "number", default: 1.0, min: 0.1, max: 5.0, step: 0.1, description: "ç¬ãã®é »åº¦ï¼ˆå›/ç§’ï¼‰" },
    { name: "twinkleDuration", type: "number", default: 120, min: 50, max: 500, step: 10, description: "ç¬ãã®æŒç¶šæ™‚é–“ï¼ˆmsï¼‰" },
    { name: "twinkleProbability", type: "number", default: 0.8, min: 0.0, max: 1.0, step: 0.1, description: "ç¬ãã®ç¢ºç‡" },
    
    // ãƒ‘ãƒ¼ãƒ†ã‚£ã‚¯ãƒ«ã‚°ãƒ­ãƒ¼ã‚¨ãƒ•ã‚§ã‚¯ãƒˆ
    { name: "enableParticleGlow", type: "boolean", default: false, description: "ãƒ‘ãƒ¼ãƒ†ã‚£ã‚¯ãƒ«ã‚°ãƒ­ãƒ¼åŠ¹æœ" },
    { name: "particleGlowStrength", type: "number", default: 1.2, min: 0.1, max: 5.0, step: 0.1, description: "ã‚°ãƒ­ãƒ¼å¼·åº¦" },
    { name: "particleGlowBlur", type: "number", default: 4, min: 1, max: 20, step: 1, description: "ã‚°ãƒ­ãƒ¼ãƒ–ãƒ©ãƒ¼é‡" },
    
    // ãã®ä»–ã®æ¨™æº–ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿...
  ];
}
```

#### é‡è¦ãªæ³¨æ„ç‚¹

1. **ã‚¹ãƒ†ãƒ¼ã‚¸ãƒ¬ãƒ™ãƒ«ç®¡ç†**: SparkleEffectPrimitiveã¯æ–‡å­—ã‚³ãƒ³ãƒ†ãƒŠã‹ã‚‰ç‹¬ç«‹ã—ã¦ãƒ‘ãƒ¼ãƒ†ã‚£ã‚¯ãƒ«ã‚’ç®¡ç†ã—ã¾ã™
2. **æ±ºå®šè«–çš„å‹•ä½œ**: ã‚¿ã‚¤ãƒ ãƒ©ã‚¤ãƒ³æ“ä½œæ™‚ã«å®Œå…¨ã«å†ç¾å¯èƒ½ãªãƒ‘ãƒ¼ãƒ†ã‚£ã‚¯ãƒ«è¡¨ç¤º
3. **ãƒ¡ãƒ¢ãƒªç®¡ç†**: ãƒ‘ãƒ¼ãƒ†ã‚£ã‚¯ãƒ«ã¯è‡ªå‹•çš„ã«å¯¿å‘½ç®¡ç†ã•ã‚Œã€ãƒ¡ãƒ¢ãƒªãƒªãƒ¼ã‚¯ã‚’é˜²ãã¾ã™
4. **ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹**: å¤§é‡ã®ãƒ‘ãƒ¼ãƒ†ã‚£ã‚¯ãƒ«ã§ã‚‚æ»‘ã‚‰ã‹ãªå‹•ä½œã‚’ä¿è¨¼
5. **ã‚°ãƒ­ãƒ¼ãƒãƒ«åº§æ¨™**: `container.getGlobalPosition()`ã§å–å¾—ã—ãŸåº§æ¨™ã‚’ãƒ‘ãƒ¼ãƒ†ã‚£ã‚¯ãƒ«ç”Ÿæˆã«ä½¿ç”¨

---

## FontServiceçµ±åˆã¨ãƒ•ã‚©ãƒ³ãƒˆç®¡ç†

### é‡è¦ï¼šã‚·ã‚¹ãƒ†ãƒ æ©Ÿèƒ½çµ±ä¸€æ€§ã®ç¢ºä¿

**ãƒ•ã‚©ãƒ³ãƒˆé¸æŠæ©Ÿèƒ½ã‚’ä½¿ç”¨ã™ã‚‹éš›ã®å¿…é ˆç¢ºèªäº‹é …**:

```typescript
// ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆå®Ÿè£…å®Œäº†å¾Œã¯å¿…ãšä»–ã®ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã¨æ¯”è¼ƒãƒ†ã‚¹ãƒˆã‚’å®Ÿè¡Œ
// 1. ãƒ•ã‚©ãƒ³ãƒˆå€™è£œä¸€è¦§ã®ä¸€è‡´ç¢ºèª
const multiLineStackFonts = FontService.getFontFamiliesWithStyles(); // type: "font"
const wordSlideTextFonts = FontService.getAvailableFonts(); // type: "string"

// 2. ãƒ•ã‚©ãƒ³ãƒˆãƒ”ãƒƒã‚¯ã‚¢ãƒƒãƒ—è¨­å®šã®åæ˜ ç¢ºèª
// - ãƒ•ã‚©ãƒ³ãƒˆé¸æŠç”»é¢ã§ä¸€éƒ¨ãƒ•ã‚©ãƒ³ãƒˆã‚’ãƒ”ãƒƒã‚¯ã‚¢ãƒƒãƒ—
// - ã€Œå…¨ãƒ•ã‚©ãƒ³ãƒˆè¡¨ç¤ºã€ã‚’ã‚ªãƒ•ã«ã™ã‚‹
// - ä¸¡æ–¹ã®ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã§åŒã˜ãƒ•ã‚©ãƒ³ãƒˆå€™è£œãŒè¡¨ç¤ºã•ã‚Œã‚‹ã“ã¨ã‚’ç¢ºèª

// 3. è¨­å®šå¤‰æ›´ã®å³åº§åæ˜ ç¢ºèª  
// - ãƒ•ã‚©ãƒ³ãƒˆè¨­å®šå¤‰æ›´å¾Œã€ä¸¡ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã®é¸æŠè‚¢ãŒåŒæ™‚ã«æ›´æ–°ã•ã‚Œã‚‹ã“ã¨ã‚’ç¢ºèª
```

**é¿ã‘ã‚‹ã¹ãå®Ÿè£…ãƒ‘ã‚¿ãƒ¼ãƒ³**:
- ç‹¬è‡ªã®ãƒ•ã‚©ãƒ³ãƒˆå–å¾—ãƒ­ã‚¸ãƒƒã‚¯ã®å®Ÿè£…
- FontServiceã‚’çµŒç”±ã—ãªã„ç›´æ¥çš„ãªã‚·ã‚¹ãƒ†ãƒ ãƒ•ã‚©ãƒ³ãƒˆã‚¢ã‚¯ã‚»ã‚¹
- ãƒ•ã‚£ãƒ«ã‚¿ãƒªãƒ³ã‚°è¨­å®šã‚’ç„¡è¦–ã—ãŸãƒ•ã‚©ãƒ³ãƒˆè¡¨ç¤º

### FontServiceã®æ´»ç”¨

```typescript
// ãƒ•ã‚©ãƒ³ãƒˆã®å‹•çš„æ¤œè¨¼
private validateFont(fontFamily: string): string {
  const availableFonts = FontService.getAvailableFonts();
  const fontExists = availableFonts.some(font => font.value === fontFamily);
  
  if (!fontExists) {
    console.warn(`Font "${fontFamily}" not found, using fallback`);
    return 'Arial'; // ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯
  }
  
  return fontFamily;
}

// ãƒ†ã‚­ã‚¹ãƒˆã‚¹ã‚¿ã‚¤ãƒ«ã®ä½œæˆ
private createTextStyle(params: StandardParameters): PIXI.TextStyle {
  const fontSize = this.getParam(params, 'fontSize', 32);
  const fontFamily = this.validateFont(this.getParam(params, 'fontFamily', 'Arial'));
  const textColor = this.getParam(params, 'defaultTextColor', '#FFFFFF');
  
  return new PIXI.TextStyle({
    fontFamily: fontFamily,
    fontSize: fontSize,
    fill: textColor,
    align: 'center',
    fontWeight: this.getParam(params, 'fontWeight', 'normal'),
    fontStyle: this.getParam(params, 'fontStyle', 'normal')
  });
}
```

---

## ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹æœ€é©åŒ–æŠ€æ³•

### æ—©æœŸãƒªã‚¿ãƒ¼ãƒ³ãƒ‘ã‚¿ãƒ¼ãƒ³

```typescript
renderCharContainer(
  container: PIXI.Container,
  text: string,
  params: StandardParameters,
  nowMs: number,
  startMs: number,
  endMs: number,
  phase: AnimationPhase
): boolean {
  // æ—©æœŸãƒªã‚¿ãƒ¼ãƒ³ã«ã‚ˆã‚‹æœ€é©åŒ–
  const headTime = this.getParam(params, 'headTime', 500);
  const tailTime = this.getParam(params, 'tailTime', 500);
  
  if (nowMs < startMs - headTime || nowMs > endMs + tailTime) {
    container.visible = false;
    return true; // å‡¦ç†ã¯æˆåŠŸã—ãŸãŒã€ãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°ã¯ä¸è¦
  }
  
  container.visible = true;
  
  // å®Ÿéš›ã®ãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°å‡¦ç†
  // ...
  
  return true;
}
```

### ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆãƒ—ãƒ¼ãƒ«ã®å®Ÿè£…

```typescript
// ã‚°ãƒ©ãƒ•ã‚£ãƒƒã‚¯ã‚¹ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆãƒ—ãƒ¼ãƒ«
private static graphicsPool: PIXI.Graphics[] = [];

private getGraphicsFromPool(): PIXI.Graphics {
  if (MyCustomTemplate.graphicsPool.length > 0) {
    const graphics = MyCustomTemplate.graphicsPool.pop()!;
    graphics.clear();
    return graphics;
  }
  
  return new PIXI.Graphics();
}

private returnGraphicsToPool(graphics: PIXI.Graphics): void {
  graphics.clear();
  graphics.visible = false;
  MyCustomTemplate.graphicsPool.push(graphics);
}
```

### æ¡ä»¶ä»˜ããƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°

```typescript
// ãƒ•ãƒ¬ãƒ¼ãƒ ãƒ¬ãƒ¼ãƒˆé©å¿œãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°
private shouldUpdateThisFrame(nowMs: number, lastUpdateMs: number): boolean {
  const updateInterval = 1000 / 60; // 60fps
  return nowMs - lastUpdateMs >= updateInterval;
}

// å¯è¦–æ€§ãƒã‚§ãƒƒã‚¯
private isVisible(container: PIXI.Container): boolean {
  return container.worldVisible && container.worldAlpha > 0.01;
}
```

---

## æ–‡å­—ä½ç½®è¨ˆç®—ã®å®Ÿè£…ã‚¬ã‚¤ãƒ‰

> **âš ï¸ é‡è¦**: æ–‡å­—ä½ç½®è¨ˆç®—ã¯æœ€ã‚‚é‡è¦ã‹ã¤é–“é•ã„ã‚„ã™ã„å®Ÿè£…é ˜åŸŸã§ã™ã€‚æ­£ã—ã„éšå±¤ã§ã®å®Ÿè£…ãŒå¿…è¦ã§ã™ã€‚

### åŸºæœ¬åŸå‰‡

1. **æ–‡å­—ä½ç½®è¨ˆç®—ã¯æ–‡å­—ãƒ¬ãƒ™ãƒ«ã§ã®ã¿å®Ÿè¡Œ**
   - `renderCharContainer`ã§å®Ÿè£…ã™ã‚‹
   - `renderWordContainer`ã§ã¯å®Ÿè£…ã—ãªã„
   - `renderPhraseContainer`ã§ã¯å®Ÿè£…ã—ãªã„

2. **charIndexãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã®å¿…é ˆä½¿ç”¨**
   - å„æ–‡å­—ã®é †åºä½ç½®ã‚’ç¤ºã™`charIndex`ã‚’å¿…ãšå‚ç…§
   - ç´¯ç©ã‚ªãƒ•ã‚»ãƒƒãƒˆæ–¹å¼ã§ä½ç½®ã‚’è¨ˆç®—

3. **åŠè§’æ–‡å­—ã¸ã®å¯¾å¿œ**
   - åŠè§’æ–‡å­—ã«ã¯é©åˆ‡ãªã‚¹ã‚±ãƒ¼ãƒ«ãƒ•ã‚¡ã‚¯ã‚¿ãƒ¼ã‚’é©ç”¨
   - é€šå¸¸ã¯0.6å€ã®ä¿‚æ•°ã‚’ä½¿ç”¨

### æ­£ã—ã„å®Ÿè£…ãƒ‘ã‚¿ãƒ¼ãƒ³

```typescript
// âœ… æ­£ã—ã„å®Ÿè£…: renderCharContainerã§æ–‡å­—ä½ç½®ã‚’è¨ˆç®—
renderCharContainer(
  container: PIXI.Container,
  text: string,
  params: Record<string, unknown>,
  nowMs: number,
  startMs: number,
  endMs: number,
  phase: AnimationPhase
): boolean {
  try {
    // 1. æ–‡å­—ä½ç½®ã®è¨ˆç®—ï¼ˆå¿…é ˆï¼‰
    this.applyCharacterPosition(container, params);
    
    // 2. ãƒ†ã‚­ã‚¹ãƒˆã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã®ä½œæˆãƒ»æ›´æ–°
    this.renderCharacterText(container, text, params, nowMs, startMs, endMs, phase);
    
    return true;
  } catch (error) {
    console.error('Character rendering failed:', error);
    return false;
  }
}

/**
 * æ–‡å­—ä½ç½®è¨ˆç®—ã®æ¨™æº–å®Ÿè£…
 */
private applyCharacterPosition(container: PIXI.Container, params: Record<string, unknown>): void {
  const charIndex = this.getParam(params, 'charIndex', 0);
  const fontSize = this.getParam(params, 'fontSize', 120);
  const charSpacing = this.getParam(params, 'charSpacing', 1.0);
  const char = this.getParam(params, 'char', '') as string;
  
  // åŠè§’æ–‡å­—ã®åˆ¤å®š
  const isHalfWidth = this.isHalfWidthChar(char);
  const scaleFactor = isHalfWidth ? 0.6 : 1.0;
  
  // ç´¯ç©ã‚ªãƒ•ã‚»ãƒƒãƒˆæ–¹å¼ã«ã‚ˆã‚‹ä½ç½®è¨ˆç®—ï¼ˆv0.4.3: deviceScaleå‰Šé™¤ï¼‰
  const xOffset = charIndex * fontSize * charSpacing * scaleFactor;
  
  // Yä½ç½®ã¯è¦ªã‚³ãƒ³ãƒ†ãƒŠã«ä¾å­˜ã€Xä½ç½®ã®ã¿è¨­å®š
  container.position.set(xOffset, container.position.y);
  
  // ãƒ‡ãƒãƒƒã‚°ãƒ­ã‚°ï¼ˆé–‹ç™ºæ™‚ã®ã¿ï¼‰
  if (process.env.NODE_ENV === 'development') {
    console.log(`Character "${char}" positioned at:`, {
      charIndex,
      fontSize,
      charSpacing,
      scaleFactor,
      xOffset,
      finalPosition: { x: container.position.x, y: container.position.y }
    });
  }
}

/**
 * åŠè§’æ–‡å­—ã®åˆ¤å®š
 */
private isHalfWidthChar(char: string): boolean {
  const code = char.charCodeAt(0);
  return (code >= 0x0020 && code <= 0x007E) || (code >= 0xFF61 && code <= 0xFF9F);
}
```

### é–“é•ã£ãŸå®Ÿè£…ãƒ‘ã‚¿ãƒ¼ãƒ³

```typescript
// âŒ é–“é•ã„: renderWordContainerã§æ–‡å­—é–“éš”ã‚’å‡¦ç†
renderWordContainer(
  container: PIXI.Container,
  text: string,
  params: Record<string, unknown>,
  ...
): boolean {
  this.applyWordSlideAnimation(container, params, ...);
  this.applyCharacterSpacing(container, params); // âŒ ã“ã“ã§å®Ÿè¡Œã™ã‚‹ã®ã¯é–“é•ã„
  return true;
}

// âŒ é–“é•ã„: æ–‡å­—ä½ç½®ã‚’å˜èªãƒ¬ãƒ™ãƒ«ã§ä¸€æ‹¬å‡¦ç†
private applyCharacterSpacing(container: PIXI.Container, params: Record<string, unknown>): void {
  // ã“ã‚Œã¯é–“é•ã£ãŸã‚¢ãƒ—ãƒ­ãƒ¼ãƒ
  // å„æ–‡å­—ã¯å€‹åˆ¥ã«charIndexã«åŸºã¥ã„ã¦ä½ç½®è¨ˆç®—ã•ã‚Œã‚‹ã¹ã
}
```

### ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿è¦ä»¶

æ–‡å­—ä½ç½®è¨ˆç®—ã«å¿…è¦ãªãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ï¼š

```typescript
// å¿…é ˆãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿
{ name: "charIndex", type: "number", required: true }, // æ–‡å­—ã®é †åºä½ç½®
{ name: "fontSize", type: "number", default: 120 },    // ãƒ•ã‚©ãƒ³ãƒˆã‚µã‚¤ã‚º
{ name: "charSpacing", type: "number", default: 1.0 }, // æ–‡å­—é–“éš”

// ã‚ªãƒ—ã‚·ãƒ§ãƒ³ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿
{ name: "char", type: "string", required: true },      // æ–‡å­—å†…å®¹ï¼ˆåŠè§’åˆ¤å®šç”¨ï¼‰
```

### æ¤œè¨¼ã¨ãƒ‡ãƒãƒƒã‚°

```typescript
/**
 * æ–‡å­—ä½ç½®è¨ˆç®—ã®æ¤œè¨¼
 */
private validateCharacterPositioning(container: PIXI.Container, params: Record<string, unknown>): boolean {
  const charIndex = this.getParam(params, 'charIndex', 0);
  const expectedX = charIndex * this.getParam(params, 'fontSize', 120) * this.getParam(params, 'charSpacing', 1.0) * 0.6;
  const actualX = container.position.x;
  
  const tolerance = 1; // 1ãƒ”ã‚¯ã‚»ãƒ«ã®èª¤å·®ã¯è¨±å®¹
  const isValid = Math.abs(expectedX - actualX) <= tolerance;
  
  if (!isValid) {
    console.warn(`Character positioning mismatch:`, {
      charIndex,
      expected: expectedX,
      actual: actualX,
      difference: Math.abs(expectedX - actualX)
    });
  }
  
  return isValid;
}
```

### FlexibleCumulativeLayoutPrimitive - æŸ”è»Ÿãªå˜èªé…ç½®ã‚·ã‚¹ãƒ†ãƒ ï¼ˆv0.4.3æ–°æ©Ÿèƒ½ï¼‰

**FlexibleCumulativeLayoutPrimitive**ã¯ã€å¾“æ¥ã®å˜èªé…ç½®ã®å•é¡Œã‚’è§£æ±ºã—ã€4ã¤ã®ç•°ãªã‚‹è¡¨ç¤ºãƒ¢ãƒ¼ãƒ‰ã‚’ã‚µãƒãƒ¼ãƒˆã™ã‚‹çµ±åˆãƒ—ãƒªãƒŸãƒ†ã‚£ãƒ–ã§ã™ã€‚

#### 4ã¤ã®å˜èªè¡¨ç¤ºãƒ¢ãƒ¼ãƒ‰

```typescript
import { 
  FlexibleCumulativeLayoutPrimitive, 
  WordDisplayMode,
  type FlexibleCharacterData 
} from '../primitives';

enum WordDisplayMode {
  INDIVIDUAL_WORD_ENTRANCE = 'individual_word_entrance',      // å˜èªã”ã¨ã«å€‹åˆ¥å…¥å ´
  PHRASE_CUMULATIVE_SAME_LINE = 'phrase_cumulative_same_line' // åŒã˜è¡Œã«å˜èªã‚’é…ç½®
}
```

#### ä½¿ç”¨ä¾‹ï¼šGlitchTextã‚¹ã‚¿ã‚¤ãƒ«ã®å®Ÿè£…

```typescript
renderWordContainer(
  container: PIXI.Container,
  text: string,
  params: Record<string, unknown>,
  nowMs: number,
  startMs: number,
  endMs: number,
  phase: AnimationPhase,
  hierarchyType: HierarchyType
): boolean {
  const layoutPrimitive = new FlexibleCumulativeLayoutPrimitive();
  
  // æ–‡å­—ãƒ‡ãƒ¼ã‚¿ï¼ˆæ‹¡å¼µç‰ˆFlexibleCharacterDataä½¿ç”¨ï¼‰
  const charsData = params.chars as FlexibleCharacterData[];
  
  // è¡¨ç¤ºãƒ¢ãƒ¼ãƒ‰ã®è¨­å®š
  const layoutParams = {
    charSpacing: params.charSpacing as number || 1.2,
    fontSize: params.fontSize as number || 120,
    halfWidthSpacingRatio: 0.6,
    alignment: 'left' as const,
    containerSize: { width: 0, height: 0 },
    spacing: params.charSpacing as number || 1.2,
    chars: charsData,
    containerPrefix: 'char_container_',
    wordDisplayMode: WordDisplayMode.PHRASE_CUMULATIVE_SAME_LINE, // GlitchTextã‚¹ã‚¿ã‚¤ãƒ«
    wordSpacing: params.wordSpacing as number || 1.0,
    lineHeight: params.lineHeight as number || 1.2
  };
  
  // æŸ”è»Ÿãªæ–‡å­—ã‚³ãƒ³ãƒ†ãƒŠç®¡ç†
  layoutPrimitive.manageCharacterContainersFlexible(
    container,
    layoutParams,
    (charContainer, charData, position) => {
      // å„æ–‡å­—ã®ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³å‡¦ç†
      this.animateContainer!(
        charContainer,
        charData.char,
        { ...params, id: charData.id, charIndex: charData.charIndex },
        nowMs, charData.start, charData.end, 'char', phase
      );
    }
  );
  
  return true;
}
```

#### FlexibleCharacterData æ§‹é€ 

```typescript
interface FlexibleCharacterData {
  id: string;
  char: string;
  start: number;
  end: number;
  charIndexInWord: number;    // å˜èªå†…ã§ã®æ–‡å­—ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹
  charIndex: number;          // ãƒ•ãƒ¬ãƒ¼ã‚ºå…¨ä½“ã§ã®ç´¯ç©æ–‡å­—ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹ â˜…é‡è¦
  wordIndex: number;          // å˜èªã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹
  totalChars: number;         // ãƒ•ãƒ¬ãƒ¼ã‚ºå†…ã®ç·æ–‡å­—æ•°
  totalWords: number;         // ãƒ•ãƒ¬ãƒ¼ã‚ºå†…ã®ç·å˜èªæ•°
}
```

#### å„è¡¨ç¤ºãƒ¢ãƒ¼ãƒ‰ã®ç‰¹å¾´

| ãƒ¢ãƒ¼ãƒ‰ | ç”¨é€” | ç´¯ç©ä½ç½®è¨ˆç®— | å˜èªé–“åˆ¶å¾¡ |
|--------|------|-------------|------------|
| `INDIVIDUAL_WORD_ENTRANCE` | WordSlideText | å˜èªã”ã¨ãƒªã‚»ãƒƒãƒˆ | å€‹åˆ¥å…¥å ´ã‚¿ã‚¤ãƒŸãƒ³ã‚° |
| `PHRASE_CUMULATIVE_SAME_LINE` | GlitchText | ãƒ•ãƒ¬ãƒ¼ã‚ºå…¨ä½“ç´¯ç© | åŒä¸€è¡Œé€£ç¶šé…ç½® |
| `PHRASE_CUMULATIVE_NEW_LINE` | ç¸¦æ›¸ããƒ¬ã‚¤ã‚¢ã‚¦ãƒˆ | ãƒ•ãƒ¬ãƒ¼ã‚ºå…¨ä½“ç´¯ç© | å˜èªã”ã¨ã«æ”¹è¡Œ |
| `SIMULTANEOUS_WITH_SPACING` | èª­ã¿ã‚„ã™ã„è¡¨ç¤º | ãƒ•ãƒ¬ãƒ¼ã‚ºå…¨ä½“ç´¯ç© | å˜èªé–“ã‚¹ãƒšãƒ¼ã‚¹ä»˜ã |

#### ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã§ã®åˆ¶å¾¡æ–¹æ³•

```typescript
getParameterConfig(): ParameterConfig[] {
  return [
    // å˜èªè¡¨ç¤ºãƒ¢ãƒ¼ãƒ‰è¨­å®š
    { 
      name: "wordDisplayMode", 
      type: "string", 
      default: "phrase_cumulative_same_line",
      options: [
        "individual_word_entrance",      // å˜èªã”ã¨ã«å€‹åˆ¥å…¥å ´
        "phrase_cumulative_same_line"    // åŒã˜è¡Œã«å˜èªã‚’é…ç½®
      ]
    },
    { name: "wordSpacing", type: "number", default: 1.0, min: 0.0, max: 5.0, step: 0.1 },
    { name: "lineHeight", type: "number", default: 1.2, min: 0.5, max: 3.0, step: 0.1 },
    // ... ä»–ã®ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿
  ];
}
```

### ãƒˆãƒ©ãƒ–ãƒ«ã‚·ãƒ¥ãƒ¼ãƒ†ã‚£ãƒ³ã‚°

| ç—‡çŠ¶ | åŸå›  | è§£æ±ºæ–¹æ³• |
|------|------|----------|
| å…¨æ–‡å­—ãŒåŒã˜ä½ç½®ã«è¡¨ç¤º | å˜èªãƒ¬ãƒ™ãƒ«ã§æ–‡å­—é–“éš”ã‚’å‡¦ç† | æ–‡å­—ãƒ¬ãƒ™ãƒ«ã«ç§»å‹• |
| æ–‡å­—ãŒé‡ãªã£ã¦è¡¨ç¤º | charIndexã‚’ç„¡è¦–ã—ãŸå®Ÿè£… | charIndexã‚’ä½¿ç”¨ã—ãŸç´¯ç©è¨ˆç®— |
| å˜èªãŒåŒã˜ä½ç½®ã«é‡è¤‡è¡¨ç¤º | EnhancedCumulativeLayoutPrimitiveä½¿ç”¨ | FlexibleCumulativeLayoutPrimitiveç§»è¡Œ |
| åŠè§’æ–‡å­—ã®é–“éš”ãŒä¸è‡ªç„¶ | ã‚¹ã‚±ãƒ¼ãƒ«ãƒ•ã‚¡ã‚¯ã‚¿ãƒ¼æœªé©ç”¨ | åŠè§’åˆ¤å®šã¨ã‚¹ã‚±ãƒ¼ãƒ«ãƒ•ã‚¡ã‚¯ã‚¿ãƒ¼è¿½åŠ  |
| æ–‡å­—ä½ç½®ãŒãƒ•ãƒ¬ãƒ¼ãƒ ã”ã¨ã«å¤‰åŒ– | ä½ç½®è¨ˆç®—ã®ä¸€è²«æ€§ä¸è¶³ | æ±ºå®šè«–çš„ãªä½ç½®è¨ˆç®—ã®å®Ÿè£… |

## ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°ã¨ãƒ‡ãƒãƒƒã‚°

### å¤šå±¤ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯ã‚·ã‚¹ãƒ†ãƒ 

```typescript
renderCharContainer(
  container: PIXI.Container,
  text: string,
  params: StandardParameters,
  nowMs: number,
  startMs: number,
  endMs: number,
  phase: AnimationPhase
): boolean {
  try {
    // é«˜åº¦ãªãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°
    return this.renderAdvancedCharacter(container, text, params, nowMs, startMs, endMs, phase);
  } catch (error) {
    console.warn('Advanced rendering failed, falling back to basic:', error);
    
    try {
      // åŸºæœ¬ãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°
      return this.renderBasicCharacter(container, text, params, nowMs, startMs, endMs, phase);
    } catch (fallbackError) {
      console.error('Basic rendering failed, using minimal:', fallbackError);
      
      // æœ€å°é™ã®ãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°
      return this.renderMinimalCharacter(container, text, params);
    }
  }
}

// æœ€å°é™ã®ãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°ï¼ˆãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯ï¼‰
private renderMinimalCharacter(
  container: PIXI.Container,
  text: string,
  params: StandardParameters
): boolean {
  let textObj = container.getChildByName('text') as PIXI.Text;
  if (!textObj) {
    textObj = new PIXI.Text(text, { fontSize: 32, fill: '#FFFFFF' });
    textObj.name = 'text';
    textObj.anchor.set(0.5);
    container.addChild(textObj);
  }
  
  textObj.text = text;
  return true;
}
```

### ãƒ‡ãƒãƒƒã‚°æ”¯æ´

```typescript
// ãƒ‡ãƒãƒƒã‚°ãƒ¢ãƒ¼ãƒ‰
private debugLog(message: string, hierarchyType: HierarchyType, params: StandardParameters): void {
  const debugMode = this.getParam(params, 'debugMode', false);
  if (debugMode) {
    console.log(`[${hierarchyType}] ${message}`);
  }
}

// ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ãƒ¢ãƒ‹ã‚¿ãƒªãƒ³ã‚°
private performanceMonitor = {
  renderTimes: [] as number[],
  
  startTiming(): number {
    return performance.now();
  },
  
  endTiming(startTime: number, operation: string): void {
    const endTime = performance.now();
    const duration = endTime - startTime;
    this.renderTimes.push(duration);
    
    if (this.renderTimes.length > 100) {
      this.renderTimes.shift();
    }
    
    if (duration > 16) { // 60fps threshold
      console.warn(`Slow ${operation}: ${duration.toFixed(2)}ms`);
    }
  },
  
  getAverageRenderTime(): number {
    if (this.renderTimes.length === 0) return 0;
    return this.renderTimes.reduce((a, b) => a + b) / this.renderTimes.length;
  }
};
```

---

## ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆãƒ¬ã‚¸ã‚¹ãƒˆãƒªã¸ã®ç™»éŒ²

### 1. templates.json ã¸ã®è¿½åŠ 

```json
{
  "MyCustomTemplate": {
    "displayName": "My Custom Template",
    "exportName": "MyCustomTemplate",
    "category": "ã‚«ã‚¹ã‚¿ãƒ ",
    "description": "ã‚«ã‚¹ã‚¿ãƒ ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã®èª¬æ˜"
  }
}
```

### 2. ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã®å‹•çš„ãƒ­ãƒ¼ãƒ‰ç¢ºèª

```typescript
// ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆãŒæ­£ã—ãç™»éŒ²ã•ã‚Œã¦ã„ã‚‹ã‹ç¢ºèª
import { templateRegistry } from '../templates/registry/templateRegistry';

const myTemplate = templateRegistry.getTemplateById('MyCustomTemplate');
if (myTemplate) {
  console.log('ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆãŒæ­£å¸¸ã«ç™»éŒ²ã•ã‚Œã¾ã—ãŸ:', myTemplate.metadata);
} else {
  console.error('ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã®ç™»éŒ²ã«å¤±æ•—ã—ã¾ã—ãŸ');
}
```

---

## å®Ÿè£…ãƒ‘ã‚¿ãƒ¼ãƒ³ç·åˆã‚¬ã‚¤ãƒ‰

### å®Œå…¨å®Ÿè£…ä¾‹

```typescript
// src/renderer/templates/MyCustomTemplate.ts
import * as PIXI from 'pixi.js';
import { GlowFilter } from 'pixi-filters';
import { 
  IAnimationTemplate, 
  StandardParameters, 
  HierarchyType, 
  AnimationPhase,
  ParameterConfig
} from '../types/types';

export class MyCustomTemplate implements IAnimationTemplate {
  metadata = {
    license: "CC-BY-4.0",
    licenseUrl: "https://creativecommons.org/licenses/by/4.0/",
    originalAuthor: "Your Name"
  };

  private static graphicsPool: PIXI.Graphics[] = [];
  private performanceMonitor = {
    renderTimes: [] as number[],
    startTiming: () => performance.now(),
    endTiming: (startTime: number, operation: string) => {
      const duration = performance.now() - startTime;
      this.renderTimes.push(duration);
      if (duration > 16) console.warn(`Slow ${operation}: ${duration.toFixed(2)}ms`);
    }
  };

  getParameterConfig(): ParameterConfig[] {
    return [
      { name: "fontSize", type: "number", default: 32, min: 12, max: 72, step: 1, description: "ãƒ•ã‚©ãƒ³ãƒˆã‚µã‚¤ã‚º" },
      { name: "defaultTextColor", type: "color", default: "#FFFFFF", description: "ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆãƒ†ã‚­ã‚¹ãƒˆè‰²" },
      { name: "activeTextColor", type: "color", default: "#FF0000", description: "ã‚¢ã‚¯ãƒ†ã‚£ãƒ–ãƒ†ã‚­ã‚¹ãƒˆè‰²" },
      { name: "enableGlow", type: "boolean", default: true, description: "ã‚°ãƒ­ãƒ¼ã‚¨ãƒ•ã‚§ã‚¯ãƒˆã®æœ‰åŠ¹åŒ–" },
      { name: "glowColor", type: "color", default: "#FFFF00", description: "ã‚°ãƒ­ãƒ¼ã®è‰²" },
      { name: "animationSpeed", type: "number", default: 1.0, min: 0.1, max: 3.0, step: 0.1, description: "ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³é€Ÿåº¦" }
    ];
  }

  animateContainer(
    container: PIXI.Container,
    text: string,
    params: StandardParameters,
    nowMs: number,
    startMs: number,
    endMs: number,
    hierarchyType: HierarchyType,
    phase: AnimationPhase
  ): boolean {
    const startTime = this.performanceMonitor.startTiming();
    
    try {
      let result = false;
      
      switch (hierarchyType) {
        case 'phrase':
          result = this.renderPhraseContainer(container, text, params, nowMs, startMs, endMs, phase);
          break;
        case 'word':
          result = this.renderWordContainer(container, text, params, nowMs, startMs, endMs, phase);
          break;
        case 'char':
          result = this.renderCharContainer(container, text, params, nowMs, startMs, endMs, phase);
          break;
      }
      
      this.performanceMonitor.endTiming(startTime, `${hierarchyType} rendering`);
      return result;
      
    } catch (error) {
      console.error(`Error in ${hierarchyType} rendering:`, error);
      this.performanceMonitor.endTiming(startTime, `${hierarchyType} rendering (error)`);
      return false;
    }
  }

  renderPhraseContainer(
    container: PIXI.Container,
    text: string,
    params: StandardParameters,
    nowMs: number,
    startMs: number,
    endMs: number,
    phase: AnimationPhase
  ): boolean {
    const duration = endMs - startMs;
    const progress = Math.max(0, Math.min(1, (nowMs - startMs) / duration));
    
    // ãƒ•ãƒ¬ãƒ¼ã‚ºãƒ¬ãƒ™ãƒ«ã®ãƒ•ã‚§ãƒ¼ãƒ‰
    switch (phase) {
      case 'in':
        container.alpha = progress;
        break;
      case 'active':
        container.alpha = 1;
        break;
      case 'out':
        container.alpha = 1 - progress;
        break;
    }
    
    // ã‚°ãƒ­ãƒ¼ã‚¨ãƒ•ã‚§ã‚¯ãƒˆã®é©ç”¨
    if (this.getParam(params, 'enableGlow', true)) {
      this.applyGlowFilter(container, params);
    }
    
    return true;
  }

  renderWordContainer(
    container: PIXI.Container,
    text: string,
    params: StandardParameters,
    nowMs: number,
    startMs: number,
    endMs: number,
    phase: AnimationPhase
  ): boolean {
    // æ–‡å­—ä½ç½®ã®è¨ˆç®—
    const position = this.calculateCharacterPosition(params, text);
    container.position.set(position.x, position.y);
    
    return true;
  }

  renderCharContainer(
    container: PIXI.Container,
    text: string,
    params: StandardParameters,
    nowMs: number,
    startMs: number,
    endMs: number,
    phase: AnimationPhase
  ): boolean {
    // æ—©æœŸãƒªã‚¿ãƒ¼ãƒ³æœ€é©åŒ–
    if (nowMs < startMs - 500 || nowMs > endMs + 500) {
      container.visible = false;
      return true;
    }
    
    container.visible = true;
    
    // ãƒ†ã‚­ã‚¹ãƒˆã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã®ä½œæˆ/æ›´æ–°
    let textObj = container.getChildByName('text') as PIXI.Text;
    if (!textObj) {
      textObj = new PIXI.Text(text, this.createTextStyle(params));
      textObj.name = 'text';
      textObj.anchor.set(0.5);
      container.addChild(textObj);
    }
    
    // ãƒ•ã‚§ãƒ¼ã‚ºåˆ¥ã®è‰²å¤‰æ›´
    const duration = endMs - startMs;
    const progress = Math.max(0, Math.min(1, (nowMs - startMs) / duration));
    
    switch (phase) {
      case 'in':
        textObj.tint = this.interpolateColor(
          this.getParam(params, 'defaultTextColor', '#FFFFFF'),
          this.getParam(params, 'activeTextColor', '#FF0000'),
          progress
        );
        break;
      case 'active':
        textObj.tint = this.parseColor(this.getParam(params, 'activeTextColor', '#FF0000'));
        break;
      case 'out':
        textObj.tint = this.interpolateColor(
          this.getParam(params, 'activeTextColor', '#FF0000'),
          this.getParam(params, 'defaultTextColor', '#FFFFFF'),
          progress
        );
        break;
    }
    
    return true;
  }

  removeVisualElements(container: PIXI.Container): void {
    const childrenToRemove: PIXI.DisplayObject[] = [];
    
    container.children.forEach(child => {
      if (child instanceof PIXI.Text || child instanceof PIXI.Graphics) {
        childrenToRemove.push(child);
      }
    });
    
    childrenToRemove.forEach(child => {
      container.removeChild(child);
      child.destroy();
    });
  }

  // ãƒ˜ãƒ«ãƒ‘ãƒ¼ãƒ¡ã‚½ãƒƒãƒ‰
  private getParam<T>(params: StandardParameters, key: string, defaultValue: T): T {
    return (params as any)[key] ?? defaultValue;
  }

  private createTextStyle(params: StandardParameters): PIXI.TextStyle {
    return new PIXI.TextStyle({
      fontFamily: this.getParam(params, 'fontFamily', 'Arial'),
      fontSize: this.getParam(params, 'fontSize', 32),
      fill: this.getParam(params, 'defaultTextColor', '#FFFFFF'),
      align: 'center'
    });
  }

  private calculateCharacterPosition(params: StandardParameters, text: string): { x: number; y: number } {
    const charIndex = this.getParam(params, 'charIndex', 0);
    const fontSize = this.getParam(params, 'fontSize', 32);
    const letterSpacing = this.getParam(params, 'letterSpacing', 0);
    
    const baseX = charIndex * (fontSize * 0.6 + letterSpacing);
    const lineNumber = this.getParam(params, 'lineNumber', 0);
    const baseY = lineNumber * fontSize * 1.2;
    
    return { x: baseX, y: baseY };
  }

  private applyGlowFilter(container: PIXI.Container, params: StandardParameters): void {
    const glowColor = this.parseColor(this.getParam(params, 'glowColor', '#FFFF00'));
    const glowStrength = this.getParam(params, 'glowStrength', 0.5);
    
    const glowFilter = new GlowFilter({
      distance: 10,
      outerStrength: glowStrength,
      innerStrength: glowStrength * 0.5,
      color: glowColor,
      quality: 0.5
    });
    
    container.filters = [glowFilter];
  }

  private parseColor(colorString: string): number {
    return parseInt(colorString.replace('#', ''), 16);
  }

  private interpolateColor(color1: string, color2: string, progress: number): number {
    const c1 = this.parseColor(color1);
    const c2 = this.parseColor(color2);
    
    const r1 = (c1 >> 16) & 0xFF;
    const g1 = (c1 >> 8) & 0xFF;
    const b1 = c1 & 0xFF;
    
    const r2 = (c2 >> 16) & 0xFF;
    const g2 = (c2 >> 8) & 0xFF;
    const b2 = c2 & 0xFF;
    
    const r = Math.round(r1 + (r2 - r1) * progress);
    const g = Math.round(g1 + (g2 - g1) * progress);
    const b = Math.round(b1 + (b2 - b1) * progress);
    
    return (r << 16) | (g << 8) | b;
  }
}
```

---

## ãƒ•ãƒ¬ãƒ¼ã‚ºã‚¿ã‚¤ãƒŸãƒ³ã‚°å„ªå…ˆå®Ÿè£…ã‚¬ã‚¤ãƒ‰ï¼ˆv0.4.3æ–°æ©Ÿèƒ½ï¼‰

### æ¦‚è¦

ç‚¹æ»…ãƒ•ã‚§ãƒ¼ãƒ‰ãƒ†ã‚­ã‚¹ãƒˆv2.0ã§å®Ÿè£…ã•ã‚ŒãŸãƒ•ãƒ¬ãƒ¼ã‚ºã‚¿ã‚¤ãƒŸãƒ³ã‚°å„ªå…ˆæ©Ÿèƒ½ã¯ã€å€‹ã€…ã®æ–‡å­—ã‚„å˜èªã®ã‚¿ã‚¤ãƒŸãƒ³ã‚°ã‚’ç„¡è¦–ã—ã€ã™ã¹ã¦ã®æ–‡å­—ã‚’ãƒ•ãƒ¬ãƒ¼ã‚ºã®å…¥å ´æœŸé–“ï¼ˆHeadTimeï¼‰å†…ã«åã‚ã¦è¡¨ç¤ºã™ã‚‹é«˜åº¦ãªæ©Ÿèƒ½ã§ã™ã€‚ã“ã®æ©Ÿèƒ½ã«ã‚ˆã‚Šã€æ–‡å­—ãŒãƒ•ãƒ¬ãƒ¼ã‚ºé–‹å§‹ã¨åŒæ™‚ã«ä¸€æ–‰ã«å…¥å ´ã—ã€çµ±ä¸€æ„Ÿã®ã‚ã‚‹ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ã‚’å®Ÿç¾ã§ãã¾ã™ã€‚

### å®Ÿè£…ã®èƒŒæ™¯ã¨å¿…è¦æ€§

#### ãƒ—ãƒªãƒŸãƒ†ã‚£ãƒ–APIã®åˆ¶ç´„

FlexibleCumulativeLayoutPrimitiveãªã©ã®æ¨™æº–ãƒ—ãƒªãƒŸãƒ†ã‚£ãƒ–ã¯ã€ä»¥ä¸‹ã®åˆ¶ç´„ãŒã‚ã‚Šã¾ã™ï¼š

1. **å€‹åˆ¥ã‚¿ã‚¤ãƒŸãƒ³ã‚°åˆ¶å¾¡ã®åˆ¶é™**: ãƒ—ãƒªãƒŸãƒ†ã‚£ãƒ–ã¯å„æ–‡å­—ã®å…ƒã®ã‚¿ã‚¤ãƒŸãƒ³ã‚°ï¼ˆstart/endï¼‰ã«åŸºã¥ã„ã¦è¡¨ç¤ºåˆ¶å¾¡ã‚’è¡Œã†
2. **ãƒ•ãƒ¬ãƒ¼ã‚ºå…¨ä½“ã®çµ±ä¸€åˆ¶å¾¡å›°é›£**: ãƒ•ãƒ¬ãƒ¼ã‚ºãƒ™ãƒ¼ã‚¹ã§ã®ä¸€æ–‰å…¥å ´ã‚„é€€å ´ã‚’ç›´æ¥ã‚µãƒãƒ¼ãƒˆã—ã¦ã„ãªã„
3. **ã‚¿ã‚¤ãƒŸãƒ³ã‚°å¤‰æ›ã®å¿…è¦æ€§**: ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆå´ã§ã‚¿ã‚¤ãƒŸãƒ³ã‚°ã®ãƒ©ãƒƒãƒ”ãƒ³ã‚°å‡¦ç†ãŒå¿…è¦

```typescript
// ãƒ—ãƒªãƒŸãƒ†ã‚£ãƒ–ãŒæœŸå¾…ã™ã‚‹ãƒ‡ãƒ¼ã‚¿æ§‹é€ 
interface FlexibleCharacterData {
  char: string;
  start: number;  // æ–‡å­—ã®å…ƒã®ã‚¿ã‚¤ãƒŸãƒ³ã‚°
  end: number;    // ãƒ—ãƒªãƒŸãƒ†ã‚£ãƒ–ã¯ã“ã‚Œã‚’ç›´æ¥ä½¿ç”¨
}
```

### å®Ÿè£…æ‰‹æ³•

#### 1. ã‚¿ã‚¤ãƒŸãƒ³ã‚°å¤‰æ›ï¼ˆãƒ©ãƒƒãƒ”ãƒ³ã‚°ï¼‰å‡¦ç†

```typescript
// BlinkFadeTextPrimitive_v2ã®å®Ÿè£…ä¾‹
renderWordContainer(container, _, params, nowMs, startMs, endMs) {
  // ãƒ•ãƒ¬ãƒ¼ã‚ºã‚¿ã‚¤ãƒŸãƒ³ã‚°å¼·åˆ¶ãƒ•ãƒ©ã‚°
  const forcePhraseTiming = params.forcePhraseTiming as boolean || false;
  
  if (forcePhraseTiming) {
    // ãƒ•ãƒ¬ãƒ¼ã‚ºã®å…¥å ´æœŸé–“ã‚’è¨ˆç®—
    const phraseStartMs = params.phraseStartMs as number || startMs;
    const headTime = params.headTimeOverride as number || 800;
    const phraseEntranceStart = phraseStartMs - headTime;
    const phraseEntranceEnd = phraseStartMs;
    
    // ã™ã¹ã¦ã®æ–‡å­—ã®ã‚¿ã‚¤ãƒŸãƒ³ã‚°ã‚’åé›†
    const flexibleCharsData = characters.map(char => ({
      char: char.char,
      start: char.start,
      end: char.end,
      // ... ãã®ä»–ã®ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£
    }));
    
    // ã‚¿ã‚¤ãƒŸãƒ³ã‚°ã®æœ€å°å€¤ã¨ç¯„å›²ã‚’è¨ˆç®—
    const minCharStart = Math.min(...flexibleCharsData.map(c => c.start));
    const maxCharEnd = Math.max(...flexibleCharsData.map(c => c.end));
    const originalDuration = maxCharEnd - minCharStart;
    const targetDuration = phraseEntranceEnd - phraseEntranceStart;
    
    // ã‚¹ã‚±ãƒ¼ãƒ«ä¿‚æ•°ã‚’è¨ˆç®—
    const timeScale = targetDuration / originalDuration;
    
    // ãƒ—ãƒªãƒŸãƒ†ã‚£ãƒ–ã®ã‚³ãƒ¼ãƒ«ãƒãƒƒã‚¯å†…ã§ã‚¿ã‚¤ãƒŸãƒ³ã‚°ã‚’å¤‰æ›
    this.flexibleLayoutPrimitive.manageCharacterContainersFlexible(
      container,
      layoutParams,
      (charContainer, charData) => {
        // å…ƒã®ãƒ‡ãƒ¼ã‚¿ã‚’å–å¾—ï¼ˆãƒ—ãƒªãƒŸãƒ†ã‚£ãƒ–ãŒå¤‰æ›´ã—ãŸã‚‚ã®ã‚’å…ƒã«æˆ»ã™ï¼‰
        const originalCharData = flexibleCharsData.find(c => c.id === charData.id);
        const actualCharStartMs = originalCharData ? originalCharData.start : charData.start;
        const actualCharEndMs = originalCharData ? originalCharData.end : charData.end;
        
        // ãƒ•ãƒ¬ãƒ¼ã‚ºå…¥å ´æœŸé–“å†…ã«åã¾ã‚‹ã‚ˆã†ã«ã‚¿ã‚¤ãƒŸãƒ³ã‚°ã‚’å¤‰æ›
        const transformedStartMs = phraseEntranceStart + (actualCharStartMs - minCharStart) * timeScale;
        const transformedEndMs = phraseEntranceStart + (actualCharEndMs - minCharStart) * timeScale;
        
        // å¤‰æ›ã•ã‚ŒãŸã‚¿ã‚¤ãƒŸãƒ³ã‚°ã§ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ã‚’å®Ÿè¡Œ
        this.animateContainer(charContainer, charData.char, {
          ...params,
          startMs: transformedStartMs,
          endMs: transformedEndMs
        });
      }
    );
  }
}
```

#### 2. å…¥å ´æœŸé–“ã®åˆ¤å®šãƒ­ã‚¸ãƒƒã‚¯

```typescript
// ãƒ•ãƒ¬ãƒ¼ã‚ºãƒ™ãƒ¼ã‚¹ã®å…¥å ´æœŸé–“åˆ¤å®š
const phraseActualStartMs = params.phraseStartMs as number || startMs;
const phraseHeadTime = params.headTimeOverride as number || params.phraseHeadTime as number || 800;
const phraseEntranceEndMs = phraseActualStartMs + phraseHeadTime;

// é‡è¦: ãƒ•ãƒ¬ãƒ¼ã‚ºé–‹å§‹æ™‚åˆ»+ãƒ˜ãƒƒãƒ‰ã‚¿ã‚¤ãƒ ã¾ã§ãŒå…¥å ´æœŸé–“
const isInEntrancePhase = forcePhraseTiming && 
                          nowMs >= charState.flickerStartTime && 
                          nowMs < phraseEntranceEndMs;
```

### å®Ÿè£…ä¸Šã®æ³¨æ„äº‹é …

#### 1. ãƒ—ãƒªãƒŸãƒ†ã‚£ãƒ–ã¨ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã®è²¬ä»»åˆ†æ‹…

- **ãƒ—ãƒªãƒŸãƒ†ã‚£ãƒ–ã®è²¬ä»»**: æ–‡å­—ã®é…ç½®ã€åŸºæœ¬çš„ãªè¡¨ç¤º/éè¡¨ç¤ºåˆ¶å¾¡
- **ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã®è²¬ä»»**: ã‚¿ã‚¤ãƒŸãƒ³ã‚°å¤‰æ›ã€ãƒ•ãƒ¬ãƒ¼ã‚ºãƒ™ãƒ¼ã‚¹ã®ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³åˆ¶å¾¡

```typescript
// ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆãŒå®Œå…¨ãªåˆ¶å¾¡ã‚’è¡Œã†
container.visible = true;  // ãƒ—ãƒªãƒŸãƒ†ã‚£ãƒ–ã®åˆ¶å¾¡ã‚’ä¸Šæ›¸ã
container.alpha = 1.0;     // ãƒ—ãƒªãƒŸãƒ†ã‚£ãƒ–ã®ã‚¢ãƒ«ãƒ•ã‚¡åˆ¶å¾¡ã‚’ç„¡åŠ¹åŒ–

// ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆå´ã§ç‹¬è‡ªã®è¡¨ç¤ºåˆ¶å¾¡
if (shouldBlink) {
  container.visible = false;
  container.alpha = 0;
} else {
  container.visible = true;
  container.alpha = calculatedAlpha;
}
```

#### 2. ã‚¿ã‚¤ãƒŸãƒ³ã‚°ã®ä¸€è²«æ€§ç¶­æŒ

```typescript
// æ–‡å­—çŠ¶æ…‹ã®åˆæœŸåŒ–æ™‚ã«ã‚¿ã‚¤ãƒŸãƒ³ã‚°ã‚’äº‹å‰è¨ˆç®—
const charState = {
  flickerStartTime: transformedStartMs - flickerEarlyStartMs,
  fadeInCompleteTime: transformedStartMs,
  fadeOutStartTime: transformedEndMs,
  fadeOutDuration: params.fadeOutDuration as number || 500
};

// ä¿å­˜ã—ã¦å†åˆ©ç”¨
(container as any).__charState = charState;
```

### é–‹ç™ºæ™‚ã«ç™ºç”Ÿã—ãŸä¸å…·åˆã¨è§£æ±ºæ–¹æ³•

#### ä¸å…·åˆ1: ç‚¹æ»…ã‚¨ãƒ•ã‚§ã‚¯ãƒˆãŒé©ç”¨ã•ã‚Œãªã„

**åŸå› **: 
- `isInEntrancePhase`ã®åˆ¤å®šãŒ `nowMs < phraseActualStartMs` ã‚’ä½¿ç”¨ã—ã¦ã„ãŸãŸã‚ã€ãƒ•ãƒ¬ãƒ¼ã‚ºé–‹å§‹å¾Œã¯å…¥å ´æœŸé–“ã¨ã—ã¦èªè­˜ã•ã‚Œãªã‹ã£ãŸ
- `baseAlpha`ãŒ1.0ã«ãªã‚‹ã¨`fullDisplayThreshold`ã‚’è¶…ãˆã¦ç‚¹æ»…ãŒåœæ­¢ã—ã¦ã„ãŸ

**è§£æ±ºæ–¹æ³•**:
```typescript
// ä¿®æ­£å‰
const isInEntrancePhase = forcePhraseTiming && 
                          nowMs >= charState.flickerStartTime && 
                          nowMs < phraseActualStartMs;

// ä¿®æ­£å¾Œ: ãƒ˜ãƒƒãƒ‰ã‚¿ã‚¤ãƒ ã‚’å«ã‚ãŸå…¥å ´æœŸé–“ã‚’æ­£ã—ãåˆ¤å®š
const phraseEntranceEndMs = phraseActualStartMs + phraseHeadTime;
const isInEntrancePhase = forcePhraseTiming && 
                          nowMs >= charState.flickerStartTime && 
                          nowMs < phraseEntranceEndMs;

// å…¥å ´æœŸé–“ä¸­ã®ç‰¹åˆ¥ãªç‚¹æ»…ãƒ­ã‚¸ãƒƒã‚¯
if (forcePhraseTiming && isInEntrancePhase) {
  // baseAlphaãŒ1.0ã§ã‚‚ç‚¹æ»…ã‚’ç¶™ç¶š
  const entranceProgress = (nowMs - charState.flickerStartTime) / 
                           (phraseEntranceEndMs - charState.flickerStartTime);
  const flickerAlpha = Math.min(entranceProgress, 0.9);
  // ç‚¹æ»…è¨ˆç®—...
}
```

#### ä¸å…·åˆ2: ãƒ•ã‚§ãƒ¼ãƒ‰ã‚¤ãƒ³æœŸé–“ã®æ¡ä»¶åˆ†å²ã«å…¥ã‚‰ãªã„

**åŸå› **: 
- `progress`ãŒ1.0ã«ãªã£ã¦ã„ã¦ã‚‚ã€ãƒ•ã‚§ãƒ¼ãƒ‰ã‚¤ãƒ³æœŸé–“ã®æ¡ä»¶ï¼ˆ`nowMs < charState.fadeInCompleteTime`ï¼‰ã‚’æº€ãŸã•ãªã‹ã£ãŸ

**è§£æ±ºæ–¹æ³•**:
```typescript
// ä¿®æ­£å‰
} else if (nowMs < charState.fadeInCompleteTime) {

// ä¿®æ­£å¾Œ: å…¥å ´æœŸé–“ä¸­ã‚‚å«ã‚ã‚‹
} else if (nowMs < charState.fadeInCompleteTime || (isInEntrancePhase && nowMs < phraseEndMs)) {
```

#### ä¸å…·åˆ3: æ§‹æ–‡ã‚¨ãƒ©ãƒ¼ï¼ˆã‚¤ãƒ³ãƒ‡ãƒ³ãƒˆä¸æ•´åˆï¼‰

**åŸå› **:
- è¤‡é›‘ãªif-elseæ–‡ã®æ§‹é€ ã§ã‚¤ãƒ³ãƒ‡ãƒ³ãƒˆãŒä¸æ•´åˆã«ãªã‚Šã€æ‹¬å¼§ã®å¯¾å¿œãŒå´©ã‚ŒãŸ

**è§£æ±ºæ–¹æ³•**:
- å„if-elseç¯€ã®ã‚¤ãƒ³ãƒ‡ãƒ³ãƒˆã‚’çµ±ä¸€
- å…¥å ´æœŸé–“ã®å‡¦ç†ã‚’å«ã‚€å¤§ããªif-elseæ–‡ã‚’é©åˆ‡ã«é–‰ã˜ã‚‹

### ãƒ—ãƒªãƒŸãƒ†ã‚£ãƒ–APIã®åˆ¶ç´„ã¨å¯¾å‡¦æ–¹æ³•

#### åˆ¶ç´„1: ãƒ—ãƒªãƒŸãƒ†ã‚£ãƒ–ã®ã‚¿ã‚¤ãƒŸãƒ³ã‚°åˆ¶å¾¡

**åˆ¶ç´„å†…å®¹**: 
FlexibleCumulativeLayoutPrimitiveã¯`wordDisplayMode`ã§è¡¨ç¤ºãƒ¢ãƒ¼ãƒ‰ã‚’åˆ¶å¾¡ã™ã‚‹ãŒã€å€‹ã€…ã®æ–‡å­—ã®ã‚¿ã‚¤ãƒŸãƒ³ã‚°ã¯å…ƒã®ãƒ‡ãƒ¼ã‚¿ã‚’ä½¿ç”¨ã™ã‚‹ã€‚

**å¯¾å‡¦æ–¹æ³•**:
```typescript
// ãƒ—ãƒªãƒŸãƒ†ã‚£ãƒ–ã«æ¸¡ã™å‰ã®ãƒ‡ãƒ¼ã‚¿ã‚’ä¿æŒ
const originalCharsData = [...flexibleCharsData];

// ãƒ—ãƒªãƒŸãƒ†ã‚£ãƒ–ã®ã‚³ãƒ¼ãƒ«ãƒãƒƒã‚¯å†…ã§å…ƒã®ãƒ‡ãƒ¼ã‚¿ã‚’å¾©å…ƒ
(charContainer, charData) => {
  const originalData = originalCharsData.find(d => d.id === charData.id);
  // originalDataã‚’ä½¿ç”¨ã—ã¦ã‚¿ã‚¤ãƒŸãƒ³ã‚°ã‚’åˆ¶å¾¡
}
```

#### åˆ¶ç´„2: è¡¨ç¤ºåˆ¶å¾¡ã®ç«¶åˆ

**åˆ¶ç´„å†…å®¹**: 
ãƒ—ãƒªãƒŸãƒ†ã‚£ãƒ–ãŒ`container.visible`ã‚„`container.alpha`ã‚’åˆ¶å¾¡ã™ã‚‹ãŸã‚ã€ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã®åˆ¶å¾¡ã¨ç«¶åˆã™ã‚‹ã€‚

**å¯¾å‡¦æ–¹æ³•**:
```typescript
// ãƒ—ãƒªãƒŸãƒ†ã‚£ãƒ–ã®å‡¦ç†å¾Œã«å¼·åˆ¶çš„ã«ä¸Šæ›¸ã
container.visible = true;  // å¼·åˆ¶çš„ã«è¡¨ç¤ºã‚’æœ‰åŠ¹åŒ–
container.alpha = 1.0;     // ãƒ—ãƒªãƒŸãƒ†ã‚£ãƒ–ã®ã‚¢ãƒ«ãƒ•ã‚¡åˆ¶å¾¡ã‚’ç„¡åŠ¹åŒ–

// ãã®å¾Œã€ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆç‹¬è‡ªã®åˆ¶å¾¡ã‚’é©ç”¨
container.visible = containerVisible;
container.alpha = containerAlpha;
```

### å®Ÿè£…ãƒã‚§ãƒƒã‚¯ãƒªã‚¹ãƒˆ

ãƒ•ãƒ¬ãƒ¼ã‚ºã‚¿ã‚¤ãƒŸãƒ³ã‚°å„ªå…ˆæ©Ÿèƒ½ã‚’å®Ÿè£…ã™ã‚‹éš›ã®ãƒã‚§ãƒƒã‚¯ãƒªã‚¹ãƒˆï¼š

- [ ] `forcePhraseTiming`ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã®è¿½åŠ ã¨é©åˆ‡ãªãƒ‡ãƒ•ã‚©ãƒ«ãƒˆå€¤è¨­å®š
- [ ] ãƒ•ãƒ¬ãƒ¼ã‚ºã®å…¥å ´æœŸé–“ï¼ˆHeadTimeï¼‰ã®æ­£ç¢ºãªè¨ˆç®—
- [ ] ã‚¿ã‚¤ãƒŸãƒ³ã‚°å¤‰æ›ã®ã‚¹ã‚±ãƒ¼ãƒ«ä¿‚æ•°è¨ˆç®—
- [ ] å…ƒã®ã‚¿ã‚¤ãƒŸãƒ³ã‚°ãƒ‡ãƒ¼ã‚¿ã®ä¿æŒã¨å¾©å…ƒ
- [ ] `isInEntrancePhase`ã®æ­£ç¢ºãªåˆ¤å®š
- [ ] ãƒ—ãƒªãƒŸãƒ†ã‚£ãƒ–ã®åˆ¶å¾¡ã‚’é©åˆ‡ã«ä¸Šæ›¸ã
- [ ] å…¥å ´æœŸé–“ä¸­ã®ç‰¹åˆ¥ãªç‚¹æ»…ãƒ­ã‚¸ãƒƒã‚¯ã®å®Ÿè£…
- [ ] ãƒ•ã‚§ãƒ¼ãƒ‰ã‚¤ãƒ³/ã‚¢ã‚¦ãƒˆã®æ¡ä»¶åˆ†å²ã®èª¿æ•´
- [ ] ãƒ‡ãƒãƒƒã‚°ãƒ­ã‚°ã®é©åˆ‡ãªé…ç½®ï¼ˆé–‹ç™ºæ™‚ï¼‰

### ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹è€ƒæ…®äº‹é …

1. **ã‚¿ã‚¤ãƒŸãƒ³ã‚°è¨ˆç®—ã®ã‚­ãƒ£ãƒƒã‚·ãƒ¥**: æ–‡å­—çŠ¶æ…‹ã‚’`__charState`ã¨ã—ã¦ä¿å­˜ã—ã€æ¯ãƒ•ãƒ¬ãƒ¼ãƒ å†è¨ˆç®—ã‚’é¿ã‘ã‚‹
2. **ãƒ‡ãƒãƒƒã‚°ãƒ­ã‚°ã®åˆ¶é™**: æœ¬ç•ªç’°å¢ƒã§ã¯æœ€å°é™ã«æŠ‘ãˆã‚‹
3. **æ¡ä»¶åˆ†å²ã®æœ€é©åŒ–**: æœ€ã‚‚é »ç¹ã«å®Ÿè¡Œã•ã‚Œã‚‹ã‚±ãƒ¼ã‚¹ã‚’å…ˆã«é…ç½®

### ã¾ã¨ã‚

ãƒ•ãƒ¬ãƒ¼ã‚ºã‚¿ã‚¤ãƒŸãƒ³ã‚°å„ªå…ˆå®Ÿè£…ã¯ã€ãƒ—ãƒªãƒŸãƒ†ã‚£ãƒ–APIã®åˆ¶ç´„ã‚’ç†è§£ã—ã€é©åˆ‡ãªãƒ©ãƒƒãƒ”ãƒ³ã‚°å‡¦ç†ã‚’è¡Œã†ã“ã¨ã§å®Ÿç¾ã§ãã¾ã™ã€‚é‡è¦ãªã®ã¯ï¼š

1. ãƒ—ãƒªãƒŸãƒ†ã‚£ãƒ–ã¨ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã®è²¬ä»»åˆ†æ‹…ã‚’æ˜ç¢ºã«ã™ã‚‹
2. ã‚¿ã‚¤ãƒŸãƒ³ã‚°å¤‰æ›ãƒ­ã‚¸ãƒƒã‚¯ã‚’æ­£ç¢ºã«å®Ÿè£…ã™ã‚‹
3. å…¥å ´æœŸé–“ã®åˆ¤å®šã‚’æ­£ã—ãè¡Œã†
4. ãƒ—ãƒªãƒŸãƒ†ã‚£ãƒ–ã®åˆ¶å¾¡ã‚’å¿…è¦ã«å¿œã˜ã¦ä¸Šæ›¸ãã™ã‚‹

ã“ã®å®Ÿè£…ãƒ‘ã‚¿ãƒ¼ãƒ³ã¯ã€ä»–ã®ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã§ã‚‚åŒæ§˜ã®ãƒ•ãƒ¬ãƒ¼ã‚ºãƒ™ãƒ¼ã‚¹ã®åˆ¶å¾¡ãŒå¿…è¦ãªå ´åˆã«å‚è€ƒã«ãªã‚Šã¾ã™ã€‚

---

## ã‚ˆãã‚ã‚‹å¤±æ•—äº‹ä¾‹ã¨å¯¾ç­–

å®Ÿéš›ã®ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆé–‹ç™ºã§é­é‡ã—ãŸå•é¡Œã¨è§£æ±ºæ–¹æ³•ã‚’ç´¹ä»‹ã—ã¾ã™ã€‚

### 0. ã‚·ãƒ¼ã‚¯æ¤œå‡ºã«ã‚ˆã‚‹çŠ¶æ…‹ç®¡ç†ã®ç ´ç¶»ï¼ˆæœ€é‡è¦ãƒ»ç¦æ­¢ãƒ‘ã‚¿ãƒ¼ãƒ³ï¼‰â—

**æœ€ã‚‚å±é™ºãªã‚¢ãƒ³ãƒãƒ‘ã‚¿ãƒ¼ãƒ³**: ã‚·ãƒ¼ã‚¯æ¤œå‡ºãƒ­ã‚¸ãƒƒã‚¯ã®å®Ÿè£…ã«ã‚ˆã‚Šã€é€šå¸¸å†ç”Ÿã¨ã‚·ãƒ¼ã‚¯æ“ä½œã§ç•°ãªã‚‹ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³å‹•ä½œãŒç™ºç”Ÿã™ã‚‹å•é¡Œã€‚

**âŒ å•é¡Œäº‹ä¾‹**: BlackBandMaskTextPrimitive ã§ã®å®Ÿè£…ï¼ˆç¾åœ¨ã¯ä¿®æ­£æ¸ˆã¿ï¼‰
```typescript
// âŒ å±é™º: ã‚·ãƒ¼ã‚¯æ¤œå‡ºãƒ­ã‚¸ãƒƒã‚¯
private lastTimeState = new Map<string, number>();
private animationRestartState = new Map<string, {
  restartTime: number;
  isRestarting: boolean;
  originalStartTime: number;
}>();

private detectSeek(nowMs: number, phraseId: string): boolean {
  const lastTime = this.lastTimeState.get(phraseId) || 0;
  const threshold = 100; // 100ms
  const isSeekDetected = Math.abs(nowMs - lastTime) > threshold;
  this.lastTimeState.set(phraseId, nowMs);
  return isSeekDetected;
}

renderPhraseContainer(container: PIXI.Container, params: any, nowMs: number, startMs: number, endMs: number) {
  const phraseId = params.phraseId as string;
  const isSeekDetected = this.detectSeek(nowMs, phraseId);
  
  if (isSeekDetected) {
    // âŒ ã“ã®æ™‚ç‚¹ã§ restartTime = nowMs ã«ãªã‚Šã€æœ¬æ¥ã®ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³é–‹å§‹æ™‚é–“ã‚’ç ´å£Š
    this.startAnimationRestart(phraseId, nowMs, startMs);
  }
  
  // âŒ çµæœ: é€šå¸¸å†ç”Ÿã§ã¯800mså‰ã‹ã‚‰ã‚¹ãƒ¯ã‚¤ãƒ—ã‚¤ãƒ³ã€ã‚·ãƒ¼ã‚¯æ™‚ã¯80mså‰ã‹ã‚‰é–‹å§‹
}
```

**âœ… æ­£ã—ã„è§£æ±ºæ–¹æ³•**: ç´”ç²‹ãªæ™‚é–“ãƒ™ãƒ¼ã‚¹è¨ˆç®—
```typescript
// âœ… æ­£ã—ã„: ã™ã¹ã¦æ™‚é–“ã‹ã‚‰ç´”ç²‹è¨ˆç®—
renderPhraseContainer(container: PIXI.Container, params: any, nowMs: number, startMs: number, endMs: number) {
  const headTime = (params.headTime as number) || 500;
  const tailTime = (params.tailTime as number) || 500;
  
  // ã‚·ãƒ¼ã‚¯æ¤œå‡ºä¸è¦ - ã™ã¹ã¦æ™‚é–“ã‹ã‚‰ç›´æ¥è¨ˆç®—
  const swipeInStartTime = startMs - headTime;
  const swipeOutEndTime = endMs + tailTime;
  
  if (nowMs >= swipeInStartTime && nowMs <= swipeOutEndTime) {
    // ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³å®Ÿè¡Œï¼ˆé€šå¸¸å†ç”Ÿã§ã‚‚ã‚·ãƒ¼ã‚¯ã§ã‚‚åŒä¸€å‹•ä½œï¼‰
    const progress = this.calculateSwipeProgress(nowMs, swipeInStartTime, startMs, endMs, tailTime);
    this.applySwipeAnimation(container, progress);
  } else {
    // æ™‚é–“ç¯„å›²å¤–ã§ã¯ã‚¯ãƒªãƒ¼ãƒ³ã‚¢ãƒƒãƒ—
    this.cleanupElements(container);
  }
}

// ç´”ç²‹é–¢æ•°ã«ã‚ˆã‚‹é€²è¡Œåº¦è¨ˆç®—
private calculateSwipeProgress(nowMs: number, swipeInStart: number, activeStart: number, activeEnd: number, tailTime: number): number {
  if (nowMs <= swipeInStart) return 0;
  if (nowMs <= activeStart) return (nowMs - swipeInStart) / (activeStart - swipeInStart);
  if (nowMs <= activeEnd) return 1;
  if (nowMs <= activeEnd + tailTime) return 1 - (nowMs - activeEnd) / tailTime;
  return 0;
}
```

**ã“ã®å®Ÿè£…ãƒ‘ã‚¿ãƒ¼ãƒ³ãŒç¦æ­¢ã•ã‚Œã‚‹ç†ç”±**:
1. **ã‚¿ã‚¤ãƒŸãƒ³ã‚°ä¸æ•´åˆ**: å†ç”Ÿæ–¹æ³•ã«ã‚ˆã‚Šç•°ãªã‚‹ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³å‹•ä½œ
2. **ãƒ‡ãƒãƒƒã‚°å›°é›£**: çŠ¶æ…‹ãŒåˆ†æ•£ã—ã€å•é¡Œã®ç‰¹å®šãŒå›°é›£
3. **äºˆæœŸã—ãªã„ãƒã‚°**: ã‚¨ãƒƒã‚¸ã‚±ãƒ¼ã‚¹ã§äºˆæƒ³å¤–ã®å‹•ä½œ
4. **ãƒ¡ãƒ³ãƒ†ãƒŠãƒ³ã‚¹å›°é›£**: ãƒ­ã‚¸ãƒƒã‚¯ãŒè¤‡é›‘åŒ–ã—ã€ä¿®æ­£ãŒå›°é›£

### 1. æ–‡å­—é‡è¤‡è¡¨ç¤ºå•é¡Œï¼ˆé‡è¦ï¼‰â— v2.1æ›´æ–°

**UTAVISTA v2.1ã§ã¯ã€æ–‡å­—é‡è¤‡è¡¨ç¤ºã‚’é˜²æ­¢ã™ã‚‹å®‰å…¨æ©Ÿèƒ½ãŒè¿½åŠ ã•ã‚Œã¾ã—ãŸã€‚** è©³ç´°ã¯ã€Œ[ğŸš¨ æ–‡å­—é‡è¤‡è¡¨ç¤ºé˜²æ­¢ã‚¬ã‚¤ãƒ‰](#æ–‡å­—é‡è¤‡è¡¨ç¤ºé˜²æ­¢ã‚¬ã‚¤ãƒ‰)ã€ã‚’å‚ç…§ã—ã¦ãã ã•ã„ã€‚

**âŒ å•é¡Œ**: æ–‡å­—ã‚³ãƒ³ãƒ†ãƒŠã®é‡è¤‡ä½œæˆã«ã‚ˆã‚Šã€åŒã˜æ–‡å­—ãŒè¤‡æ•°å›è¡¨ç¤ºã•ã‚Œã‚‹
```typescript
// âŒ é–“é•ã£ãŸå®Ÿè£…: ãƒ—ãƒªãƒŸãƒ†ã‚£ãƒ–ã¨æ—¢å­˜ã‚·ã‚¹ãƒ†ãƒ ã®ä½µç”¨
layoutPrimitive.manageCharacterContainers(wordContainer, params);  // ã‚³ãƒ³ãƒ†ãƒŠä½œæˆâ‘ 
params.chars.forEach(charData => {
  const charContainer = new PIXI.Container();  // ã‚³ãƒ³ãƒ†ãƒŠä½œæˆâ‘¡ â†’ é‡è¤‡!
});
```

**âœ… v2.1 æ¨å¥¨è§£æ±ºæ–¹æ³•**: SafeCharacterManager ã®ä½¿ç”¨
```typescript
import { SafeCharacterManager, CharacterManagementMode } from '../primitives/safe/SafeCharacterManager';

// å®‰å…¨ãªæ–‡å­—ç®¡ç†
const safeManager = new SafeCharacterManager({
  mode: CharacterManagementMode.COOPERATIVE,
  containerPrefix: 'char_container_',
  layoutParams: { fontSize: 32, charSpacing: 1.0, halfWidthSpacingRatio: 0.6, alignment: 'left' },
  enableSafetyChecks: true,
  enableDebugLogs: process.env.NODE_ENV === 'development'
});

const result = safeManager.manageCharacters(wordContainer, text, characters, 
  (charContainer, charData, position) => {
    this.renderCharContainer(charContainer, charData.char, params, nowMs, startMs, endMs, phase);
  }
);
```

**âœ… å¾“æ¥ã®è§£æ±ºæ–¹æ³•**: å˜ä¸€è²¬ä»»ã§ã®ã‚³ãƒ³ãƒ†ãƒŠç®¡ç†
```typescript
// æ—¢å­˜ã‚·ã‚¹ãƒ†ãƒ ã®ã¿ä½¿ç”¨ï¼ˆãƒ—ãƒªãƒŸãƒ†ã‚£ãƒ–ã¨ã®ä½µç”¨ç¦æ­¢ï¼‰
if (params.chars && Array.isArray(params.chars)) {
  params.chars.forEach((charData: any, index: number) => {
    // æ—¢å­˜ã‚³ãƒ³ãƒ†ãƒŠæ¤œç´¢
    let charContainer: PIXI.Container | null = null;
    container.children.forEach((child: any) => {
      if (child instanceof PIXI.Container && 
          (child as any).name === `char_container_${charData.id}`) {
        charContainer = child as PIXI.Container;
      }
    });
    
    // æ–°è¦ä½œæˆï¼ˆå¿…è¦æ™‚ã®ã¿ï¼‰
    if (!charContainer) {
      charContainer = new PIXI.Container();
      (charContainer as any).name = `char_container_${charData.id}`;
      container.addChild(charContainer);
    }
    
    // ç´¯ç©ä½ç½®è¨ˆç®—
    const charSpacing = params.charSpacing || 1.0;
    const fontSize = params.fontSize || 32;
    charContainer.position.set(cumulativeXOffset, 0);
    cumulativeXOffset += fontSize * charSpacing;
  });
}
```

### 1. æ–‡å­—ä½ç½®è¨ˆç®—ã®éšå±¤é–“é•ã„ï¼ˆé‡è¦ï¼‰

**âŒ å•é¡Œ**: å…¨ã¦ã®æ–‡å­—ãŒåŒã˜åº§æ¨™ã«è¡¨ç¤ºã•ã‚Œã‚‹

```typescript
// âŒ é–“é•ã£ãŸå®Ÿè£…
renderWordContainer(container, text, params, ...): boolean {
  this.applyWordSlideAnimation(container, params, ...);
  this.applyCharacterSpacing(container, params); // ã“ã“ã§å®Ÿè¡Œã™ã‚‹ã®ãŒé–“é•ã„
  return true;
}
```

**âœ… è§£æ±ºæ–¹æ³•**: æ–‡å­—ä½ç½®è¨ˆç®—ã¯æ–‡å­—ãƒ¬ãƒ™ãƒ«ã§ã®ã¿å®Ÿè¡Œ

```typescript
// âœ… æ­£ã—ã„å®Ÿè£…
renderCharContainer(container, text, params, ...): boolean {
  this.applyCharacterPosition(container, params); // æ–‡å­—ãƒ¬ãƒ™ãƒ«ã§å®Ÿè¡Œ
  this.renderCharacterText(container, text, params, ...);
  return true;
}

private applyCharacterPosition(container: PIXI.Container, params: Record<string, unknown>): void {
  const charIndex = this.getParam(params, 'charIndex', 0);
  const fontSize = this.getParam(params, 'fontSize', 120);
  const charSpacing = this.getParam(params, 'charSpacing', 1.0);
  
  const xOffset = charIndex * fontSize * charSpacing * 0.6;
  container.position.set(xOffset, container.position.y);
}
```

**æ¤œè¨¼æ–¹æ³•**:
```typescript
// ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆå®Ÿè£…æ¤œè¨¼ãƒã‚§ãƒƒã‚¯ãƒªã‚¹ãƒˆ
function validateCharacterPositioning(template: IAnimationTemplate): ValidationResult {
  const results = {
    passed: [],
    failed: [],
    warnings: []
  };
  
  // 1. renderCharContainerã§æ–‡å­—ä½ç½®è¨ˆç®—ã‚’å®Ÿè¡Œã—ã¦ã„ã‚‹ã‹
  if (!template.renderCharContainer.toString().includes('charIndex')) {
    results.failed.push('renderCharContainer does not use charIndex parameter');
  }
  
  // 2. renderWordContainerã§æ–‡å­—ä½ç½®è¨ˆç®—ã‚’ã—ã¦ã„ãªã„ã‹
  if (template.renderWordContainer.toString().includes('CharacterSpacing') ||
      template.renderWordContainer.toString().includes('charIndex')) {
    results.failed.push('renderWordContainer incorrectly handles character positioning');
  }
  
  // 3. å¿…è¦ãªãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ãŒå®šç¾©ã•ã‚Œã¦ã„ã‚‹ã‹
  const params = template.getParameterConfig?.() || [];
  const hasCharSpacing = params.some(p => p.name === 'charSpacing');
  const hasFontSize = params.some(p => p.name === 'fontSize');
  
  if (!hasCharSpacing) results.failed.push('Missing charSpacing parameter');
  if (!hasFontSize) results.failed.push('Missing fontSize parameter');
  
  return {
    valid: results.failed.length === 0,
    errors: results.failed,
    warnings: results.warnings
  };
}
```

### 2. ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼è“„ç©ã¨ãƒªã‚½ãƒ¼ã‚¹ç®¡ç†ã®å•é¡Œ

#### å¤±æ•—äº‹ä¾‹
```typescript
// ã‚·ãƒ£ãƒ‰ã‚¦åŠå¾„ãŒéš›é™ãªãæ‹¡å¤§ã—ã¦ã„ãå•é¡Œ
renderPhraseContainer(...) {
  // æ¯ãƒ•ãƒ¬ãƒ¼ãƒ æ–°ã—ã„ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã‚’ä½œæˆ
  const animation = this.buildPhraseAnimation(params, nowMs, startMs, endMs);
  animation.apply(context, progress); // ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼ãŒç´¯ç©ã•ã‚Œã¦ã„ã
}
```

#### åŸå› 
- ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆãŒæ¯ãƒ•ãƒ¬ãƒ¼ãƒ å†ä½œæˆã•ã‚Œã‚‹
- ã‚¨ãƒ•ã‚§ã‚¯ãƒˆãƒ—ãƒªãƒŸãƒ†ã‚£ãƒ–ã®`initialized`ãƒ•ãƒ©ã‚°ãŒãƒªã‚»ãƒƒãƒˆã•ã‚Œã‚‹
- ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼ãŒé‡è¤‡ã—ã¦è¿½åŠ ã•ã‚Œç´¯ç©ã•ã‚Œã‚‹

#### å¯¾ç­–
```typescript
// ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã®ã‚­ãƒ£ãƒƒã‚·ãƒ¥åŒ–
class CompleteWordSlideTemplateClass implements IAnimationTemplate {
  private animations = new Map<string, CompositeAnimation>();
  
  renderPhraseContainer(...) {
    // ã‚³ãƒ³ãƒ†ãƒŠIDã‚’ç”Ÿæˆ
    const containerId = (container as any).name || `phrase_${startMs}_${text.substring(0, 10)}`;
    
    // ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã‹ã‚‰å–å¾—ã€ã¾ãŸã¯æ–°è¦ä½œæˆ
    let animation = this.animations.get(containerId);
    if (!animation) {
      animation = this.buildPhraseAnimation(params, nowMs, startMs, endMs);
      this.animations.set(containerId, animation);
    }
    
    // ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ã®é©ç”¨
    animation.apply(context, progress);
  }
}
```

#### ãƒ‡ãƒãƒƒã‚°æ–¹æ³•
```typescript
// ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼æ•°ã®ç›£è¦–
if (context.container.filters && context.container.filters.length > 10) {
  console.warn(`[EffectPrimitive] Too many filters detected: ${context.container.filters.length}`);
  console.log('[EffectPrimitive] Filter list:', context.container.filters.map(f => f.constructor.name));
}

// ã‚·ãƒ£ãƒ‰ã‚¦ã®ç•°å¸¸å€¤æ¤œå‡º
if (newDistance > 1000 || newDistance < 0) {
  console.warn(`[ShadowEffect] Abnormal distance detected: ${newDistance}`);
  return;
}
```

### 3. é«˜DPIãƒ‡ã‚£ã‚¹ãƒ—ãƒ¬ã‚¤ã§ã®æ–‡å­—ã‚µã‚¤ã‚ºå•é¡Œ

#### å¤±æ•—äº‹ä¾‹
```typescript
// æ–‡å­—æ‹¡å¤§ã‚¨ãƒ•ã‚§ã‚¯ãƒˆå®Ÿè£…æ™‚
textObj = TextStyleFactory.createHighDPIText(text, {
  fontSize: 93,  // è¨­å®šå€¤
  // ...
});
textObj.scale.set(8, 8); // 8å€æ‹¡å¤§

// çµæœ: Retinaãƒ‡ã‚£ã‚¹ãƒ—ãƒ¬ã‚¤ã§æƒ³å®šã®2å€ã®å¤§ãã•ã«è¡¨ç¤ºã•ã‚Œã‚‹
```

#### åŸå› 
`createHighDPIText()`ã¯devicePixelRatioï¼ˆRetinaã§ã¯2.0ï¼‰ã‚’è€ƒæ…®ã—ã¦ï¼š
- ãƒ•ã‚©ãƒ³ãƒˆã‚µã‚¤ã‚ºã‚’è‡ªå‹•æ‹¡å¤§: 93px â†’ 186px
- ãƒ†ã‚­ã‚¹ãƒˆscaleã‚’è‡ªå‹•ç¸®å°: 1.0 â†’ 0.5
- æœ€çµ‚çš„ãªã‚¹ã‚±ãƒ¼ãƒ«: 0.5 Ã— 8 = 4å€ï¼ˆè¦‹ãŸç›®ã¯8å€ç›¸å½“ã ãŒã€ãƒ™ãƒ¼ã‚¹ã‚µã‚¤ã‚ºãŒ2å€ï¼‰

#### å¯¾ç­–
```typescript
// æ­£ç¢ºãªã‚µã‚¤ã‚ºåˆ¶å¾¡ãŒå¿…è¦ãªå ´åˆã¯createText()ã‚’ä½¿ç”¨
textObj = TextStyleFactory.createText(text, {
  fontSize: 93,  // ã“ã®å€¤ãŒãã®ã¾ã¾ä½¿ç”¨ã•ã‚Œã‚‹
  // ...
});
textObj.scale.set(8, 8); // æœŸå¾…é€šã‚Šã®8å€æ‹¡å¤§
```

### 4. æ–‡å­—ãŒè¡¨ç¤ºã•ã‚Œãªã„å•é¡Œï¼ˆremoveVisualElementsï¼‰

#### å¤±æ•—äº‹ä¾‹
```typescript
// æ–‡å­—ãŒä½œæˆã•ã‚Œã‚‹ãŒæ¯ãƒ•ãƒ¬ãƒ¼ãƒ å‰Šé™¤ã•ã‚Œã‚‹
renderCharContainer(...) {
  // ãƒ†ã‚­ã‚¹ãƒˆã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã®ä½œæˆ
  const textObj = TextStyleFactory.createHighDPIText(text, style);
  container.addChild(textObj);
  
  // æ¬¡ã®ãƒ•ãƒ¬ãƒ¼ãƒ ã§removeVisualElementsãŒå‘¼ã°ã‚Œã¦å‰Šé™¤ã•ã‚Œã‚‹
}

removeVisualElements(container: PIXI.Container): void {
  // å…¨ã¦ã®å­è¦ç´ ã‚’å‰Šé™¤
  container.children.forEach(child => {
    container.removeChild(child);
    child.destroy();
  });
}
```

#### åŸå› 
`removeVisualElements`ãŒæ¯ãƒ•ãƒ¬ãƒ¼ãƒ å‘¼ã°ã‚Œã€æ–‡å­—ã‚³ãƒ³ãƒ†ãƒŠå†…ã®ãƒ†ã‚­ã‚¹ãƒˆã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã‚‚å‰Šé™¤ã•ã‚Œã‚‹

#### å¯¾ç­–
```typescript
removeVisualElements(container: PIXI.Container): void {
  const containerName = (container as any).name || 'unnamed';
  
  // æ–‡å­—ã‚³ãƒ³ãƒ†ãƒŠã®å ´åˆã¯ã€ã‚³ãƒ³ãƒ†ãƒŠéšå±¤ã‚’ç¶­æŒã—ã¦ä»–ã®è¦ç´ ã®ã¿ã‚’å‰Šé™¤
  if (containerName.includes('char_container_')) {
    const childrenToRemove = container.children.filter(child => {
      const childName = (child as any).name;
      // å­ã‚³ãƒ³ãƒ†ãƒŠã¯ä¿æŒ
      const isContainer = child instanceof PIXI.Container && 
                         childName && 
                         (childName.includes('phrase_container_') || 
                          childName.includes('word_container_') || 
                          childName.includes('char_container_'));
      return !isContainer; // ã‚³ãƒ³ãƒ†ãƒŠä»¥å¤–ã‚’å‰Šé™¤å¯¾è±¡ã¨ã™ã‚‹
    });
    
    childrenToRemove.forEach(child => {
      container.removeChild(child);
      child.destroy();
    });
  }
}
```

### 5. æ–‡å­—ã‚¹ã‚±ãƒ¼ãƒªãƒ³ã‚°åŠ¹æœãŒé©ç”¨ã•ã‚Œãªã„å•é¡Œ

#### å¤±æ•—äº‹ä¾‹
```typescript
renderCharContainer(...) {
  // æ¯ãƒ•ãƒ¬ãƒ¼ãƒ æ–°ã—ã„Textã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã‚’ä½œæˆ
  const textObj = new PIXI.Text(text, style);
  textObj.scale.set(8, 8);  // ã‚¹ã‚±ãƒ¼ãƒ«è¨­å®š
  container.addChild(textObj);
  
  // æ¬¡ã®ãƒ•ãƒ¬ãƒ¼ãƒ ã§removeVisualElementsãŒå‘¼ã°ã‚Œã¦å‰Šé™¤ã•ã‚Œã‚‹
}
```

#### åŸå› 
`removeVisualElements`ãŒæ¯ãƒ•ãƒ¬ãƒ¼ãƒ å‘¼ã°ã‚Œã€è¨­å®šã—ãŸã‚¹ã‚±ãƒ¼ãƒ«ã”ã¨Textã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆãŒå‰Šé™¤ã•ã‚Œã‚‹

#### å¯¾ç­–
```typescript
// animateContainerã§æ–‡å­—ãƒ¬ãƒ™ãƒ«ã®å ´åˆã¯å‰Šé™¤ã‚’ã‚¹ã‚­ãƒƒãƒ—
if (hierarchyType !== 'char') {
  this.removeVisualElements!(container);
}

// removeVisualElementsã§ãƒ†ã‚­ã‚¹ãƒˆã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã‚’ä¿è­·
if (child instanceof PIXI.Text && child.name === 'text') {
  childrenToKeep.push(child);
}

// renderCharContainerã§ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã‚’å†åˆ©ç”¨
let textObj = container.getChildByName('text') as PIXI.Text;
if (!textObj) {
  textObj = TextStyleFactory.createText(text, style);
  textObj.name = 'text';  // é‡è¦: åå‰ã‚’è¨­å®š
  container.addChild(textObj);
}
```

### 6. ãƒ‡ãƒãƒƒã‚°ãƒ­ã‚°ã®éå‰°å‡ºåŠ›ã¨ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹å•é¡Œ

#### å¤±æ•—äº‹ä¾‹
```typescript
// æ¯ãƒ•ãƒ¬ãƒ¼ãƒ ãƒ­ã‚°å‡ºåŠ›ã§ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ä½ä¸‹ã¨ãƒ­ã‚°ã®å¯èª­æ€§ä½ä¸‹
renderCharContainer(...) {
  console.log(`[Template] Character rendered: ${text}`);
  console.log(`[EffectPrimitive] Effect applied with progress ${progress}`);
  console.log(`[ShadowEffect] Shadow updated: distance=${distance}`);
}
```

#### åŸå› 
- 60fps ã§å®Ÿè¡Œã•ã‚Œã‚‹ãŸã‚ã€æ¯ç§’180å›ã®ãƒ­ã‚°ãŒå‡ºåŠ›ã•ã‚Œã‚‹
- ãƒ­ã‚°ã®é‡ãŒè†¨å¤§ã§ãƒ‡ãƒãƒƒã‚°ãŒå›°é›£ã«ãªã‚‹
- ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ãŒä½ä¸‹ã™ã‚‹

#### å¯¾ç­–
```typescript
// ç¢ºç‡çš„ãƒ­ã‚°å‡ºåŠ›
if (Math.random() < 0.001) { // 0.1%ã®ç¢ºç‡ã§å‡ºåŠ›
  console.log(`[EffectPrimitive] Effect applied with progress ${progress}`);
}

// é‡è¦åº¦åˆ¥ãƒ­ã‚°ç®¡ç†
console.log(`[Template] Initialized`); // åˆæœŸåŒ–ãƒ­ã‚°ã¯å¸¸æ™‚å‡ºåŠ›
console.warn(`[Template] Abnormal value detected: ${value}`); // è­¦å‘Šã¯å¸¸æ™‚å‡ºåŠ›
console.error(`[Template] Error occurred:`, error); // ã‚¨ãƒ©ãƒ¼ã¯å¸¸æ™‚å‡ºåŠ›

// ãƒ‡ãƒãƒƒã‚°ç”¨ãƒ•ãƒ¬ãƒ¼ãƒ ã‚«ã‚¦ãƒ³ã‚¿ãƒ¼
let frameCounter = 0;
frameCounter++;
if (frameCounter % 60 === 0) { // 1ç§’ã«1å›
  console.log(`[Template] Debug info - Frame ${frameCounter}`);
}
```

### 7. ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿æ¤œè¨¼ã‚¨ãƒ©ãƒ¼

#### å¤±æ•—äº‹ä¾‹
```
ParameterValidator.ts:60 Parameter validation errors: 
['Unknown parameter: enableCharScaling', 'Unknown parameter: charScaleMultiplier', ...]
```

#### åŸå› 
æ–°ã—ã„ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã‚’`getParameterConfig()`ã«è¿½åŠ ã—ãŸãŒã€`StandardParameters.ts`ã«ç™»éŒ²ã—ã¦ã„ãªã„

#### å¯¾ç­–
```typescript
// StandardParameters.tsã«è¿½åŠ 
export interface StandardParameters {
  // ... æ—¢å­˜ã®ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿
  
  // æ–°è¦ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã‚’è¿½åŠ 
  enableCharScaling?: boolean;
  charScaleMultiplier?: number;
  charPositionOffsetX?: number;
  charPositionOffsetY?: number;
  charScalingSeed?: number;
}

// DEFAULT_PARAMETERSã«ã‚‚è¿½åŠ 
export const DEFAULT_PARAMETERS: StandardParameters = {
  // ... æ—¢å­˜ã®ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆå€¤
  
  enableCharScaling: true,
  charScaleMultiplier: 8.0,
  charPositionOffsetX: 20,
  charPositionOffsetY: 100,
  charScalingSeed: 12345,
};
```

### 8. Engine.tsã§ã®ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿é…åˆ—ã‚¨ãƒ©ãƒ¼

#### å¤±æ•—äº‹ä¾‹
```
Parameter validation errors: ['Unknown parameter: 0', 'Unknown parameter: 1', ...]
```

#### åŸå› 
Engine.tsã®`changeTemplate`ãƒ¡ã‚½ãƒƒãƒ‰ã§ã€é…åˆ—å½¢å¼ã®`params`ãŒèª¤ã£ã¦`updateGlobalDefaults`ã«æ¸¡ã•ã‚Œã‚‹

#### ç¾çŠ¶ã¨å¯¾ç­–
ã“ã‚Œã¯Engineå´ã®ãƒã‚°ã§ã™ãŒã€å®Ÿéš›ã®å‹•ä½œã«ã¯å½±éŸ¿ã—ã¾ã›ã‚“ã€‚å°†æ¥çš„ãªä¿®æ­£æ¡ˆï¼š
```typescript
// Engine.ts changeTemplateãƒ¡ã‚½ãƒƒãƒ‰å†…
const mergedParams = { ...defaultParams };
// paramsãŒé…åˆ—ã®å ´åˆã¯ã‚¹ã‚­ãƒƒãƒ—
if (!Array.isArray(params)) {
  Object.assign(mergedParams, params);
}
```

### 9. ãƒ©ãƒ³ãƒ€ãƒ å€¤ãŒæ¯ãƒ•ãƒ¬ãƒ¼ãƒ å¤‰åŒ–ã™ã‚‹å•é¡Œ

#### å¤±æ•—äº‹ä¾‹
```typescript
// æ¯ãƒ•ãƒ¬ãƒ¼ãƒ ç•°ãªã‚‹ãƒ©ãƒ³ãƒ€ãƒ å€¤ãŒç”Ÿæˆã•ã‚Œã‚‹
const offsetX = (Math.random() - 0.5) * 40;
const offsetY = (Math.random() - 0.5) * 200;
textObj.position.set(offsetX, offsetY);
```

#### åŸå› 
`Math.random()`ã¯æ¯å›ç•°ãªã‚‹å€¤ã‚’è¿”ã™ãŸã‚ã€æ–‡å­—ãŒéœ‡ãˆç¶šã‘ã‚‹

#### å¯¾ç­–
```typescript
// æ–‡å­—IDãƒ™ãƒ¼ã‚¹ã®æ±ºå®šè«–çš„ãƒ©ãƒ³ãƒ€ãƒ ç”Ÿæˆ
function generateCharacterOffset(charId: string, seed: number, rangeX: number, rangeY: number) {
  let hash = seed;
  for (let i = 0; i < charId.length; i++) {
    hash = ((hash << 5) - hash) + charId.charCodeAt(i);
    hash = hash & hash; // 32bit integerå¤‰æ›
  }
  
  // ãƒãƒƒã‚·ãƒ¥ã‹ã‚‰æ“¬ä¼¼ãƒ©ãƒ³ãƒ€ãƒ ç”Ÿæˆ
  let rng = Math.abs(hash) + 1;
  const nextRandom = () => {
    rng = ((rng * 1103515245) + 12345) & 0x7fffffff;
    return rng / 0x7fffffff;
  };
  
  const x = (nextRandom() - 0.5) * rangeX;
  const y = (nextRandom() - 0.5) * rangeY;
  
  return { x, y };
}

// ä½¿ç”¨ä¾‹
const charId = params.id || `char_${startMs}_${text}`;
const offset = generateCharacterOffset(charId, seed, 40, 200);
```

### 10. ãƒ•ã‚©ãƒ³ãƒˆé¸æŠæ©Ÿèƒ½ã®ä¸æ•´åˆå•é¡Œï¼ˆå¾“æ¥ï¼‰

#### å¤±æ•—äº‹ä¾‹
```typescript
// æ¯ãƒ•ãƒ¬ãƒ¼ãƒ ãƒ­ã‚°å‡ºåŠ›ã§ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ä½ä¸‹
console.log(`Frame ${frameCounter}: ${è©³ç´°æƒ…å ±...}`);
```

#### å¯¾ç­–
```typescript
// ã‚°ãƒ­ãƒ¼ãƒãƒ«ãƒ•ãƒ¬ãƒ¼ãƒ ã‚«ã‚¦ãƒ³ã‚¿ãƒ¼
let frameCounter = 0;
let lastLogFrame = 0;

// 10ãƒ•ãƒ¬ãƒ¼ãƒ ã”ã¨ã«ãƒ­ã‚°å‡ºåŠ›
frameCounter++;
if (frameCounter - lastLogFrame >= 10) {
  lastLogFrame = frameCounter;
  console.log(`=== ãƒ•ãƒ¬ãƒ¼ãƒ  ${frameCounter} ===`);
  console.log(è©³ç´°æƒ…å ±...);
}

// ã¾ãŸã¯ç¢ºç‡çš„ãªãƒ­ã‚°å‡ºåŠ›
if (Math.random() < 0.1) { // 10%ã®ç¢ºç‡
  console.log(ãƒ‡ãƒãƒƒã‚°æƒ…å ±...);
}
```

### 11. ãƒ•ãƒ¬ãƒ¼ã‚ºãŒé‡è¤‡è¡¨ç¤ºã•ã‚Œã‚‹å•é¡Œ

#### å¤±æ•—äº‹ä¾‹
ãƒ•ã‚©ãƒ³ãƒˆé¸æŠUIã§ç„¡åŠ¹ãªãƒ•ã‚©ãƒ³ãƒˆã‚„äºˆæœŸã—ãªã„ãƒ•ã‚©ãƒ³ãƒˆãŒè¡¨ç¤ºã•ã‚Œã‚‹

#### æ ¹æœ¬åŸå› 
FontServiceã«2ã¤ã®ç•°ãªã‚‹ãƒ•ã‚©ãƒ³ãƒˆå–å¾—ãƒ¡ã‚½ãƒƒãƒ‰ãŒã‚ã‚Šã€ãƒ•ã‚£ãƒ«ã‚¿ãƒªãƒ³ã‚°ãƒ­ã‚¸ãƒƒã‚¯ãŒçµ±ä¸€ã•ã‚Œã¦ã„ãªã‹ã£ãŸï¼š

- `getAvailableFonts()`: ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿`type: "string"`ã§ä½¿ç”¨ï¼ˆæ­£ã—ããƒ•ã‚£ãƒ«ã‚¿ãƒªãƒ³ã‚°ï¼‰
- `getFontFamiliesWithStyles()`: ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿`type: "font"`ã§ä½¿ç”¨ï¼ˆãƒ•ã‚£ãƒ«ã‚¿ãƒªãƒ³ã‚°ä¸æ•´åˆï¼‰

#### å•é¡Œã®ç™ºè¦‹æ–¹æ³•
```typescript
// ä»–ã®ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã¨æ¯”è¼ƒã—ã¦ãƒ•ã‚©ãƒ³ãƒˆé¸æŠå€™è£œã‚’ç¢ºèª
console.log('WordSlideText fonts:', FontService.getAvailableFonts());
console.log('MultiLineStack fonts:', FontService.getFontFamiliesWithStyles());
```

#### å¯¾ç­–ã¨ä¿®æ­£
```typescript
// FontService.ts ã® getFontFamiliesWithStyles() ã«çµ±ä¸€ãƒ•ã‚£ãƒ«ã‚¿ãƒªãƒ³ã‚°è¿½åŠ 
static getFontFamiliesWithStyles(): FontFamily[] {
  // getAvailableFonts()ã¨åŒã˜ãƒ•ã‚£ãƒ«ã‚¿ãƒªãƒ³ã‚°ãƒ­ã‚¸ãƒƒã‚¯ã‚’é©ç”¨
  const showAllFonts = this.getShowAllFonts();
  
  let fontsToShow: string[];
  if (showAllFonts || this.pickedFonts.size === 0) {
    fontsToShow = this.validatedFonts;
  } else {
    fontsToShow = this.validatedFonts.filter(font => this.pickedFonts.has(font));
  }
  
  // ãƒ•ã‚£ãƒ«ã‚¿ãƒªãƒ³ã‚°ã•ã‚ŒãŸãƒ•ã‚©ãƒ³ãƒˆã®ã¿ã‚’å¯¾è±¡ã«å‡¦ç†
  fontsToShow.forEach(fontFamily => {
    // ... ã‚¹ã‚¿ã‚¤ãƒ«æƒ…å ±ä»˜ããƒ•ã‚©ãƒ³ãƒˆç”Ÿæˆ
  });
}
```

#### å†ç™ºé˜²æ­¢ã®ã‚¬ã‚¤ãƒ‰ãƒ©ã‚¤ãƒ³

**1. FontServiceã®çµ±ä¸€åŸå‰‡**
- æ–°ã—ã„ãƒ•ã‚©ãƒ³ãƒˆå–å¾—ãƒ¡ã‚½ãƒƒãƒ‰ã‚’è¿½åŠ ã™ã‚‹å ´åˆã¯ã€å¿…ãšæ—¢å­˜ã®`getAvailableFonts()`ã¨åŒã˜ãƒ•ã‚£ãƒ«ã‚¿ãƒªãƒ³ã‚°ãƒ­ã‚¸ãƒƒã‚¯ã‚’é©ç”¨ã™ã‚‹
- ãƒ•ã‚©ãƒ³ãƒˆãƒ”ãƒƒã‚¯ã‚¢ãƒƒãƒ—è¨­å®šï¼ˆ`pickedFonts`ã€`showAllFonts`ï¼‰ã‚’å°Šé‡ã™ã‚‹

**2. ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆé–‹ç™ºæ™‚ã®ç¢ºèªäº‹é …**
```typescript
// ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆå®Ÿè£…å®Œäº†å¾Œã®ç¢ºèªãƒã‚§ãƒƒã‚¯ãƒªã‚¹ãƒˆ
// âœ… ãƒ•ã‚©ãƒ³ãƒˆé¸æŠã§è¡¨ç¤ºã•ã‚Œã‚‹ãƒ•ã‚©ãƒ³ãƒˆä¸€è¦§ãŒä»–ã®ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã¨ä¸€è‡´ã™ã‚‹ã‹
// âœ… ãƒ•ã‚©ãƒ³ãƒˆãƒ”ãƒƒã‚¯ã‚¢ãƒƒãƒ—è¨­å®šãŒæ­£ã—ãåæ˜ ã•ã‚Œã‚‹ã‹
// âœ… ã€Œå…¨ãƒ•ã‚©ãƒ³ãƒˆè¡¨ç¤ºã€è¨­å®šã®åˆ‡ã‚Šæ›¿ãˆãŒå‹•ä½œã™ã‚‹ã‹
```

**3. ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã‚¿ã‚¤ãƒ—é¸æŠæŒ‡é‡**
- `type: "font"`: è±Šå¯Œãªãƒ•ã‚©ãƒ³ãƒˆé¸æŠUIï¼ˆãƒ•ã‚¡ãƒŸãƒªãƒ¼ + ã‚¹ã‚¿ã‚¤ãƒ«é¸æŠï¼‰ãŒå¿…è¦ãªå ´åˆ
- `type: "string"`: ã‚·ãƒ³ãƒ—ãƒ«ãªãƒ‰ãƒ­ãƒƒãƒ—ãƒ€ã‚¦ãƒ³é¸æŠã§ååˆ†ãªå ´åˆ
- **ã©ã¡ã‚‰ã‚’é¸ã‚“ã§ã‚‚ã€ãƒ•ã‚©ãƒ³ãƒˆãƒ•ã‚£ãƒ«ã‚¿ãƒªãƒ³ã‚°å‹•ä½œã¯çµ±ä¸€ã•ã‚Œã¦ã„ã‚‹å¿…è¦ãŒã‚ã‚‹**

### 12. ãƒ•ãƒ¬ãƒ¼ã‚ºãŒé‡è¤‡è¡¨ç¤ºã•ã‚Œã‚‹å•é¡Œ

#### å¤±æ•—äº‹ä¾‹
åŒã˜ãƒ•ãƒ¬ãƒ¼ã‚ºãŒè¤‡æ•°é‡ãªã£ã¦è¡¨ç¤ºã•ã‚Œã‚‹

#### åŸå› ã®å¯èƒ½æ€§
- éšå±¤æ§‹é€ ã®å‡¦ç†ãŒæ­£ã—ãè¡Œã‚ã‚Œã¦ã„ãªã„
- ã‚³ãƒ³ãƒ†ãƒŠã®å‰Šé™¤ãƒ»å†ä½œæˆã‚¿ã‚¤ãƒŸãƒ³ã‚°ã®å•é¡Œ
- è¦ªå­é–¢ä¿‚ã®è¨­å®šãƒŸã‚¹

#### ãƒ‡ãƒãƒƒã‚°æ–¹æ³•
```typescript
// ãƒ•ãƒ¬ãƒ¼ã‚ºã‚³ãƒ³ãƒ†ãƒŠå‡¦ç†æ™‚ã®ãƒ­ã‚°è¿½åŠ 
if (frameCounter % 10 === 0) {
  console.log(`=== ãƒ•ãƒ¬ãƒ¼ã‚ºã‚³ãƒ³ãƒ†ãƒŠå‡¦ç† ===`);
  console.log(`ãƒ•ãƒ¬ãƒ¼ã‚ºãƒ†ã‚­ã‚¹ãƒˆ: "${text}"`);
  console.log(`ã‚³ãƒ³ãƒ†ãƒŠå: ${container.name}`);
  console.log(`å­ã‚³ãƒ³ãƒ†ãƒŠæ•°: ${container.children.length}`);
  console.log(`ä½ç½®: (${container.position.x}, ${container.position.y})`);
}
```

## é‡è¦ãªå†ç™ºé˜²æ­¢ã‚¬ã‚¤ãƒ‰ãƒ©ã‚¤ãƒ³

### ãƒ—ãƒªãƒŸãƒ†ã‚£ãƒ–ã‚·ã‚¹ãƒ†ãƒ ä½¿ç”¨æ™‚ã®å¿…é ˆãƒã‚§ãƒƒã‚¯ãƒªã‚¹ãƒˆ

ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆé–‹ç™ºå®Œäº†å¾Œã€ä»¥ä¸‹ã®ãƒã‚§ãƒƒã‚¯ãƒªã‚¹ãƒˆã‚’ç¢ºèªã—ã¦ãã ã•ã„ï¼š

#### 1. ãƒªã‚½ãƒ¼ã‚¹ç®¡ç†ã®ç¢ºèª
- [ ] ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆãŒã‚­ãƒ£ãƒƒã‚·ãƒ¥ã•ã‚Œã¦ã„ã‚‹
- [ ] ã‚¨ãƒ•ã‚§ã‚¯ãƒˆãƒ—ãƒªãƒŸãƒ†ã‚£ãƒ–ã§`initialized`ãƒ•ãƒ©ã‚°ãŒé©åˆ‡ã«ä½¿ç”¨ã•ã‚Œã¦ã„ã‚‹
- [ ] `cleanup()`ãƒ¡ã‚½ãƒƒãƒ‰ã§ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼ãŒé©åˆ‡ã«å‰Šé™¤ã•ã‚Œã¦ã„ã‚‹
- [ ] ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼æ•°ã®ç›£è¦–ãƒ­ã‚°ãŒå®Ÿè£…ã•ã‚Œã¦ã„ã‚‹ï¼ˆ10å€‹è¶…éã§è­¦å‘Šï¼‰

#### 2. ãƒ‡ãƒãƒƒã‚°ãƒ­ã‚°ã®é©åˆ‡æ€§
- [ ] é«˜é »åº¦å®Ÿè¡Œã•ã‚Œã‚‹å‡¦ç†ã§ã¯ç¢ºç‡çš„ãƒ­ã‚°å‡ºåŠ›ã‚’ä½¿ç”¨ï¼ˆ0.1%ã€œ1%ï¼‰
- [ ] åˆæœŸåŒ–ãƒ»ã‚¯ãƒªãƒ¼ãƒ³ã‚¢ãƒƒãƒ—ãƒ­ã‚°ã¯ä¿æŒã•ã‚Œã¦ã„ã‚‹
- [ ] ã‚¨ãƒ©ãƒ¼ãƒ»è­¦å‘Šãƒ­ã‚°ã¯å¸¸æ™‚å‡ºåŠ›ã•ã‚Œã‚‹
- [ ] ç•°å¸¸å€¤æ¤œå‡ºãƒ­ã‚°ãŒå®Ÿè£…ã•ã‚Œã¦ã„ã‚‹

#### 3. ãƒ†ã‚­ã‚¹ãƒˆè¡¨ç¤ºã®ç¢ºèª
- [ ] `removeVisualElements`ã§æ–‡å­—ã‚³ãƒ³ãƒ†ãƒŠå†…ã®ãƒ†ã‚­ã‚¹ãƒˆãŒä¿è­·ã•ã‚Œã¦ã„ã‚‹
- [ ] éšå±¤åˆ¥ã«å‰Šé™¤å¯¾è±¡ãŒé©åˆ‡ã«åˆ¤å®šã•ã‚Œã¦ã„ã‚‹
- [ ] ãƒ†ã‚­ã‚¹ãƒˆã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã«é©åˆ‡ãªåå‰ï¼ˆ`name`ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ï¼‰ãŒè¨­å®šã•ã‚Œã¦ã„ã‚‹

#### 4. ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ã®ç¢ºèª
- [ ] æ—©æœŸãƒªã‚¿ãƒ¼ãƒ³ãŒå®Ÿè£…ã•ã‚Œã¦ã„ã‚‹ï¼ˆå¯è¦–ç¯„å›²å¤–ã®å ´åˆãªã©ï¼‰
- [ ] æ¯ãƒ•ãƒ¬ãƒ¼ãƒ æ–°è¦ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆä½œæˆã‚’é¿ã‘ã¦ã„ã‚‹
- [ ] é‡ã„å‡¦ç†ã«æ¡ä»¶åˆ†å²ãŒã‚ã‚‹

#### 5. ãƒ†ã‚¹ãƒˆç¢ºèªé …ç›®
- [ ] ã‚¨ãƒ•ã‚§ã‚¯ãƒˆã‚’æœ‰åŠ¹ã«ã—ã¦é•·æ™‚é–“å®Ÿè¡Œã—ã¦ã‚‚ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼ãŒè“„ç©ã—ãªã„
- [ ] ãƒ‡ãƒãƒƒã‚°ã‚³ãƒ³ã‚½ãƒ¼ãƒ«ãŒéå‰°ãªãƒ­ã‚°ã§åŸ‹ã¾ã‚‰ãªã„
- [ ] ã‚·ãƒ£ãƒ‰ã‚¦ãƒ»ã‚°ãƒ­ãƒ¼ã‚¨ãƒ•ã‚§ã‚¯ãƒˆãŒæ­£å¸¸ã«å‹•ä½œã™ã‚‹
- [ ] æ–‡å­—ãŒæœŸå¾…é€šã‚Šã«è¡¨ç¤ºã•ã‚Œã‚‹

---

## ã¾ã¨ã‚

ã“ã®ã‚¬ã‚¤ãƒ‰ã§ã¯ã€UTAVISTA v0.4.2ã«ãŠã‘ã‚‹åŒ…æ‹¬çš„ãªãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆå®Ÿè£…æ‰‹é †ã‚’èª¬æ˜ã—ã¾ã—ãŸã€‚

### é‡è¦ãªãƒã‚¤ãƒ³ãƒˆ

1. **éšå±¤è²¬ä»»åˆ†é›¢**: ãƒ•ãƒ¬ãƒ¼ã‚ºãƒ»å˜èªãƒ»æ–‡å­—ã®æ˜ç¢ºãªå½¹å‰²åˆ†æ‹…
2. **ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹æœ€é©åŒ–**: æ—©æœŸãƒªã‚¿ãƒ¼ãƒ³ã€ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆãƒ—ãƒ¼ãƒ«ã€æ¡ä»¶ä»˜ããƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°
3. **ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°**: å¤šå±¤ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯ã‚·ã‚¹ãƒ†ãƒ 
4. **ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ç®¡ç†**: å‹å®‰å…¨ãªãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã‚¢ã‚¯ã‚»ã‚¹
5. **JSONé§†å‹•ç™»éŒ²**: å‹•çš„ãªãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆç™»éŒ²ã‚·ã‚¹ãƒ†ãƒ 
6. **ã‚·ã‚¹ãƒ†ãƒ æ©Ÿèƒ½çµ±ä¸€æ€§**: ãƒ•ã‚©ãƒ³ãƒˆé¸æŠãªã©ã®æ—¢å­˜æ©Ÿèƒ½ã¨ä¸€è²«æ€§ã®ã‚ã‚‹å®Ÿè£…
7. **å¤±æ•—äº‹ä¾‹ã‹ã‚‰ã®å­¦ç¿’**: ã‚ˆãã‚ã‚‹å•é¡Œã¨ãã®å¯¾ç­–

### æ¬¡ã®ã‚¹ãƒ†ãƒƒãƒ—

1. ã“ã®ã‚¬ã‚¤ãƒ‰ã‚’å‚è€ƒã«åŸºæœ¬ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã‚’ä½œæˆ
2. æ—¢å­˜ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã‚’å‚è€ƒã«æ©Ÿèƒ½ã‚’æ‹¡å¼µ
3. å¤±æ•—äº‹ä¾‹ã‚’ç¢ºèªã—ã¦å•é¡Œã‚’å›é¿
4. **ã‚·ã‚¹ãƒ†ãƒ æ©Ÿèƒ½ç¢ºèª**: ãƒ•ã‚©ãƒ³ãƒˆé¸æŠã€ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿è¡¨ç¤ºç­‰ã®æ—¢å­˜æ©Ÿèƒ½ã¨ã®æ•´åˆæ€§ãƒã‚§ãƒƒã‚¯
5. ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹æ¸¬å®šã¨ãƒ‡ãƒãƒƒã‚°
6. ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆãƒ¬ã‚¸ã‚¹ãƒˆãƒªã¸ã®ç™»éŒ²ã¨ãƒ†ã‚¹ãƒˆ

é«˜å“è³ªãªãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆå®Ÿè£…ã«ã‚ˆã‚Šã€UTAVISTAã®è¡¨ç¾åŠ›ã‚’å¤§å¹…ã«å‘ä¸Šã•ã›ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚